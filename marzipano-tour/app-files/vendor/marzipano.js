/* 
 * Marzipano - a 360Â° media viewer for the modern web (v0.1.2)
 *
 * Copyright (C) 2015 Digisfera Lda. All Rights Reserved.
 *
 * All source code, documentation and other information contained herein is
 * and remains the property of Digisfera Lda. Dissemination or reproduction
 * of this material is strictly forbidden unless prior written permission
 * is obtained from Digisfera Lda.
 *
 * This software may not be used for any commercial purposes. 
 * The "Powered by Marzipano" watermark must remain visible.
 * For more information see LICENSE.txt
 * 
 */
!function(t){if("object"==typeof exports&&"undefined"!=typeof module)module.exports=t();else if("function"==typeof define&&define.amd)define([],t);else{var e;"undefined"!=typeof window?e=window:"undefined"!=typeof global?e=global:"undefined"!=typeof self&&(e=self),e.Marzipano=t()}}(function(){var t;return function e(t,i,n){function r(o,a){if(!i[o]){if(!t[o]){var h="function"==typeof require&&require;if(!a&&h)return h(o,!0);if(s)return s(o,!0);var l=new Error("Cannot find module '"+o+"'");throw l.code="MODULE_NOT_FOUND",l}var u=i[o]={exports:{}};t[o][0].call(u.exports,function(e){var i=t[o][1][e];return r(i?i:e)},u,u.exports,e,t,i,n)}return i[o].exports}for(var s="function"==typeof require&&require,o=0;o<n.length;o++)r(n[o]);return r}({1:[function(e,i,n){!function(e,n){"undefined"!=typeof i&&i.exports?i.exports.browser=n():"function"==typeof t&&t.amd?t(n):this[e]=n()}("bowser",function(){function t(t){function i(e){var i=t.match(e);return i&&i.length>1&&i[1]||""}var n,r=i(/(ipod|iphone|ipad)/i).toLowerCase(),s=/like android/i.test(t),o=!s&&/android/i.test(t),a=i(/version\/(\d+(\.\d+)?)/i),h=/tablet/i.test(t),l=!h&&/[^-]mobi/i.test(t);/opera|opr/i.test(t)?n={name:"Opera",opera:e,version:a||i(/(?:opera|opr)[\s\/](\d+(\.\d+)?)/i)}:/windows phone/i.test(t)?n={name:"Windows Phone",windowsphone:e,msie:e,version:i(/iemobile\/(\d+(\.\d+)?)/i)}:/msie|trident/i.test(t)?n={name:"Internet Explorer",msie:e,version:i(/(?:msie |rv:)(\d+(\.\d+)?)/i)}:/chrome|crios|crmo/i.test(t)?n={name:"Chrome",chrome:e,version:i(/(?:chrome|crios|crmo)\/(\d+(\.\d+)?)/i)}:r?(n={name:"iphone"==r?"iPhone":"ipad"==r?"iPad":"iPod"},a&&(n.version=a)):/sailfish/i.test(t)?n={name:"Sailfish",sailfish:e,version:i(/sailfish\s?browser\/(\d+(\.\d+)?)/i)}:/seamonkey\//i.test(t)?n={name:"SeaMonkey",seamonkey:e,version:i(/seamonkey\/(\d+(\.\d+)?)/i)}:/firefox|iceweasel/i.test(t)?(n={name:"Firefox",firefox:e,version:i(/(?:firefox|iceweasel)[ \/](\d+(\.\d+)?)/i)},/\((mobile|tablet);[^\)]*rv:[\d\.]+\)/i.test(t)&&(n.firefoxos=e)):/silk/i.test(t)?n={name:"Amazon Silk",silk:e,version:i(/silk\/(\d+(\.\d+)?)/i)}:o?n={name:"Android",version:a}:/phantom/i.test(t)?n={name:"PhantomJS",phantom:e,version:i(/phantomjs\/(\d+(\.\d+)?)/i)}:/blackberry|\bbb\d+/i.test(t)||/rim\stablet/i.test(t)?n={name:"BlackBerry",blackberry:e,version:a||i(/blackberry[\d]+\/(\d+(\.\d+)?)/i)}:/(web|hpw)os/i.test(t)?(n={name:"WebOS",webos:e,version:a||i(/w(?:eb)?osbrowser\/(\d+(\.\d+)?)/i)},/touchpad\//i.test(t)&&(n.touchpad=e)):n=/bada/i.test(t)?{name:"Bada",bada:e,version:i(/dolfin\/(\d+(\.\d+)?)/i)}:/tizen/i.test(t)?{name:"Tizen",tizen:e,version:i(/(?:tizen\s?)?browser\/(\d+(\.\d+)?)/i)||a}:/safari/i.test(t)?{name:"Safari",safari:e,version:a}:{},/(apple)?webkit/i.test(t)?(n.name=n.name||"Webkit",n.webkit=e,!n.version&&a&&(n.version=a)):!n.opera&&/gecko\//i.test(t)&&(n.name=n.name||"Gecko",n.gecko=e,n.version=n.version||i(/gecko\/(\d+(\.\d+)?)/i)),o||n.silk?n.android=e:r&&(n[r]=e,n.ios=e);var u="";r?(u=i(/os (\d+([_\s]\d+)*) like mac os x/i),u=u.replace(/[_\s]/g,".")):o?u=i(/android[ \/-](\d+(\.\d+)*)/i):n.windowsphone?u=i(/windows phone (?:os)?\s?(\d+(\.\d+)*)/i):n.webos?u=i(/(?:web|hpw)os\/(\d+(\.\d+)*)/i):n.blackberry?u=i(/rim\stablet\sos\s(\d+(\.\d+)*)/i):n.bada?u=i(/bada\/(\d+(\.\d+)*)/i):n.tizen&&(u=i(/tizen[\/\s](\d+(\.\d+)*)/i)),u&&(n.osversion=u);var c=u.split(".")[0];return h||"ipad"==r||o&&(3==c||4==c&&!l)||n.silk?n.tablet=e:(l||"iphone"==r||"ipod"==r||o||n.blackberry||n.webos||n.bada)&&(n.mobile=e),n.msie&&n.version>=10||n.chrome&&n.version>=20||n.firefox&&n.version>=20||n.safari&&n.version>=6||n.opera&&n.version>=10||n.ios&&n.osversion&&n.osversion.split(".")[0]>=6||n.blackberry&&n.version>=10.1?n.a=e:n.msie&&n.version<10||n.chrome&&n.version<20||n.firefox&&n.version<20||n.safari&&n.version<6||n.opera&&n.version<10||n.ios&&n.osversion&&n.osversion.split(".")[0]<6?n.c=e:n.x=e,n}var e=!0,i=t("undefined"!=typeof navigator?navigator.userAgent:"");return i._detect=t,i})},{}],2:[function(e,i,n){!function(e){"use strict";var i={};"undefined"==typeof n?"function"==typeof t&&"object"==typeof t.amd&&t.amd?(i.exports={},t(function(){return i.exports})):i.exports="undefined"!=typeof window?window:e:i.exports=n,function(t){if(!e)var e=1e-6;if(!i)var i="undefined"!=typeof Float32Array?Float32Array:Array;if(!n)var n=Math.random;var r={};r.setMatrixArrayType=function(t){i=t},"undefined"!=typeof t&&(t.glMatrix=r);var s=Math.PI/180;r.toRadian=function(t){return t*s};var o={};o.create=function(){var t=new i(2);return t[0]=0,t[1]=0,t},o.clone=function(t){var e=new i(2);return e[0]=t[0],e[1]=t[1],e},o.fromValues=function(t,e){var n=new i(2);return n[0]=t,n[1]=e,n},o.copy=function(t,e){return t[0]=e[0],t[1]=e[1],t},o.set=function(t,e,i){return t[0]=e,t[1]=i,t},o.add=function(t,e,i){return t[0]=e[0]+i[0],t[1]=e[1]+i[1],t},o.subtract=function(t,e,i){return t[0]=e[0]-i[0],t[1]=e[1]-i[1],t},o.sub=o.subtract,o.multiply=function(t,e,i){return t[0]=e[0]*i[0],t[1]=e[1]*i[1],t},o.mul=o.multiply,o.divide=function(t,e,i){return t[0]=e[0]/i[0],t[1]=e[1]/i[1],t},o.div=o.divide,o.min=function(t,e,i){return t[0]=Math.min(e[0],i[0]),t[1]=Math.min(e[1],i[1]),t},o.max=function(t,e,i){return t[0]=Math.max(e[0],i[0]),t[1]=Math.max(e[1],i[1]),t},o.scale=function(t,e,i){return t[0]=e[0]*i,t[1]=e[1]*i,t},o.scaleAndAdd=function(t,e,i,n){return t[0]=e[0]+i[0]*n,t[1]=e[1]+i[1]*n,t},o.distance=function(t,e){var i=e[0]-t[0],n=e[1]-t[1];return Math.sqrt(i*i+n*n)},o.dist=o.distance,o.squaredDistance=function(t,e){var i=e[0]-t[0],n=e[1]-t[1];return i*i+n*n},o.sqrDist=o.squaredDistance,o.length=function(t){var e=t[0],i=t[1];return Math.sqrt(e*e+i*i)},o.len=o.length,o.squaredLength=function(t){var e=t[0],i=t[1];return e*e+i*i},o.sqrLen=o.squaredLength,o.negate=function(t,e){return t[0]=-e[0],t[1]=-e[1],t},o.normalize=function(t,e){var i=e[0],n=e[1],r=i*i+n*n;return r>0&&(r=1/Math.sqrt(r),t[0]=e[0]*r,t[1]=e[1]*r),t},o.dot=function(t,e){return t[0]*e[0]+t[1]*e[1]},o.cross=function(t,e,i){var n=e[0]*i[1]-e[1]*i[0];return t[0]=t[1]=0,t[2]=n,t},o.lerp=function(t,e,i,n){var r=e[0],s=e[1];return t[0]=r+n*(i[0]-r),t[1]=s+n*(i[1]-s),t},o.random=function(t,e){e=e||1;var i=2*n()*Math.PI;return t[0]=Math.cos(i)*e,t[1]=Math.sin(i)*e,t},o.transformMat2=function(t,e,i){var n=e[0],r=e[1];return t[0]=i[0]*n+i[2]*r,t[1]=i[1]*n+i[3]*r,t},o.transformMat2d=function(t,e,i){var n=e[0],r=e[1];return t[0]=i[0]*n+i[2]*r+i[4],t[1]=i[1]*n+i[3]*r+i[5],t},o.transformMat3=function(t,e,i){var n=e[0],r=e[1];return t[0]=i[0]*n+i[3]*r+i[6],t[1]=i[1]*n+i[4]*r+i[7],t},o.transformMat4=function(t,e,i){var n=e[0],r=e[1];return t[0]=i[0]*n+i[4]*r+i[12],t[1]=i[1]*n+i[5]*r+i[13],t},o.forEach=function(){var t=o.create();return function(e,i,n,r,s,o){var a,h;for(i||(i=2),n||(n=0),h=r?Math.min(r*i+n,e.length):e.length,a=n;h>a;a+=i)t[0]=e[a],t[1]=e[a+1],s(t,t,o),e[a]=t[0],e[a+1]=t[1];return e}}(),o.str=function(t){return"vec2("+t[0]+", "+t[1]+")"},"undefined"!=typeof t&&(t.vec2=o);var a={};a.create=function(){var t=new i(3);return t[0]=0,t[1]=0,t[2]=0,t},a.clone=function(t){var e=new i(3);return e[0]=t[0],e[1]=t[1],e[2]=t[2],e},a.fromValues=function(t,e,n){var r=new i(3);return r[0]=t,r[1]=e,r[2]=n,r},a.copy=function(t,e){return t[0]=e[0],t[1]=e[1],t[2]=e[2],t},a.set=function(t,e,i,n){return t[0]=e,t[1]=i,t[2]=n,t},a.add=function(t,e,i){return t[0]=e[0]+i[0],t[1]=e[1]+i[1],t[2]=e[2]+i[2],t},a.subtract=function(t,e,i){return t[0]=e[0]-i[0],t[1]=e[1]-i[1],t[2]=e[2]-i[2],t},a.sub=a.subtract,a.multiply=function(t,e,i){return t[0]=e[0]*i[0],t[1]=e[1]*i[1],t[2]=e[2]*i[2],t},a.mul=a.multiply,a.divide=function(t,e,i){return t[0]=e[0]/i[0],t[1]=e[1]/i[1],t[2]=e[2]/i[2],t},a.div=a.divide,a.min=function(t,e,i){return t[0]=Math.min(e[0],i[0]),t[1]=Math.min(e[1],i[1]),t[2]=Math.min(e[2],i[2]),t},a.max=function(t,e,i){return t[0]=Math.max(e[0],i[0]),t[1]=Math.max(e[1],i[1]),t[2]=Math.max(e[2],i[2]),t},a.scale=function(t,e,i){return t[0]=e[0]*i,t[1]=e[1]*i,t[2]=e[2]*i,t},a.scaleAndAdd=function(t,e,i,n){return t[0]=e[0]+i[0]*n,t[1]=e[1]+i[1]*n,t[2]=e[2]+i[2]*n,t},a.distance=function(t,e){var i=e[0]-t[0],n=e[1]-t[1],r=e[2]-t[2];return Math.sqrt(i*i+n*n+r*r)},a.dist=a.distance,a.squaredDistance=function(t,e){var i=e[0]-t[0],n=e[1]-t[1],r=e[2]-t[2];return i*i+n*n+r*r},a.sqrDist=a.squaredDistance,a.length=function(t){var e=t[0],i=t[1],n=t[2];return Math.sqrt(e*e+i*i+n*n)},a.len=a.length,a.squaredLength=function(t){var e=t[0],i=t[1],n=t[2];return e*e+i*i+n*n},a.sqrLen=a.squaredLength,a.negate=function(t,e){return t[0]=-e[0],t[1]=-e[1],t[2]=-e[2],t},a.normalize=function(t,e){var i=e[0],n=e[1],r=e[2],s=i*i+n*n+r*r;return s>0&&(s=1/Math.sqrt(s),t[0]=e[0]*s,t[1]=e[1]*s,t[2]=e[2]*s),t},a.dot=function(t,e){return t[0]*e[0]+t[1]*e[1]+t[2]*e[2]},a.cross=function(t,e,i){var n=e[0],r=e[1],s=e[2],o=i[0],a=i[1],h=i[2];return t[0]=r*h-s*a,t[1]=s*o-n*h,t[2]=n*a-r*o,t},a.lerp=function(t,e,i,n){var r=e[0],s=e[1],o=e[2];return t[0]=r+n*(i[0]-r),t[1]=s+n*(i[1]-s),t[2]=o+n*(i[2]-o),t},a.random=function(t,e){e=e||1;var i=2*n()*Math.PI,r=2*n()-1,s=Math.sqrt(1-r*r)*e;return t[0]=Math.cos(i)*s,t[1]=Math.sin(i)*s,t[2]=r*e,t},a.transformMat4=function(t,e,i){var n=e[0],r=e[1],s=e[2];return t[0]=i[0]*n+i[4]*r+i[8]*s+i[12],t[1]=i[1]*n+i[5]*r+i[9]*s+i[13],t[2]=i[2]*n+i[6]*r+i[10]*s+i[14],t},a.transformMat3=function(t,e,i){var n=e[0],r=e[1],s=e[2];return t[0]=n*i[0]+r*i[3]+s*i[6],t[1]=n*i[1]+r*i[4]+s*i[7],t[2]=n*i[2]+r*i[5]+s*i[8],t},a.transformQuat=function(t,e,i){var n=e[0],r=e[1],s=e[2],o=i[0],a=i[1],h=i[2],l=i[3],u=l*n+a*s-h*r,c=l*r+h*n-o*s,p=l*s+o*r-a*n,f=-o*n-a*r-h*s;return t[0]=u*l+f*-o+c*-h-p*-a,t[1]=c*l+f*-a+p*-o-u*-h,t[2]=p*l+f*-h+u*-a-c*-o,t},a.rotateX=function(t,e,i,n){var r=[],s=[];return r[0]=e[0]-i[0],r[1]=e[1]-i[1],r[2]=e[2]-i[2],s[0]=r[0],s[1]=r[1]*Math.cos(n)-r[2]*Math.sin(n),s[2]=r[1]*Math.sin(n)+r[2]*Math.cos(n),t[0]=s[0]+i[0],t[1]=s[1]+i[1],t[2]=s[2]+i[2],t},a.rotateY=function(t,e,i,n){var r=[],s=[];return r[0]=e[0]-i[0],r[1]=e[1]-i[1],r[2]=e[2]-i[2],s[0]=r[2]*Math.sin(n)+r[0]*Math.cos(n),s[1]=r[1],s[2]=r[2]*Math.cos(n)-r[0]*Math.sin(n),t[0]=s[0]+i[0],t[1]=s[1]+i[1],t[2]=s[2]+i[2],t},a.rotateZ=function(t,e,i,n){var r=[],s=[];return r[0]=e[0]-i[0],r[1]=e[1]-i[1],r[2]=e[2]-i[2],s[0]=r[0]*Math.cos(n)-r[1]*Math.sin(n),s[1]=r[0]*Math.sin(n)+r[1]*Math.cos(n),s[2]=r[2],t[0]=s[0]+i[0],t[1]=s[1]+i[1],t[2]=s[2]+i[2],t},a.forEach=function(){var t=a.create();return function(e,i,n,r,s,o){var a,h;for(i||(i=3),n||(n=0),h=r?Math.min(r*i+n,e.length):e.length,a=n;h>a;a+=i)t[0]=e[a],t[1]=e[a+1],t[2]=e[a+2],s(t,t,o),e[a]=t[0],e[a+1]=t[1],e[a+2]=t[2];return e}}(),a.str=function(t){return"vec3("+t[0]+", "+t[1]+", "+t[2]+")"},"undefined"!=typeof t&&(t.vec3=a);var h={};h.create=function(){var t=new i(4);return t[0]=0,t[1]=0,t[2]=0,t[3]=0,t},h.clone=function(t){var e=new i(4);return e[0]=t[0],e[1]=t[1],e[2]=t[2],e[3]=t[3],e},h.fromValues=function(t,e,n,r){var s=new i(4);return s[0]=t,s[1]=e,s[2]=n,s[3]=r,s},h.copy=function(t,e){return t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[3],t},h.set=function(t,e,i,n,r){return t[0]=e,t[1]=i,t[2]=n,t[3]=r,t},h.add=function(t,e,i){return t[0]=e[0]+i[0],t[1]=e[1]+i[1],t[2]=e[2]+i[2],t[3]=e[3]+i[3],t},h.subtract=function(t,e,i){return t[0]=e[0]-i[0],t[1]=e[1]-i[1],t[2]=e[2]-i[2],t[3]=e[3]-i[3],t},h.sub=h.subtract,h.multiply=function(t,e,i){return t[0]=e[0]*i[0],t[1]=e[1]*i[1],t[2]=e[2]*i[2],t[3]=e[3]*i[3],t},h.mul=h.multiply,h.divide=function(t,e,i){return t[0]=e[0]/i[0],t[1]=e[1]/i[1],t[2]=e[2]/i[2],t[3]=e[3]/i[3],t},h.div=h.divide,h.min=function(t,e,i){return t[0]=Math.min(e[0],i[0]),t[1]=Math.min(e[1],i[1]),t[2]=Math.min(e[2],i[2]),t[3]=Math.min(e[3],i[3]),t},h.max=function(t,e,i){return t[0]=Math.max(e[0],i[0]),t[1]=Math.max(e[1],i[1]),t[2]=Math.max(e[2],i[2]),t[3]=Math.max(e[3],i[3]),t},h.scale=function(t,e,i){return t[0]=e[0]*i,t[1]=e[1]*i,t[2]=e[2]*i,t[3]=e[3]*i,t},h.scaleAndAdd=function(t,e,i,n){return t[0]=e[0]+i[0]*n,t[1]=e[1]+i[1]*n,t[2]=e[2]+i[2]*n,t[3]=e[3]+i[3]*n,t},h.distance=function(t,e){var i=e[0]-t[0],n=e[1]-t[1],r=e[2]-t[2],s=e[3]-t[3];return Math.sqrt(i*i+n*n+r*r+s*s)},h.dist=h.distance,h.squaredDistance=function(t,e){var i=e[0]-t[0],n=e[1]-t[1],r=e[2]-t[2],s=e[3]-t[3];return i*i+n*n+r*r+s*s},h.sqrDist=h.squaredDistance,h.length=function(t){var e=t[0],i=t[1],n=t[2],r=t[3];return Math.sqrt(e*e+i*i+n*n+r*r)},h.len=h.length,h.squaredLength=function(t){var e=t[0],i=t[1],n=t[2],r=t[3];return e*e+i*i+n*n+r*r},h.sqrLen=h.squaredLength,h.negate=function(t,e){return t[0]=-e[0],t[1]=-e[1],t[2]=-e[2],t[3]=-e[3],t},h.normalize=function(t,e){var i=e[0],n=e[1],r=e[2],s=e[3],o=i*i+n*n+r*r+s*s;return o>0&&(o=1/Math.sqrt(o),t[0]=e[0]*o,t[1]=e[1]*o,t[2]=e[2]*o,t[3]=e[3]*o),t},h.dot=function(t,e){return t[0]*e[0]+t[1]*e[1]+t[2]*e[2]+t[3]*e[3]},h.lerp=function(t,e,i,n){var r=e[0],s=e[1],o=e[2],a=e[3];return t[0]=r+n*(i[0]-r),t[1]=s+n*(i[1]-s),t[2]=o+n*(i[2]-o),t[3]=a+n*(i[3]-a),t},h.random=function(t,e){return e=e||1,t[0]=n(),t[1]=n(),t[2]=n(),t[3]=n(),h.normalize(t,t),h.scale(t,t,e),t},h.transformMat4=function(t,e,i){var n=e[0],r=e[1],s=e[2],o=e[3];return t[0]=i[0]*n+i[4]*r+i[8]*s+i[12]*o,t[1]=i[1]*n+i[5]*r+i[9]*s+i[13]*o,t[2]=i[2]*n+i[6]*r+i[10]*s+i[14]*o,t[3]=i[3]*n+i[7]*r+i[11]*s+i[15]*o,t},h.transformQuat=function(t,e,i){var n=e[0],r=e[1],s=e[2],o=i[0],a=i[1],h=i[2],l=i[3],u=l*n+a*s-h*r,c=l*r+h*n-o*s,p=l*s+o*r-a*n,f=-o*n-a*r-h*s;return t[0]=u*l+f*-o+c*-h-p*-a,t[1]=c*l+f*-a+p*-o-u*-h,t[2]=p*l+f*-h+u*-a-c*-o,t},h.forEach=function(){var t=h.create();return function(e,i,n,r,s,o){var a,h;for(i||(i=4),n||(n=0),h=r?Math.min(r*i+n,e.length):e.length,a=n;h>a;a+=i)t[0]=e[a],t[1]=e[a+1],t[2]=e[a+2],t[3]=e[a+3],s(t,t,o),e[a]=t[0],e[a+1]=t[1],e[a+2]=t[2],e[a+3]=t[3];return e}}(),h.str=function(t){return"vec4("+t[0]+", "+t[1]+", "+t[2]+", "+t[3]+")"},"undefined"!=typeof t&&(t.vec4=h);var l={};l.create=function(){var t=new i(4);return t[0]=1,t[1]=0,t[2]=0,t[3]=1,t},l.clone=function(t){var e=new i(4);return e[0]=t[0],e[1]=t[1],e[2]=t[2],e[3]=t[3],e},l.copy=function(t,e){return t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[3],t},l.identity=function(t){return t[0]=1,t[1]=0,t[2]=0,t[3]=1,t},l.transpose=function(t,e){if(t===e){var i=e[1];t[1]=e[2],t[2]=i}else t[0]=e[0],t[1]=e[2],t[2]=e[1],t[3]=e[3];return t},l.invert=function(t,e){var i=e[0],n=e[1],r=e[2],s=e[3],o=i*s-r*n;return o?(o=1/o,t[0]=s*o,t[1]=-n*o,t[2]=-r*o,t[3]=i*o,t):null},l.adjoint=function(t,e){var i=e[0];return t[0]=e[3],t[1]=-e[1],t[2]=-e[2],t[3]=i,t},l.determinant=function(t){return t[0]*t[3]-t[2]*t[1]},l.multiply=function(t,e,i){var n=e[0],r=e[1],s=e[2],o=e[3],a=i[0],h=i[1],l=i[2],u=i[3];return t[0]=n*a+s*h,t[1]=r*a+o*h,t[2]=n*l+s*u,t[3]=r*l+o*u,t},l.mul=l.multiply,l.rotate=function(t,e,i){var n=e[0],r=e[1],s=e[2],o=e[3],a=Math.sin(i),h=Math.cos(i);return t[0]=n*h+s*a,t[1]=r*h+o*a,t[2]=n*-a+s*h,t[3]=r*-a+o*h,t},l.scale=function(t,e,i){var n=e[0],r=e[1],s=e[2],o=e[3],a=i[0],h=i[1];return t[0]=n*a,t[1]=r*a,t[2]=s*h,t[3]=o*h,t},l.str=function(t){return"mat2("+t[0]+", "+t[1]+", "+t[2]+", "+t[3]+")"},l.frob=function(t){return Math.sqrt(Math.pow(t[0],2)+Math.pow(t[1],2)+Math.pow(t[2],2)+Math.pow(t[3],2))},l.LDU=function(t,e,i,n){return t[2]=n[2]/n[0],i[0]=n[0],i[1]=n[1],i[3]=n[3]-t[2]*i[1],[t,e,i]},"undefined"!=typeof t&&(t.mat2=l);var u={};u.create=function(){var t=new i(6);return t[0]=1,t[1]=0,t[2]=0,t[3]=1,t[4]=0,t[5]=0,t},u.clone=function(t){var e=new i(6);return e[0]=t[0],e[1]=t[1],e[2]=t[2],e[3]=t[3],e[4]=t[4],e[5]=t[5],e},u.copy=function(t,e){return t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[3],t[4]=e[4],t[5]=e[5],t},u.identity=function(t){return t[0]=1,t[1]=0,t[2]=0,t[3]=1,t[4]=0,t[5]=0,t},u.invert=function(t,e){var i=e[0],n=e[1],r=e[2],s=e[3],o=e[4],a=e[5],h=i*s-n*r;return h?(h=1/h,t[0]=s*h,t[1]=-n*h,t[2]=-r*h,t[3]=i*h,t[4]=(r*a-s*o)*h,t[5]=(n*o-i*a)*h,t):null},u.determinant=function(t){return t[0]*t[3]-t[1]*t[2]},u.multiply=function(t,e,i){var n=e[0],r=e[1],s=e[2],o=e[3],a=e[4],h=e[5],l=i[0],u=i[1],c=i[2],p=i[3],f=i[4],d=i[5];return t[0]=n*l+s*u,t[1]=r*l+o*u,t[2]=n*c+s*p,t[3]=r*c+o*p,t[4]=n*f+s*d+a,t[5]=r*f+o*d+h,t},u.mul=u.multiply,u.rotate=function(t,e,i){var n=e[0],r=e[1],s=e[2],o=e[3],a=e[4],h=e[5],l=Math.sin(i),u=Math.cos(i);return t[0]=n*u+s*l,t[1]=r*u+o*l,t[2]=n*-l+s*u,t[3]=r*-l+o*u,t[4]=a,t[5]=h,t},u.scale=function(t,e,i){var n=e[0],r=e[1],s=e[2],o=e[3],a=e[4],h=e[5],l=i[0],u=i[1];return t[0]=n*l,t[1]=r*l,t[2]=s*u,t[3]=o*u,t[4]=a,t[5]=h,t},u.translate=function(t,e,i){var n=e[0],r=e[1],s=e[2],o=e[3],a=e[4],h=e[5],l=i[0],u=i[1];return t[0]=n,t[1]=r,t[2]=s,t[3]=o,t[4]=n*l+s*u+a,t[5]=r*l+o*u+h,t},u.str=function(t){return"mat2d("+t[0]+", "+t[1]+", "+t[2]+", "+t[3]+", "+t[4]+", "+t[5]+")"},u.frob=function(t){return Math.sqrt(Math.pow(t[0],2)+Math.pow(t[1],2)+Math.pow(t[2],2)+Math.pow(t[3],2)+Math.pow(t[4],2)+Math.pow(t[5],2)+1)},"undefined"!=typeof t&&(t.mat2d=u);var c={};c.create=function(){var t=new i(9);return t[0]=1,t[1]=0,t[2]=0,t[3]=0,t[4]=1,t[5]=0,t[6]=0,t[7]=0,t[8]=1,t},c.fromMat4=function(t,e){return t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[4],t[4]=e[5],t[5]=e[6],t[6]=e[8],t[7]=e[9],t[8]=e[10],t},c.clone=function(t){var e=new i(9);return e[0]=t[0],e[1]=t[1],e[2]=t[2],e[3]=t[3],e[4]=t[4],e[5]=t[5],e[6]=t[6],e[7]=t[7],e[8]=t[8],e},c.copy=function(t,e){return t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[3],t[4]=e[4],t[5]=e[5],t[6]=e[6],t[7]=e[7],t[8]=e[8],t},c.identity=function(t){return t[0]=1,t[1]=0,t[2]=0,t[3]=0,t[4]=1,t[5]=0,t[6]=0,t[7]=0,t[8]=1,t},c.transpose=function(t,e){if(t===e){var i=e[1],n=e[2],r=e[5];t[1]=e[3],t[2]=e[6],t[3]=i,t[5]=e[7],t[6]=n,t[7]=r}else t[0]=e[0],t[1]=e[3],t[2]=e[6],t[3]=e[1],t[4]=e[4],t[5]=e[7],t[6]=e[2],t[7]=e[5],t[8]=e[8];return t},c.invert=function(t,e){var i=e[0],n=e[1],r=e[2],s=e[3],o=e[4],a=e[5],h=e[6],l=e[7],u=e[8],c=u*o-a*l,p=-u*s+a*h,f=l*s-o*h,d=i*c+n*p+r*f;return d?(d=1/d,t[0]=c*d,t[1]=(-u*n+r*l)*d,t[2]=(a*n-r*o)*d,t[3]=p*d,t[4]=(u*i-r*h)*d,t[5]=(-a*i+r*s)*d,t[6]=f*d,t[7]=(-l*i+n*h)*d,t[8]=(o*i-n*s)*d,t):null},c.adjoint=function(t,e){var i=e[0],n=e[1],r=e[2],s=e[3],o=e[4],a=e[5],h=e[6],l=e[7],u=e[8];return t[0]=o*u-a*l,t[1]=r*l-n*u,t[2]=n*a-r*o,t[3]=a*h-s*u,t[4]=i*u-r*h,t[5]=r*s-i*a,t[6]=s*l-o*h,t[7]=n*h-i*l,t[8]=i*o-n*s,t},c.determinant=function(t){var e=t[0],i=t[1],n=t[2],r=t[3],s=t[4],o=t[5],a=t[6],h=t[7],l=t[8];return e*(l*s-o*h)+i*(-l*r+o*a)+n*(h*r-s*a)},c.multiply=function(t,e,i){var n=e[0],r=e[1],s=e[2],o=e[3],a=e[4],h=e[5],l=e[6],u=e[7],c=e[8],p=i[0],f=i[1],d=i[2],m=i[3],v=i[4],_=i[5],y=i[6],g=i[7],w=i[8];return t[0]=p*n+f*o+d*l,t[1]=p*r+f*a+d*u,t[2]=p*s+f*h+d*c,t[3]=m*n+v*o+_*l,t[4]=m*r+v*a+_*u,t[5]=m*s+v*h+_*c,t[6]=y*n+g*o+w*l,t[7]=y*r+g*a+w*u,t[8]=y*s+g*h+w*c,t},c.mul=c.multiply,c.translate=function(t,e,i){var n=e[0],r=e[1],s=e[2],o=e[3],a=e[4],h=e[5],l=e[6],u=e[7],c=e[8],p=i[0],f=i[1];return t[0]=n,t[1]=r,t[2]=s,t[3]=o,t[4]=a,t[5]=h,t[6]=p*n+f*o+l,t[7]=p*r+f*a+u,t[8]=p*s+f*h+c,t},c.rotate=function(t,e,i){var n=e[0],r=e[1],s=e[2],o=e[3],a=e[4],h=e[5],l=e[6],u=e[7],c=e[8],p=Math.sin(i),f=Math.cos(i);return t[0]=f*n+p*o,t[1]=f*r+p*a,t[2]=f*s+p*h,t[3]=f*o-p*n,t[4]=f*a-p*r,t[5]=f*h-p*s,t[6]=l,t[7]=u,t[8]=c,t},c.scale=function(t,e,i){var n=i[0],r=i[1];return t[0]=n*e[0],t[1]=n*e[1],t[2]=n*e[2],t[3]=r*e[3],t[4]=r*e[4],t[5]=r*e[5],t[6]=e[6],t[7]=e[7],t[8]=e[8],t},c.fromMat2d=function(t,e){return t[0]=e[0],t[1]=e[1],t[2]=0,t[3]=e[2],t[4]=e[3],t[5]=0,t[6]=e[4],t[7]=e[5],t[8]=1,t},c.fromQuat=function(t,e){var i=e[0],n=e[1],r=e[2],s=e[3],o=i+i,a=n+n,h=r+r,l=i*o,u=n*o,c=n*a,p=r*o,f=r*a,d=r*h,m=s*o,v=s*a,_=s*h;return t[0]=1-c-d,t[3]=u-_,t[6]=p+v,t[1]=u+_,t[4]=1-l-d,t[7]=f-m,t[2]=p-v,t[5]=f+m,t[8]=1-l-c,t},c.normalFromMat4=function(t,e){var i=e[0],n=e[1],r=e[2],s=e[3],o=e[4],a=e[5],h=e[6],l=e[7],u=e[8],c=e[9],p=e[10],f=e[11],d=e[12],m=e[13],v=e[14],_=e[15],y=i*a-n*o,g=i*h-r*o,w=i*l-s*o,x=n*h-r*a,b=n*l-s*a,E=r*l-s*h,T=u*m-c*d,M=u*v-p*d,C=u*_-f*d,L=c*v-p*m,S=c*_-f*m,R=p*_-f*v,k=y*R-g*S+w*L+x*C-b*M+E*T;return k?(k=1/k,t[0]=(a*R-h*S+l*L)*k,t[1]=(h*C-o*R-l*M)*k,t[2]=(o*S-a*C+l*T)*k,t[3]=(r*S-n*R-s*L)*k,t[4]=(i*R-r*C+s*M)*k,t[5]=(n*C-i*S-s*T)*k,t[6]=(m*E-v*b+_*x)*k,t[7]=(v*w-d*E-_*g)*k,t[8]=(d*b-m*w+_*y)*k,t):null},c.str=function(t){return"mat3("+t[0]+", "+t[1]+", "+t[2]+", "+t[3]+", "+t[4]+", "+t[5]+", "+t[6]+", "+t[7]+", "+t[8]+")"},c.frob=function(t){return Math.sqrt(Math.pow(t[0],2)+Math.pow(t[1],2)+Math.pow(t[2],2)+Math.pow(t[3],2)+Math.pow(t[4],2)+Math.pow(t[5],2)+Math.pow(t[6],2)+Math.pow(t[7],2)+Math.pow(t[8],2))},"undefined"!=typeof t&&(t.mat3=c);var p={};p.create=function(){var t=new i(16);return t[0]=1,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=1,t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[10]=1,t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,t},p.clone=function(t){var e=new i(16);return e[0]=t[0],e[1]=t[1],e[2]=t[2],e[3]=t[3],e[4]=t[4],e[5]=t[5],e[6]=t[6],e[7]=t[7],e[8]=t[8],e[9]=t[9],e[10]=t[10],e[11]=t[11],e[12]=t[12],e[13]=t[13],e[14]=t[14],e[15]=t[15],e},p.copy=function(t,e){return t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[3],t[4]=e[4],t[5]=e[5],t[6]=e[6],t[7]=e[7],t[8]=e[8],t[9]=e[9],t[10]=e[10],t[11]=e[11],t[12]=e[12],t[13]=e[13],t[14]=e[14],t[15]=e[15],t},p.identity=function(t){return t[0]=1,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=1,t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[10]=1,t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,t},p.transpose=function(t,e){if(t===e){var i=e[1],n=e[2],r=e[3],s=e[6],o=e[7],a=e[11];t[1]=e[4],t[2]=e[8],t[3]=e[12],t[4]=i,t[6]=e[9],t[7]=e[13],t[8]=n,t[9]=s,t[11]=e[14],t[12]=r,t[13]=o,t[14]=a}else t[0]=e[0],t[1]=e[4],t[2]=e[8],t[3]=e[12],t[4]=e[1],t[5]=e[5],t[6]=e[9],t[7]=e[13],t[8]=e[2],t[9]=e[6],t[10]=e[10],t[11]=e[14],t[12]=e[3],t[13]=e[7],t[14]=e[11],t[15]=e[15];return t},p.invert=function(t,e){var i=e[0],n=e[1],r=e[2],s=e[3],o=e[4],a=e[5],h=e[6],l=e[7],u=e[8],c=e[9],p=e[10],f=e[11],d=e[12],m=e[13],v=e[14],_=e[15],y=i*a-n*o,g=i*h-r*o,w=i*l-s*o,x=n*h-r*a,b=n*l-s*a,E=r*l-s*h,T=u*m-c*d,M=u*v-p*d,C=u*_-f*d,L=c*v-p*m,S=c*_-f*m,R=p*_-f*v,k=y*R-g*S+w*L+x*C-b*M+E*T;return k?(k=1/k,t[0]=(a*R-h*S+l*L)*k,t[1]=(r*S-n*R-s*L)*k,t[2]=(m*E-v*b+_*x)*k,t[3]=(p*b-c*E-f*x)*k,t[4]=(h*C-o*R-l*M)*k,t[5]=(i*R-r*C+s*M)*k,t[6]=(v*w-d*E-_*g)*k,t[7]=(u*E-p*w+f*g)*k,t[8]=(o*S-a*C+l*T)*k,t[9]=(n*C-i*S-s*T)*k,t[10]=(d*b-m*w+_*y)*k,t[11]=(c*w-u*b-f*y)*k,t[12]=(a*M-o*L-h*T)*k,t[13]=(i*L-n*M+r*T)*k,t[14]=(m*g-d*x-v*y)*k,t[15]=(u*x-c*g+p*y)*k,t):null},p.adjoint=function(t,e){var i=e[0],n=e[1],r=e[2],s=e[3],o=e[4],a=e[5],h=e[6],l=e[7],u=e[8],c=e[9],p=e[10],f=e[11],d=e[12],m=e[13],v=e[14],_=e[15];return t[0]=a*(p*_-f*v)-c*(h*_-l*v)+m*(h*f-l*p),t[1]=-(n*(p*_-f*v)-c*(r*_-s*v)+m*(r*f-s*p)),t[2]=n*(h*_-l*v)-a*(r*_-s*v)+m*(r*l-s*h),t[3]=-(n*(h*f-l*p)-a*(r*f-s*p)+c*(r*l-s*h)),t[4]=-(o*(p*_-f*v)-u*(h*_-l*v)+d*(h*f-l*p)),t[5]=i*(p*_-f*v)-u*(r*_-s*v)+d*(r*f-s*p),t[6]=-(i*(h*_-l*v)-o*(r*_-s*v)+d*(r*l-s*h)),t[7]=i*(h*f-l*p)-o*(r*f-s*p)+u*(r*l-s*h),t[8]=o*(c*_-f*m)-u*(a*_-l*m)+d*(a*f-l*c),t[9]=-(i*(c*_-f*m)-u*(n*_-s*m)+d*(n*f-s*c)),t[10]=i*(a*_-l*m)-o*(n*_-s*m)+d*(n*l-s*a),t[11]=-(i*(a*f-l*c)-o*(n*f-s*c)+u*(n*l-s*a)),t[12]=-(o*(c*v-p*m)-u*(a*v-h*m)+d*(a*p-h*c)),t[13]=i*(c*v-p*m)-u*(n*v-r*m)+d*(n*p-r*c),t[14]=-(i*(a*v-h*m)-o*(n*v-r*m)+d*(n*h-r*a)),t[15]=i*(a*p-h*c)-o*(n*p-r*c)+u*(n*h-r*a),t},p.determinant=function(t){var e=t[0],i=t[1],n=t[2],r=t[3],s=t[4],o=t[5],a=t[6],h=t[7],l=t[8],u=t[9],c=t[10],p=t[11],f=t[12],d=t[13],m=t[14],v=t[15],_=e*o-i*s,y=e*a-n*s,g=e*h-r*s,w=i*a-n*o,x=i*h-r*o,b=n*h-r*a,E=l*d-u*f,T=l*m-c*f,M=l*v-p*f,C=u*m-c*d,L=u*v-p*d,S=c*v-p*m;return _*S-y*L+g*C+w*M-x*T+b*E},p.multiply=function(t,e,i){var n=e[0],r=e[1],s=e[2],o=e[3],a=e[4],h=e[5],l=e[6],u=e[7],c=e[8],p=e[9],f=e[10],d=e[11],m=e[12],v=e[13],_=e[14],y=e[15],g=i[0],w=i[1],x=i[2],b=i[3];return t[0]=g*n+w*a+x*c+b*m,t[1]=g*r+w*h+x*p+b*v,t[2]=g*s+w*l+x*f+b*_,t[3]=g*o+w*u+x*d+b*y,g=i[4],w=i[5],x=i[6],b=i[7],t[4]=g*n+w*a+x*c+b*m,t[5]=g*r+w*h+x*p+b*v,t[6]=g*s+w*l+x*f+b*_,t[7]=g*o+w*u+x*d+b*y,g=i[8],w=i[9],x=i[10],b=i[11],t[8]=g*n+w*a+x*c+b*m,t[9]=g*r+w*h+x*p+b*v,t[10]=g*s+w*l+x*f+b*_,t[11]=g*o+w*u+x*d+b*y,g=i[12],w=i[13],x=i[14],b=i[15],t[12]=g*n+w*a+x*c+b*m,t[13]=g*r+w*h+x*p+b*v,t[14]=g*s+w*l+x*f+b*_,t[15]=g*o+w*u+x*d+b*y,t},p.mul=p.multiply,p.translate=function(t,e,i){var n,r,s,o,a,h,l,u,c,p,f,d,m=i[0],v=i[1],_=i[2];return e===t?(t[12]=e[0]*m+e[4]*v+e[8]*_+e[12],t[13]=e[1]*m+e[5]*v+e[9]*_+e[13],t[14]=e[2]*m+e[6]*v+e[10]*_+e[14],t[15]=e[3]*m+e[7]*v+e[11]*_+e[15]):(n=e[0],r=e[1],s=e[2],o=e[3],a=e[4],h=e[5],l=e[6],u=e[7],c=e[8],p=e[9],f=e[10],d=e[11],t[0]=n,t[1]=r,t[2]=s,t[3]=o,t[4]=a,t[5]=h,t[6]=l,t[7]=u,t[8]=c,t[9]=p,t[10]=f,t[11]=d,t[12]=n*m+a*v+c*_+e[12],t[13]=r*m+h*v+p*_+e[13],t[14]=s*m+l*v+f*_+e[14],t[15]=o*m+u*v+d*_+e[15]),t},p.scale=function(t,e,i){var n=i[0],r=i[1],s=i[2];return t[0]=e[0]*n,t[1]=e[1]*n,t[2]=e[2]*n,t[3]=e[3]*n,t[4]=e[4]*r,t[5]=e[5]*r,t[6]=e[6]*r,t[7]=e[7]*r,t[8]=e[8]*s,t[9]=e[9]*s,t[10]=e[10]*s,t[11]=e[11]*s,t[12]=e[12],t[13]=e[13],t[14]=e[14],t[15]=e[15],t},p.rotate=function(t,i,n,r){var s,o,a,h,l,u,c,p,f,d,m,v,_,y,g,w,x,b,E,T,M,C,L,S,R=r[0],k=r[1],A=r[2],z=Math.sqrt(R*R+k*k+A*A);return Math.abs(z)<e?null:(z=1/z,R*=z,k*=z,A*=z,s=Math.sin(n),o=Math.cos(n),a=1-o,h=i[0],l=i[1],u=i[2],c=i[3],p=i[4],f=i[5],d=i[6],m=i[7],v=i[8],_=i[9],y=i[10],g=i[11],w=R*R*a+o,x=k*R*a+A*s,b=A*R*a-k*s,E=R*k*a-A*s,T=k*k*a+o,M=A*k*a+R*s,C=R*A*a+k*s,L=k*A*a-R*s,S=A*A*a+o,t[0]=h*w+p*x+v*b,t[1]=l*w+f*x+_*b,t[2]=u*w+d*x+y*b,t[3]=c*w+m*x+g*b,t[4]=h*E+p*T+v*M,t[5]=l*E+f*T+_*M,t[6]=u*E+d*T+y*M,t[7]=c*E+m*T+g*M,t[8]=h*C+p*L+v*S,t[9]=l*C+f*L+_*S,t[10]=u*C+d*L+y*S,t[11]=c*C+m*L+g*S,i!==t&&(t[12]=i[12],t[13]=i[13],t[14]=i[14],t[15]=i[15]),t)},p.rotateX=function(t,e,i){var n=Math.sin(i),r=Math.cos(i),s=e[4],o=e[5],a=e[6],h=e[7],l=e[8],u=e[9],c=e[10],p=e[11];return e!==t&&(t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[3],t[12]=e[12],t[13]=e[13],t[14]=e[14],t[15]=e[15]),t[4]=s*r+l*n,t[5]=o*r+u*n,t[6]=a*r+c*n,t[7]=h*r+p*n,t[8]=l*r-s*n,t[9]=u*r-o*n,t[10]=c*r-a*n,t[11]=p*r-h*n,t},p.rotateY=function(t,e,i){var n=Math.sin(i),r=Math.cos(i),s=e[0],o=e[1],a=e[2],h=e[3],l=e[8],u=e[9],c=e[10],p=e[11];return e!==t&&(t[4]=e[4],t[5]=e[5],t[6]=e[6],t[7]=e[7],t[12]=e[12],t[13]=e[13],t[14]=e[14],t[15]=e[15]),t[0]=s*r-l*n,t[1]=o*r-u*n,t[2]=a*r-c*n,t[3]=h*r-p*n,t[8]=s*n+l*r,t[9]=o*n+u*r,t[10]=a*n+c*r,t[11]=h*n+p*r,t},p.rotateZ=function(t,e,i){var n=Math.sin(i),r=Math.cos(i),s=e[0],o=e[1],a=e[2],h=e[3],l=e[4],u=e[5],c=e[6],p=e[7];return e!==t&&(t[8]=e[8],t[9]=e[9],t[10]=e[10],t[11]=e[11],t[12]=e[12],t[13]=e[13],t[14]=e[14],t[15]=e[15]),t[0]=s*r+l*n,t[1]=o*r+u*n,t[2]=a*r+c*n,t[3]=h*r+p*n,t[4]=l*r-s*n,t[5]=u*r-o*n,t[6]=c*r-a*n,t[7]=p*r-h*n,t},p.fromRotationTranslation=function(t,e,i){var n=e[0],r=e[1],s=e[2],o=e[3],a=n+n,h=r+r,l=s+s,u=n*a,c=n*h,p=n*l,f=r*h,d=r*l,m=s*l,v=o*a,_=o*h,y=o*l;return t[0]=1-(f+m),t[1]=c+y,t[2]=p-_,t[3]=0,t[4]=c-y,t[5]=1-(u+m),t[6]=d+v,t[7]=0,t[8]=p+_,t[9]=d-v,t[10]=1-(u+f),t[11]=0,t[12]=i[0],t[13]=i[1],t[14]=i[2],t[15]=1,t},p.fromQuat=function(t,e){var i=e[0],n=e[1],r=e[2],s=e[3],o=i+i,a=n+n,h=r+r,l=i*o,u=n*o,c=n*a,p=r*o,f=r*a,d=r*h,m=s*o,v=s*a,_=s*h;return t[0]=1-c-d,t[1]=u+_,t[2]=p-v,t[3]=0,t[4]=u-_,t[5]=1-l-d,t[6]=f+m,t[7]=0,t[8]=p+v,t[9]=f-m,t[10]=1-l-c,t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,t},p.frustum=function(t,e,i,n,r,s,o){var a=1/(i-e),h=1/(r-n),l=1/(s-o);return t[0]=2*s*a,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=2*s*h,t[6]=0,t[7]=0,t[8]=(i+e)*a,t[9]=(r+n)*h,t[10]=(o+s)*l,t[11]=-1,t[12]=0,t[13]=0,t[14]=o*s*2*l,t[15]=0,t},p.perspective=function(t,e,i,n,r){var s=1/Math.tan(e/2),o=1/(n-r);return t[0]=s/i,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=s,t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[10]=(r+n)*o,t[11]=-1,t[12]=0,t[13]=0,t[14]=2*r*n*o,t[15]=0,t},p.ortho=function(t,e,i,n,r,s,o){var a=1/(e-i),h=1/(n-r),l=1/(s-o);return t[0]=-2*a,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=-2*h,t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[10]=2*l,t[11]=0,t[12]=(e+i)*a,t[13]=(r+n)*h,t[14]=(o+s)*l,t[15]=1,t},p.lookAt=function(t,i,n,r){var s,o,a,h,l,u,c,f,d,m,v=i[0],_=i[1],y=i[2],g=r[0],w=r[1],x=r[2],b=n[0],E=n[1],T=n[2];return Math.abs(v-b)<e&&Math.abs(_-E)<e&&Math.abs(y-T)<e?p.identity(t):(c=v-b,f=_-E,d=y-T,m=1/Math.sqrt(c*c+f*f+d*d),c*=m,f*=m,d*=m,s=w*d-x*f,o=x*c-g*d,a=g*f-w*c,m=Math.sqrt(s*s+o*o+a*a),m?(m=1/m,s*=m,o*=m,a*=m):(s=0,o=0,a=0),h=f*a-d*o,l=d*s-c*a,u=c*o-f*s,m=Math.sqrt(h*h+l*l+u*u),m?(m=1/m,h*=m,l*=m,u*=m):(h=0,l=0,u=0),t[0]=s,t[1]=h,t[2]=c,t[3]=0,t[4]=o,t[5]=l,t[6]=f,t[7]=0,t[8]=a,t[9]=u,t[10]=d,t[11]=0,t[12]=-(s*v+o*_+a*y),t[13]=-(h*v+l*_+u*y),t[14]=-(c*v+f*_+d*y),t[15]=1,t)},p.str=function(t){return"mat4("+t[0]+", "+t[1]+", "+t[2]+", "+t[3]+", "+t[4]+", "+t[5]+", "+t[6]+", "+t[7]+", "+t[8]+", "+t[9]+", "+t[10]+", "+t[11]+", "+t[12]+", "+t[13]+", "+t[14]+", "+t[15]+")"},p.frob=function(t){return Math.sqrt(Math.pow(t[0],2)+Math.pow(t[1],2)+Math.pow(t[2],2)+Math.pow(t[3],2)+Math.pow(t[4],2)+Math.pow(t[5],2)+Math.pow(t[6],2)+Math.pow(t[6],2)+Math.pow(t[7],2)+Math.pow(t[8],2)+Math.pow(t[9],2)+Math.pow(t[10],2)+Math.pow(t[11],2)+Math.pow(t[12],2)+Math.pow(t[13],2)+Math.pow(t[14],2)+Math.pow(t[15],2))},"undefined"!=typeof t&&(t.mat4=p);var f={};f.create=function(){var t=new i(4);return t[0]=0,t[1]=0,t[2]=0,t[3]=1,t},f.rotationTo=function(){var t=a.create(),e=a.fromValues(1,0,0),i=a.fromValues(0,1,0);return function(n,r,s){var o=a.dot(r,s);return-.999999>o?(a.cross(t,e,r),a.length(t)<1e-6&&a.cross(t,i,r),a.normalize(t,t),f.setAxisAngle(n,t,Math.PI),n):o>.999999?(n[0]=0,n[1]=0,n[2]=0,n[3]=1,n):(a.cross(t,r,s),n[0]=t[0],n[1]=t[1],n[2]=t[2],n[3]=1+o,f.normalize(n,n))}}(),f.setAxes=function(){var t=c.create();return function(e,i,n,r){return t[0]=n[0],t[3]=n[1],t[6]=n[2],t[1]=r[0],t[4]=r[1],t[7]=r[2],t[2]=-i[0],t[5]=-i[1],t[8]=-i[2],f.normalize(e,f.fromMat3(e,t))}}(),f.clone=h.clone,f.fromValues=h.fromValues,f.copy=h.copy,f.set=h.set,f.identity=function(t){return t[0]=0,t[1]=0,t[2]=0,t[3]=1,t},f.setAxisAngle=function(t,e,i){i=.5*i;var n=Math.sin(i);return t[0]=n*e[0],t[1]=n*e[1],t[2]=n*e[2],t[3]=Math.cos(i),t},f.add=h.add,f.multiply=function(t,e,i){var n=e[0],r=e[1],s=e[2],o=e[3],a=i[0],h=i[1],l=i[2],u=i[3];return t[0]=n*u+o*a+r*l-s*h,t[1]=r*u+o*h+s*a-n*l,t[2]=s*u+o*l+n*h-r*a,t[3]=o*u-n*a-r*h-s*l,t},f.mul=f.multiply,f.scale=h.scale,f.rotateX=function(t,e,i){i*=.5;var n=e[0],r=e[1],s=e[2],o=e[3],a=Math.sin(i),h=Math.cos(i);return t[0]=n*h+o*a,t[1]=r*h+s*a,t[2]=s*h-r*a,t[3]=o*h-n*a,t},f.rotateY=function(t,e,i){i*=.5;var n=e[0],r=e[1],s=e[2],o=e[3],a=Math.sin(i),h=Math.cos(i);return t[0]=n*h-s*a,t[1]=r*h+o*a,t[2]=s*h+n*a,t[3]=o*h-r*a,t},f.rotateZ=function(t,e,i){i*=.5;var n=e[0],r=e[1],s=e[2],o=e[3],a=Math.sin(i),h=Math.cos(i);return t[0]=n*h+r*a,t[1]=r*h-n*a,t[2]=s*h+o*a,t[3]=o*h-s*a,t},f.calculateW=function(t,e){var i=e[0],n=e[1],r=e[2];return t[0]=i,t[1]=n,t[2]=r,t[3]=-Math.sqrt(Math.abs(1-i*i-n*n-r*r)),t},f.dot=h.dot,f.lerp=h.lerp,f.slerp=function(t,e,i,n){var r,s,o,a,h,l=e[0],u=e[1],c=e[2],p=e[3],f=i[0],d=i[1],m=i[2],v=i[3];return s=l*f+u*d+c*m+p*v,0>s&&(s=-s,f=-f,d=-d,m=-m,v=-v),1-s>1e-6?(r=Math.acos(s),o=Math.sin(r),a=Math.sin((1-n)*r)/o,h=Math.sin(n*r)/o):(a=1-n,h=n),t[0]=a*l+h*f,t[1]=a*u+h*d,t[2]=a*c+h*m,t[3]=a*p+h*v,t},f.invert=function(t,e){var i=e[0],n=e[1],r=e[2],s=e[3],o=i*i+n*n+r*r+s*s,a=o?1/o:0;return t[0]=-i*a,t[1]=-n*a,t[2]=-r*a,t[3]=s*a,t},f.conjugate=function(t,e){return t[0]=-e[0],t[1]=-e[1],t[2]=-e[2],t[3]=e[3],t},f.length=h.length,f.len=f.length,f.squaredLength=h.squaredLength,f.sqrLen=f.squaredLength,f.normalize=h.normalize,f.fromMat3=function(t,e){var i,n=e[0]+e[4]+e[8];if(n>0)i=Math.sqrt(n+1),t[3]=.5*i,i=.5/i,t[0]=(e[7]-e[5])*i,t[1]=(e[2]-e[6])*i,t[2]=(e[3]-e[1])*i;else{var r=0;e[4]>e[0]&&(r=1),e[8]>e[3*r+r]&&(r=2);var s=(r+1)%3,o=(r+2)%3;i=Math.sqrt(e[3*r+r]-e[3*s+s]-e[3*o+o]+1),t[r]=.5*i,i=.5/i,t[3]=(e[3*o+s]-e[3*s+o])*i,t[s]=(e[3*s+r]+e[3*r+s])*i,t[o]=(e[3*o+r]+e[3*r+o])*i}return t},f.str=function(t){return"quat("+t[0]+", "+t[1]+", "+t[2]+", "+t[3]+")"},"undefined"!=typeof t&&(t.quat=f)}(i.exports)}(this)},{}],3:[function(e,i,n){!function(e,n,r,s){"use strict";function o(t,e,i){return setTimeout(f(t,i),e)}function a(t,e,i){return Array.isArray(t)?(h(t,i[e],i),!0):!1}function h(t,e,i){var n;if(t)if(t.forEach)t.forEach(e,i);else if(t.length!==s)for(n=0;n<t.length;)e.call(i,t[n],n,t),n++;else for(n in t)t.hasOwnProperty(n)&&e.call(i,t[n],n,t)}function l(t,e,i){for(var n=Object.keys(e),r=0;r<n.length;)(!i||i&&t[n[r]]===s)&&(t[n[r]]=e[n[r]]),r++;return t}function u(t,e){
return l(t,e,!0)}function c(t){if(Object.create)return Object.create(t);var e=function(){};e.prototype=t;var i=new e;return e.prototype=null,i}function p(t,e,i){var n,r=e.prototype;n=t.prototype=c(r),n.constructor=t,n._super=r,i&&l(n,i)}function f(t,e){return function(){return t.apply(e,arguments)}}function d(t,e){return typeof t==ft?t.apply(e?e[0]||s:s,e):t}function m(t,e){return t===s?e:t}function v(t,e,i){h(w(e),function(e){t.addEventListener(e,i,!1)})}function _(t,e,i){h(w(e),function(e){t.removeEventListener(e,i,!1)})}function y(t,e){for(;t;){if(t==e)return!0;t=t.parentNode}return!1}function g(t,e){return t.indexOf(e)>-1}function w(t){return t.trim().split(/\s+/g)}function x(t,e,i){if(t.indexOf&&!i)return t.indexOf(e);for(var n=0;n<t.length;){if(i&&t[n][i]==e||!i&&t[n]===e)return n;n++}return-1}function b(t){return Array.prototype.slice.call(t,0)}function E(t,e,i){for(var n=[],r=[],s=0;s<t.length;){var o=e?t[s][e]:t[s];x(r,o)<0&&n.push(t[s]),r[s]=o,s++}return i&&(n=e?n.sort(function(t,i){return t[e]>i[e]}):n.sort()),n}function T(t,e){for(var i,n,r=e[0].toUpperCase()+e.slice(1),o=0;o<ct.length;){if(i=ct[o],n=i?i+r:e,n in t)return n;o++}return s}function M(){return _t++}function C(t){var i=t.ownerDocument||t;return i.defaultView||i.parentWindow||e}function L(t,e){var i=this;this.manager=t,this.callback=e,this.element=t.element,this.target=t.options.inputTarget,this.domHandler=function(e){d(t.options.enable,[t])&&i.handler(e)},this.init()}function S(t){var e,i=t.options.inputClass;return new(e=i?i:wt?N:xt?X:gt?U:V)(t,R)}function R(t,e,i){var n=i.pointers.length,r=i.changedPointers.length,s=e&Lt&&n-r===0,o=e&(Rt|kt)&&n-r===0;i.isFirst=!!s,i.isFinal=!!o,s&&(t.session={}),i.eventType=e,k(t,i),t.emit("hammer.input",i),t.recognize(i),t.session.prevInput=i}function k(t,e){var i=t.session,n=e.pointers,r=n.length;i.firstInput||(i.firstInput=I(e)),r>1&&!i.firstMultiple?i.firstMultiple=I(e):1===r&&(i.firstMultiple=!1);var s=i.firstInput,o=i.firstMultiple,a=o?o.center:s.center,h=e.center=F(n);e.timeStamp=vt(),e.deltaTime=e.timeStamp-s.timeStamp,e.angle=O(a,h),e.distance=H(a,h),A(i,e),e.offsetDirection=D(e.deltaX,e.deltaY),e.scale=o?B(o.pointers,n):1,e.rotation=o?q(o.pointers,n):0,z(i,e);var l=t.element;y(e.srcEvent.target,l)&&(l=e.srcEvent.target),e.target=l}function A(t,e){var i=e.center,n=t.offsetDelta||{},r=t.prevDelta||{},s=t.prevInput||{};(e.eventType===Lt||s.eventType===Rt)&&(r=t.prevDelta={x:s.deltaX||0,y:s.deltaY||0},n=t.offsetDelta={x:i.x,y:i.y}),e.deltaX=r.x+(i.x-n.x),e.deltaY=r.y+(i.y-n.y)}function z(t,e){var i,n,r,o,a=t.lastInterval||e,h=e.timeStamp-a.timeStamp;if(e.eventType!=kt&&(h>Ct||a.velocity===s)){var l=a.deltaX-e.deltaX,u=a.deltaY-e.deltaY,c=P(h,l,u);n=c.x,r=c.y,i=mt(c.x)>mt(c.y)?c.x:c.y,o=D(l,u),t.lastInterval=e}else i=a.velocity,n=a.velocityX,r=a.velocityY,o=a.direction;e.velocity=i,e.velocityX=n,e.velocityY=r,e.direction=o}function I(t){for(var e=[],i=0;i<t.pointers.length;)e[i]={clientX:dt(t.pointers[i].clientX),clientY:dt(t.pointers[i].clientY)},i++;return{timeStamp:vt(),pointers:e,center:F(e),deltaX:t.deltaX,deltaY:t.deltaY}}function F(t){var e=t.length;if(1===e)return{x:dt(t[0].clientX),y:dt(t[0].clientY)};for(var i=0,n=0,r=0;e>r;)i+=t[r].clientX,n+=t[r].clientY,r++;return{x:dt(i/e),y:dt(n/e)}}function P(t,e,i){return{x:e/t||0,y:i/t||0}}function D(t,e){return t===e?At:mt(t)>=mt(e)?t>0?zt:It:e>0?Ft:Pt}function H(t,e,i){i||(i=qt);var n=e[i[0]]-t[i[0]],r=e[i[1]]-t[i[1]];return Math.sqrt(n*n+r*r)}function O(t,e,i){i||(i=qt);var n=e[i[0]]-t[i[0]],r=e[i[1]]-t[i[1]];return 180*Math.atan2(r,n)/Math.PI}function q(t,e){return O(e[1],e[0],Bt)-O(t[1],t[0],Bt)}function B(t,e){return H(e[0],e[1],Bt)/H(t[0],t[1],Bt)}function V(){this.evEl=Nt,Wt?this.evDoc=Yt:this.evWin=Yt,this.allow=!0,this.pressed=!1,L.apply(this,arguments)}function N(){this.evEl=Ut,this.evWin=jt,L.apply(this,arguments),this.store=this.manager.session.pointerEvents=[]}function Y(){this.evTarget=Zt,this.evWin=Kt,this.started=!1,L.apply(this,arguments)}function W(t,e){var i=b(t.touches),n=b(t.changedTouches);return e&(Rt|kt)&&(i=E(i.concat(n),"identifier",!0)),[i,n]}function X(){this.evTarget=$t,this.targetIds={},L.apply(this,arguments)}function G(t,e){var i=b(t.touches),n=this.targetIds;if(e&(Lt|St)&&1===i.length)return n[i[0].identifier]=!0,[i,i];var r,s,o=b(t.changedTouches),a=[],h=this.target;if(s=i.filter(function(t){return y(t.target,h)}),e===Lt)for(r=0;r<s.length;)n[s[r].identifier]=!0,r++;for(r=0;r<o.length;)n[o[r].identifier]&&a.push(o[r]),e&(Rt|kt)&&delete n[o[r].identifier],r++;return a.length?[E(s.concat(a),"identifier",!0),a]:void 0}function U(){L.apply(this,arguments);var t=f(this.handler,this);this.touch=new X(this.manager,t),this.mouse=new V(this.manager,t)}function j(t,e){this.manager=t,this.set(e)}function Q(t){if(g(t,se))return se;var e=g(t,oe),i=g(t,ae);return e&&i?oe+" "+ae:e||i?e?oe:ae:g(t,re)?re:ne}function Z(t){this.id=M(),this.manager=null,this.options=u(t||{},this.defaults),this.options.enable=m(this.options.enable,!0),this.state=he,this.simultaneous={},this.requireFail=[]}function K(t){return t&fe?"cancel":t&ce?"end":t&ue?"move":t&le?"start":""}function J(t){return t==Pt?"down":t==Ft?"up":t==zt?"left":t==It?"right":""}function $(t,e){var i=e.manager;return i?i.get(t):t}function tt(){Z.apply(this,arguments)}function et(){tt.apply(this,arguments),this.pX=null,this.pY=null}function it(){tt.apply(this,arguments)}function nt(){Z.apply(this,arguments),this._timer=null,this._input=null}function rt(){tt.apply(this,arguments)}function st(){tt.apply(this,arguments)}function ot(){Z.apply(this,arguments),this.pTime=!1,this.pCenter=!1,this._timer=null,this._input=null,this.count=0}function at(t,e){return e=e||{},e.recognizers=m(e.recognizers,at.defaults.preset),new ht(t,e)}function ht(t,e){e=e||{},this.options=u(e,at.defaults),this.options.inputTarget=this.options.inputTarget||t,this.handlers={},this.session={},this.recognizers=[],this.element=t,this.input=S(this),this.touchAction=new j(this,this.options.touchAction),lt(this,!0),h(e.recognizers,function(t){var e=this.add(new t[0](t[1]));t[2]&&e.recognizeWith(t[2]),t[3]&&e.requireFailure(t[3])},this)}function lt(t,e){var i=t.element;i.style&&h(t.options.cssProps,function(t,n){i.style[T(i.style,n)]=e?t:""})}function ut(t,e){var i=n.createEvent("Event");i.initEvent(t,!0,!0),i.gesture=e,e.target.dispatchEvent(i)}var ct=["","webkit","moz","MS","ms","o"],pt=n.createElement("div"),ft="function",dt=Math.round,mt=Math.abs,vt=Date.now,_t=1,yt=/mobile|tablet|ip(ad|hone|od)|android/i,gt="ontouchstart"in e,wt=T(e,"PointerEvent")!==s,xt=gt&&yt.test(navigator.userAgent),bt="touch",Et="pen",Tt="mouse",Mt="kinect",Ct=25,Lt=1,St=2,Rt=4,kt=8,At=1,zt=2,It=4,Ft=8,Pt=16,Dt=zt|It,Ht=Ft|Pt,Ot=Dt|Ht,qt=["x","y"],Bt=["clientX","clientY"];L.prototype={handler:function(){},init:function(){this.evEl&&v(this.element,this.evEl,this.domHandler),this.evTarget&&v(this.target,this.evTarget,this.domHandler),this.evWin&&v(C(this.element),this.evWin,this.domHandler),this.evDoc&&v(n,this.evDoc,this.domHandler),this.evBody&&v(n.body,this.evBody,this.domHandler)},destroy:function(){this.evEl&&_(this.element,this.evEl,this.domHandler),this.evTarget&&_(this.target,this.evTarget,this.domHandler),this.evWin&&_(C(this.element),this.evWin,this.domHandler),this.evDoc&&_(n,this.evDoc,this.domHandler),this.evBody&&_(n.body,this.evBody,this.domHandler)}};var Vt={mousedown:Lt,mousemove:St,mouseup:Rt},Nt="mousedown",Yt="mousemove mouseup",Wt=e.navigator.userAgent.indexOf("MSIE 8")>0;p(V,L,{handler:function(t){var e=Vt[t.type],i=0;Wt&&(i=1),e&Lt&&t.button===i&&(this.pressed=!0),e&St&&t.button!==i&&(e=Rt),this.pressed&&this.allow&&(e&Rt&&(this.pressed=!1),this.callback(this.manager,e,{pointers:[t],changedPointers:[t],pointerType:Tt,srcEvent:t}))}});var Xt={pointerdown:Lt,pointermove:St,pointerup:Rt,pointercancel:kt,pointerout:kt},Gt={2:bt,3:Et,4:Tt,5:Mt},Ut="pointerdown",jt="pointermove pointerup pointercancel";e.MSPointerEvent&&(Ut="MSPointerDown",jt="MSPointerMove MSPointerUp MSPointerCancel"),p(N,L,{handler:function(t){var e=this.store,i=!1,n=t.type.toLowerCase().replace("ms",""),r=Xt[n],s=Gt[t.pointerType]||t.pointerType,o=s==bt,a=x(e,t.pointerId,"pointerId");r&Lt&&(0===t.button||o)?0>a&&(e.push(t),a=e.length-1):r&(Rt|kt)&&(i=!0),0>a||(e[a]=t,this.callback(this.manager,r,{pointers:e,changedPointers:[t],pointerType:s,srcEvent:t}),i&&e.splice(a,1))}});var Qt={touchstart:Lt,touchmove:St,touchend:Rt,touchcancel:kt},Zt="touchstart",Kt="touchstart touchmove touchend touchcancel";p(Y,L,{handler:function(t){var e=Qt[t.type];if(e===Lt&&(this.started=!0),this.started){var i=W.call(this,t,e);e&(Rt|kt)&&i[0].length-i[1].length===0&&(this.started=!1),this.callback(this.manager,e,{pointers:i[0],changedPointers:i[1],pointerType:bt,srcEvent:t})}}});var Jt={touchstart:Lt,touchmove:St,touchend:Rt,touchcancel:kt},$t="touchstart touchmove touchend touchcancel";p(X,L,{handler:function(t){var e=Jt[t.type],i=G.call(this,t,e);i&&this.callback(this.manager,e,{pointers:i[0],changedPointers:i[1],pointerType:bt,srcEvent:t})}}),p(U,L,{handler:function(t,e,i){var n=i.pointerType==bt,r=i.pointerType==Tt;if(n)this.mouse.allow=!1;else if(r&&!this.mouse.allow)return;e&(Rt|kt)&&(this.mouse.allow=!0),this.callback(t,e,i)},destroy:function(){this.touch.destroy(),this.mouse.destroy()}});var te=T(pt.style,"touchAction"),ee=te!==s,ie="compute",ne="auto",re="manipulation",se="none",oe="pan-x",ae="pan-y";j.prototype={set:function(t){t==ie&&(t=this.compute()),ee&&this.manager.element.style&&(this.manager.element.style[te]=t),this.actions=t.toLowerCase().trim()},update:function(){this.set(this.manager.options.touchAction)},compute:function(){var t=[];return h(this.manager.recognizers,function(e){d(e.options.enable,[e])&&(t=t.concat(e.getTouchAction()))}),Q(t.join(" "))},preventDefaults:function(t){if(!ee){var e=t.srcEvent,i=t.offsetDirection;if(this.manager.session.prevented)return void e.preventDefault();var n=this.actions,r=g(n,se),s=g(n,ae),o=g(n,oe);return r||s&&i&Dt||o&&i&Ht?this.preventSrc(e):void 0}},preventSrc:function(t){this.manager.session.prevented=!0,t.preventDefault()}};var he=1,le=2,ue=4,ce=8,pe=ce,fe=16,de=32;Z.prototype={defaults:{},set:function(t){return l(this.options,t),this.manager&&this.manager.touchAction.update(),this},recognizeWith:function(t){if(a(t,"recognizeWith",this))return this;var e=this.simultaneous;return t=$(t,this),e[t.id]||(e[t.id]=t,t.recognizeWith(this)),this},dropRecognizeWith:function(t){return a(t,"dropRecognizeWith",this)?this:(t=$(t,this),delete this.simultaneous[t.id],this)},requireFailure:function(t){if(a(t,"requireFailure",this))return this;var e=this.requireFail;return t=$(t,this),-1===x(e,t)&&(e.push(t),t.requireFailure(this)),this},dropRequireFailure:function(t){if(a(t,"dropRequireFailure",this))return this;t=$(t,this);var e=x(this.requireFail,t);return e>-1&&this.requireFail.splice(e,1),this},hasRequireFailures:function(){return this.requireFail.length>0},canRecognizeWith:function(t){return!!this.simultaneous[t.id]},emit:function(t){function e(e){i.manager.emit(i.options.event+(e?K(n):""),t)}var i=this,n=this.state;ce>n&&e(!0),e(),n>=ce&&e(!0)},tryEmit:function(t){return this.canEmit()?this.emit(t):void(this.state=de)},canEmit:function(){for(var t=0;t<this.requireFail.length;){if(!(this.requireFail[t].state&(de|he)))return!1;t++}return!0},recognize:function(t){var e=l({},t);return d(this.options.enable,[this,e])?(this.state&(pe|fe|de)&&(this.state=he),this.state=this.process(e),void(this.state&(le|ue|ce|fe)&&this.tryEmit(e))):(this.reset(),void(this.state=de))},process:function(t){},getTouchAction:function(){},reset:function(){}},p(tt,Z,{defaults:{pointers:1},attrTest:function(t){var e=this.options.pointers;return 0===e||t.pointers.length===e},process:function(t){var e=this.state,i=t.eventType,n=e&(le|ue),r=this.attrTest(t);return n&&(i&kt||!r)?e|fe:n||r?i&Rt?e|ce:e&le?e|ue:le:de}}),p(et,tt,{defaults:{event:"pan",threshold:10,pointers:1,direction:Ot},getTouchAction:function(){var t=this.options.direction,e=[];return t&Dt&&e.push(ae),t&Ht&&e.push(oe),e},directionTest:function(t){var e=this.options,i=!0,n=t.distance,r=t.direction,s=t.deltaX,o=t.deltaY;return r&e.direction||(e.direction&Dt?(r=0===s?At:0>s?zt:It,i=s!=this.pX,n=Math.abs(t.deltaX)):(r=0===o?At:0>o?Ft:Pt,i=o!=this.pY,n=Math.abs(t.deltaY))),t.direction=r,i&&n>e.threshold&&r&e.direction},attrTest:function(t){return tt.prototype.attrTest.call(this,t)&&(this.state&le||!(this.state&le)&&this.directionTest(t))},emit:function(t){this.pX=t.deltaX,this.pY=t.deltaY;var e=J(t.direction);e&&this.manager.emit(this.options.event+e,t),this._super.emit.call(this,t)}}),p(it,tt,{defaults:{event:"pinch",threshold:0,pointers:2},getTouchAction:function(){return[se]},attrTest:function(t){return this._super.attrTest.call(this,t)&&(Math.abs(t.scale-1)>this.options.threshold||this.state&le)},emit:function(t){if(this._super.emit.call(this,t),1!==t.scale){var e=t.scale<1?"in":"out";this.manager.emit(this.options.event+e,t)}}}),p(nt,Z,{defaults:{event:"press",pointers:1,time:500,threshold:5},getTouchAction:function(){return[ne]},process:function(t){var e=this.options,i=t.pointers.length===e.pointers,n=t.distance<e.threshold,r=t.deltaTime>e.time;if(this._input=t,!n||!i||t.eventType&(Rt|kt)&&!r)this.reset();else if(t.eventType&Lt)this.reset(),this._timer=o(function(){this.state=pe,this.tryEmit()},e.time,this);else if(t.eventType&Rt)return pe;return de},reset:function(){clearTimeout(this._timer)},emit:function(t){this.state===pe&&(t&&t.eventType&Rt?this.manager.emit(this.options.event+"up",t):(this._input.timeStamp=vt(),this.manager.emit(this.options.event,this._input)))}}),p(rt,tt,{defaults:{event:"rotate",threshold:0,pointers:2},getTouchAction:function(){return[se]},attrTest:function(t){return this._super.attrTest.call(this,t)&&(Math.abs(t.rotation)>this.options.threshold||this.state&le)}}),p(st,tt,{defaults:{event:"swipe",threshold:10,velocity:.65,direction:Dt|Ht,pointers:1},getTouchAction:function(){return et.prototype.getTouchAction.call(this)},attrTest:function(t){var e,i=this.options.direction;return i&(Dt|Ht)?e=t.velocity:i&Dt?e=t.velocityX:i&Ht&&(e=t.velocityY),this._super.attrTest.call(this,t)&&i&t.direction&&t.distance>this.options.threshold&&mt(e)>this.options.velocity&&t.eventType&Rt},emit:function(t){var e=J(t.direction);e&&this.manager.emit(this.options.event+e,t),this.manager.emit(this.options.event,t)}}),p(ot,Z,{defaults:{event:"tap",pointers:1,taps:1,interval:300,time:250,threshold:2,posThreshold:10},getTouchAction:function(){return[re]},process:function(t){var e=this.options,i=t.pointers.length===e.pointers,n=t.distance<e.threshold,r=t.deltaTime<e.time;if(this.reset(),t.eventType&Lt&&0===this.count)return this.failTimeout();if(n&&r&&i){if(t.eventType!=Rt)return this.failTimeout();var s=this.pTime?t.timeStamp-this.pTime<e.interval:!0,a=!this.pCenter||H(this.pCenter,t.center)<e.posThreshold;this.pTime=t.timeStamp,this.pCenter=t.center,a&&s?this.count+=1:this.count=1,this._input=t;var h=this.count%e.taps;if(0===h)return this.hasRequireFailures()?(this._timer=o(function(){this.state=pe,this.tryEmit()},e.interval,this),le):pe}return de},failTimeout:function(){return this._timer=o(function(){this.state=de},this.options.interval,this),de},reset:function(){clearTimeout(this._timer)},emit:function(){this.state==pe&&(this._input.tapCount=this.count,this.manager.emit(this.options.event,this._input))}}),at.VERSION="2.0.4",at.defaults={domEvents:!1,touchAction:ie,enable:!0,inputTarget:null,inputClass:null,preset:[[rt,{enable:!1}],[it,{enable:!1},["rotate"]],[st,{direction:Dt}],[et,{direction:Dt},["swipe"]],[ot],[ot,{event:"doubletap",taps:2},["tap"]],[nt]],cssProps:{userSelect:"none",touchSelect:"none",touchCallout:"none",contentZooming:"none",userDrag:"none",tapHighlightColor:"rgba(0,0,0,0)"}};var me=1,ve=2;ht.prototype={set:function(t){return l(this.options,t),t.touchAction&&this.touchAction.update(),t.inputTarget&&(this.input.destroy(),this.input.target=t.inputTarget,this.input.init()),this},stop:function(t){this.session.stopped=t?ve:me},recognize:function(t){var e=this.session;if(!e.stopped){this.touchAction.preventDefaults(t);var i,n=this.recognizers,r=e.curRecognizer;(!r||r&&r.state&pe)&&(r=e.curRecognizer=null);for(var s=0;s<n.length;)i=n[s],e.stopped===ve||r&&i!=r&&!i.canRecognizeWith(r)?i.reset():i.recognize(t),!r&&i.state&(le|ue|ce)&&(r=e.curRecognizer=i),s++}},get:function(t){if(t instanceof Z)return t;for(var e=this.recognizers,i=0;i<e.length;i++)if(e[i].options.event==t)return e[i];return null},add:function(t){if(a(t,"add",this))return this;var e=this.get(t.options.event);return e&&this.remove(e),this.recognizers.push(t),t.manager=this,this.touchAction.update(),t},remove:function(t){if(a(t,"remove",this))return this;var e=this.recognizers;return t=this.get(t),e.splice(x(e,t),1),this.touchAction.update(),this},on:function(t,e){var i=this.handlers;return h(w(t),function(t){i[t]=i[t]||[],i[t].push(e)}),this},off:function(t,e){var i=this.handlers;return h(w(t),function(t){e?i[t].splice(x(i[t],e),1):delete i[t]}),this},emit:function(t,e){this.options.domEvents&&ut(t,e);var i=this.handlers[t]&&this.handlers[t].slice();if(i&&i.length){e.type=t,e.preventDefault=function(){e.srcEvent.preventDefault()};for(var n=0;n<i.length;)i[n](e),n++}},destroy:function(){this.element&&lt(this,!1),this.handlers={},this.session={},this.input.destroy(),this.element=null}},l(at,{INPUT_START:Lt,INPUT_MOVE:St,INPUT_END:Rt,INPUT_CANCEL:kt,STATE_POSSIBLE:he,STATE_BEGAN:le,STATE_CHANGED:ue,STATE_ENDED:ce,STATE_RECOGNIZED:pe,STATE_CANCELLED:fe,STATE_FAILED:de,DIRECTION_NONE:At,DIRECTION_LEFT:zt,DIRECTION_RIGHT:It,DIRECTION_UP:Ft,DIRECTION_DOWN:Pt,DIRECTION_HORIZONTAL:Dt,DIRECTION_VERTICAL:Ht,DIRECTION_ALL:Ot,Manager:ht,Input:L,TouchAction:j,TouchInput:X,MouseInput:V,PointerEventInput:N,TouchMouseInput:U,SingleTouchInput:Y,Recognizer:Z,AttrRecognizer:tt,Tap:ot,Pan:et,Swipe:st,Pinch:it,Rotate:rt,Press:nt,on:v,off:_,each:h,merge:u,extend:l,inherit:p,bindFn:f,prefixed:T}),typeof t==ft&&t.amd?t(function(){return at}):"undefined"!=typeof i&&i.exports?i.exports=at:e[r]=at}(window,document,"Hammer")},{}],4:[function(t,e,i){"use strict";function n(){this._yaw=null,this._pitch=null,this._hfov=null,this._vfov=null,this._corners=[r.create(),r.create(),r.create(),r.create()],this._planes=[r.create(),r.create(),r.create(),r.create(),r.create()]}var r=t("gl-matrix").vec3,s=t("./util/rotateVector");n.prototype._needsUpdate=function(t,e,i,n){return t!==this._yaw||e!==this._pitch||i!==this._hfov||n!==this._vfov},n.prototype._update=function(t,e,i,n){var o=this._corners,a=this._planes,h=.5*Math.tan(i/2),l=.5*Math.tan(n/2);r.set(o[0],-h,l,-.5),r.set(o[1],h,l,-.5),r.set(o[2],h,-l,-.5),r.set(o[3],-h,-l,-.5);for(var u=0;4>u;u++)s(o[u],o[u],0,-t,-e);r.cross(a[0],o[0],o[1]),r.cross(a[1],o[1],o[2]),r.cross(a[2],o[2],o[3]),r.cross(a[3],o[3],o[0]),r.set(a[4],0,0,-1),s(a[4],a[4],0,-t,-e),this._yaw=t,this._pitch=e,this._hfov=i,this._vfov=n},n.prototype.intersects=function(t,e,i,n,s){var o=this._planes;this._needsUpdate(t,e,i,n)&&this._update(t,e,i,n);for(var a=0;5>a;a++){for(var h=o[a],l=!1,u=0;u<s.length;u++){var c=s[u];if(r.dot(h,c)>=0){l=!0;break}}if(!l)return!1}return!0},e.exports=n},{"./util/rotateVector":107,"gl-matrix":2}],5:[function(t,e,i){"use strict";function n(t,e){this._equals=t,this._hash=e,this._queue=[],this._visited=new r(t,e),this._neighborsFun=null,this._exploreFun=null}var r=t("./collections/Set");n.prototype.start=function(t,e,i){if(this._neighborsFun||this._exploreFun)throw new Error("GraphFinder: search already in progress");this.reset(),this._neighborsFun=e,this._exploreFun=i,this._queue.push(t)},n.prototype.reset=function(){this._neighborsFun=null,this._exploreFun=null,this._queue.length=0,this._visited.clear()},n.prototype.next=function(){var t=this._queue,e=this._visited,i=this._neighborsFun,n=this._exploreFun;if(!i||!n)throw new Error("GraphFinder: no search in progress");for(;t.length>0;){var r=this._queue.shift();if(!e.has(r)&&n(r)){e.add(r);for(var s=i(r),o=0;o<s.length;o++)t.push(s[o]);return r}}return this.reset(),null},e.exports=n},{"./collections/Set":25}],6:[function(t,e,i){"use strict";function n(t,e,i,n,r){if(r=r||{},r.perspective=r.perspective||{},r.perspective.addProperty=null!=r.perspective.addProperty?r.perspective.addProperty:!0,this._domElement=t,this._domContainer=i._hotspotContainer,this._domContainer.appendChild(this._domElement),this._scene=i,this._params=n,r.perspective.radius&&!l())throw new Error("Hotspot: can not be embedded in sphere if CSS 3D Transforms are not supported");this._perspective=r.perspective,this._visible=!0,this._displayed=!1,this._position={x:0,y:0},this._viewChangeListener=this._update.bind(this),this._update()}function r(t,e,i,n,r){t.style.left="0",t.style.top="0";var s="",o=e.size(),a=o.width,h=o.height;s+="translateX("+a/2+"px) translateY("+h/2+"px) ",s+="translateX(-50%) translateY(-50%) ";var l=.5*h/Math.tan(e.fov()/2);s+="perspective("+l+"px) ",s+="translateZ("+l+"px) ",s+="rotateX("+-e.pitch()+"rad) ",s+="rotateY("+e.yaw()+"rad) ",s+="rotateY("+-i.yaw+"rad) ",s+="rotateX("+i.pitch+"rad) ",s+="translateZ("+-h/2+"px) ",s+="scale("+h/n+", "+h/n+") ",u(t,s),r&&c(t,l+"px")}function s(t,e,i){if(l()){t.style.left="0",t.style.top="0";var n="translateX("+e+"px) translateY("+i+"px) translateZ(0)";u(t,n)}else t.style.left=e+"px",t.style.top=i+"px"}function o(t){t.style.left="",t.style.top="",l()&&u(t,"")}var a=t("./util/eventEmitter"),h=t("./domUtil"),l=t("./support/Css"),u=h.setTransform,c=h.setWithVendorPrefix("perspective");a(n),n.prototype._destroy=function(){this._scene.removeEventListener("viewChange",this._viewChangeListener),this._viewChangeListener=null,this._domContainer.removeChild(this._domElement),this._domElement=null,this._domContainer=null,this._scene=null,this._params=null,this._visible=null,this._displayed=null,this._position=null},n.prototype.domElement=function(){return this._domElement},n.prototype.show=function(){this._visible||(this._visible=!0,this._displayed&&this._scene.addEventListener("viewChange",this._viewChangeListener),this._update())},n.prototype.hide=function(){this._visible&&(this._visible=!1,this._displayed||this._scene.removeEventListener("viewChange",this._viewChangeListener),this._update())},n.prototype._display=function(){this._displayed||(this._displayed=!0,this._visible&&this._scene.addEventListener("viewChange",this._viewChangeListener),this._update())},n.prototype._undisplay=function(){this._displayed&&(this._displayed=!1,this._visible||this._scene.removeEventListener("viewChange",this._viewChangeListener),this._update())},n.prototype._update=function(){var t,e,i=this._domElement,n=this._params,a=this._position,h=!1;if(this._visible&&this._displayed){var l=this._scene.view();this._perspective.radius?(h=!0,r(i,l,n,this._perspective.radius,this._perspective.addProperty)):(l.coordinatesToScreen(n,a),t=a.x,e=a.y,null!=t&&null!=e&&(h=!0,s(i,t,e)))}h?(i.style.display="block",i.style.position="absolute"):(i.style.display="none",i.style.position="",o(i))},e.exports=n},{"./domUtil":42,"./support/Css":82,"./util/eventEmitter":96}],7:[function(t,e,i){"use strict";function n(t,e,i,n,r,s){s=s||{};var o=this;this._stage=t,this._source=e,this._geometry=i,this._view=n,this._effects=s.effects||null,this._textureStore=r,this._fixedLevelIndex=null,this._viewChangeHandler=function(){o.emit("viewChange",o.view())},this._view.addEventListener("change",this._viewChangeHandler),this._handleTextureStoreChange=function(){o.emit("textureStoreChange",o.textureStore())},this._textureStore.addEventListener("textureLoad",this._handleTextureStoreChange),this._textureStore.addEventListener("textureError",this._handleTextureStoreChange),this._textureStore.addEventListener("textureInvalid",this._handleTextureStoreChange),this._levels=[]}var r=t("./util/eventEmitter");r(n),n.prototype.destroy=function(){this._view.removeEventListener("change",this._viewChangeHandler),this._textureStore.removeEventListener("textureLoad",this._handleTextureStoreChange),this._textureStore.removeEventListener("textureError",this._handleTextureStoreChange),this._textureStore.removeEventListener("textureInvalid",this._handleTextureStoreChange),this._stage.removeEventListener("resize",this._handleStageResize),this._stage=null,this._source=null,this._geometry=null,this._view=null,this._textureStore=null},n.prototype.source=function(){return this._source},n.prototype.geometry=function(){return this._geometry},n.prototype.view=function(){return this._view},n.prototype.effects=function(){return this._effects},n.prototype.textureStore=function(){return this._textureStore},n.prototype.setView=function(t){this._view=t,this.emit("viewChange",this._view)},n.prototype.setEffects=function(t){this._effects=t,this.emit("effectsChange",this._effects)},n.prototype.fixedLevel=function(){return this._fixedLevelIndex},n.prototype.setFixedLevel=function(t){if(t!==this._fixedLevelIndex){if(null!=t&&(t>=this._geometry.levelList.length||0>t))throw new Error("Level index out of range: "+t);this._fixedLevelIndex=t,this.emit("fixedLevelChange",this._fixedLevelIndex)}},n.prototype._selectLevel=function(){var t;return t=null!=this._fixedLevelIndex?this._geometry.levelList[this._fixedLevelIndex]:this._view.selectLevel(this._geometry.selectableLevelList)},n.prototype.visibleTiles=function(t){var e=this._selectLevel();return this._geometry.visibleTiles(this._view,e,t)},n.prototype.pinLevel=function(t){for(var e=this._geometry.levelList[t],i=this._geometry.getLevelTiles(e),n=0;n<i.length;n++)this._textureStore.pin(i[n])},n.prototype.unpinLevel=function(t){for(var e=this._geometry.levelList[t],i=this._geometry.getLevelTiles(e),n=0;n<i.length;n++)this._textureStore.unpin(i[n])},n.prototype.pinFirstLevel=function(){return this.pinLevel(0)},n.prototype.unpinFirstLevel=function(){return this.unpinLevel(0)},e.exports=n},{"./util/eventEmitter":96}],8:[function(t,e,i){"use strict";function n(){this.constructor.super_.apply(this,arguments)}var r=t("./util/inherits");r(n,Error),e.exports=n},{"./util/inherits":98}],9:[function(t,e,i){"use strict";function n(t,e){this._stage=t,this._controls=e,this._running=!1,this._renderOnNextFrame=!1,this._boundLoop=this._loop.bind(this),this._onBeforeRender=!1;var i=this;this._renderInvalidHandler=function(){i._onBeforeRender||i.renderOnNextFrame()},this._stage.addEventListener("renderInvalid",this._renderInvalidHandler)}var r=t("./util/eventEmitter");r(n),n.prototype.destroy=function(){this.stop(),this._stage.removeEventListener("renderInvalid",this._renderInvalidHandler),this._stage=null},n.prototype.stage=function(){return this._stage},n.prototype.start=function(){this._running=!0,this.renderOnNextFrame()},n.prototype.stop=function(){this._running=!1},n.prototype.renderOnNextFrame=function(){this._running&&!this._renderOnNextFrame&&(this._renderOnNextFrame=!0,requestAnimationFrame(this._boundLoop))},n.prototype._loop=function(){this._running&&(this._renderOnNextFrame=!1,this.render())},n.prototype.render=function(){this._onBeforeRender=!0,this.emit("beforeRender"),this._onBeforeRender=!1,this._stage.render(),this.emit("afterRender")},e.exports=n},{"./util/eventEmitter":96}],10:[function(t,e,i){"use strict";function n(t,e){this._viewer=t,this._layer=e,this._displayed=!1,this._hotspotContainer=document.createElement("div"),u.setAbsolute(this._hotspotContainer),t._domElement.appendChild(this._hotspotContainer),this._hotspots=[],this._movement=null,this._movementStartTime=null,this._movementStep=null,this._movementParams=null,this._movementCallback=null,this._updateMovementHandler=this._updateMovement.bind(this),this._updateHotspotsHandler=this._updateHotspots.bind(this),this._viewer.addEventListener("sceneChange",this._updateHotspotsHandler),this._viewChangeHandler=this.emit.bind(this,"viewChange"),this._layer.view().addEventListener("change",this._viewChangeHandler)}var r=t("./util/eventEmitter"),s=t("./Hotspot"),o=t("./util/clock"),a=t("./util/noop"),h=t("./util/type"),l=t("./util/defaults"),u=t("./domUtil");r(n),n.prototype._destroy=function(){this._layer.view().removeEventListener("change",this._viewChangeHandler),this._viewer.removeEventListener("sceneChange",this._updateHotspotsHandler);var t=this;viewer._domElement.removeChild(this._hotspotContainer),this._hotspots.forEach(function(e){t.destroyHotspot(e)}),this._movement&&this.stopMovement(),this._movement=null,this._viewChangeListener=null,this._sceneChangeListener=null,this._viewer=null,this._layer=null,this._displayed=null,this._hotspotContainer=null,this._hotspots=null},n.prototype.createHotspot=function(t,e,i){e=e||{};var n=new s(t,this._viewer,this,e,i);return this._hotspots.push(n),this._viewer.scene()===this&&n._display(),n},n.prototype.hasHotspot=function(t){return this._hotspots.indexOf(t)>=0},n.prototype.listHotspots=function(){return[].concat(this._hotspots)},n.prototype.destroyHotspot=function(t){var e=this._hotspots.indexOf(t);if(0>e)throw new Error("No such hotspot");this._hotspots.splice(e,0),this._viewer.scene()===this&&t._undisplay(),t._destroy()},n.prototype.layer=function(){return this._layer},n.prototype.view=function(){return this._layer.view()},n.prototype.visible=function(){return this._displayed},n.prototype.switchTo=function(t,e){return this._viewer.switchScene(this,t,e)},n.prototype.lookTo=function(t,e,i){if(e=e||{},i=i||a,"object"!==h(t))throw new Error("Parameter 0 of lookTo() should be an object");var n=null!=e.transitionDuration?e.transitionDuration:1e3,r=null!=e.shortest?e.shortest:!0,s=this._layer.view(),o=s.parameters(),u={};l(u,t),l(u,o),r&&s.normalizeToClosest(u,u);var c=function(t){return(t*=2)<1?.5*t*t:-.5*(--t*(t-2)-1)},p=function(){var t=!1;return function(e,i){if(i>=n&&t)return null;var r=Math.min(i/n,1);for(var s in e){var a=o[s],h=u[s];e[s]=a+c(r)*(h-a)}return t=i>=n,e}},f=this._viewer.controls().enabled();this._viewer.controls().disable(),this.startMovement(p,function(){f&&this._viewer.controls().enable(),i()})},n.prototype.startMovement=function(t,e){var i=this._viewer.renderLoop();this._movement&&this.stopMovement();var n=t();if("function"!=typeof n)throw new Error("Bad movement");this._movement=t,this._movementStep=n,this._movementStartTime=o(),this._movementParams={},this._movementCallback=e,i.addEventListener("beforeRender",this._updateMovementHandler),i.renderOnNextFrame()},n.prototype.stopMovement=function(){var t=this._viewer.renderLoop();this._movementCallback&&this._movementCallback(),t.removeEventListener("beforeRender",this._updateMovementHandler),this._movement=null,this._movementStep=null,this._movementStartTime=null,this._movementParams=null,this._movementCallback=null},n.prototype.movement=function(){return this._movement},n.prototype._updateMovement=function(){if(!this._movement)throw new Error("Should not call update");var t=this._viewer.renderLoop(),e=this._layer.view(),i=o()-this._movementStartTime,n=this._movementStep,r=this._movementParams;r=e.parameters(r),r=n(r,i),null==r?this.stopMovement():(e.setParameters(r),t.renderOnNextFrame())},n.prototype._updateHotspots=function(){var t;if(this._viewer.scene()===this)for(this._displayed=!0,t=0;t<this._hotspots.length;t++)this._hotspots[t]._display();else for(this._displayed=!1,t=0;t<this._hotspots.length;t++)this._hotspots[t]._undisplay()},e.exports=n},{"./Hotspot":6,"./domUtil":42,"./util/clock":89,"./util/defaults":93,"./util/eventEmitter":96,"./util/noop":101,"./util/type":109}],11:[function(t,e,i){"use strict";function n(){}function r(t,e){var i=this;i._id=g++,i._store=t,i._tile=e,i._asset=null,i._texture=null,i._changeHandler=function(){t.emit("textureInvalid",e)};var r=t.source(),s=t.stage(),o=r.loadAsset.bind(r),a=s.createTexture.bind(s),h=p(c(o),a);d&&console.log("loading",i._id,i._tile),i._cancel=h(s,e,function(t,e,r,s){return i._cancel=null,t?(r&&r.destroy(),s&&s.destroy(),void(t instanceof n?(i._store.emit("textureCancel",i._tile),d&&console.log("cancel",i._id,i._tile)):(i._store.emit("textureError",i._tile),
d&&console.log("error",i._id,i._tile)))):(i._texture=s,r.dynamic?(i._asset=r,r.addEventListener("change",i._changeHandler)):r.destroy(),i._store.emit("textureLoad",i._tile),void(d&&console.log("load",i._id,i._tile)))})}function s(t,e,i,n){n=u(n||{},y),this._source=e,this._stage=i;var r=t.TileClass;this._clientPhase=m,this._clientCounter=0,this._itemMap=new o(r.equals,r.hash),this._visible=new a(r.equals,r.hash),this._previouslyVisible=new h(r.equals,r.hash,n.previouslyVisibleCacheSize),this._pinMap=new o(r.equals,r.hash),this._newVisible=new a(r.equals,r.hash),this._noLongerVisible=[],this._visibleAgain=[],this._evicted=[]}var o=t("./collections/Map"),a=t("./collections/Set"),h=t("./collections/LruSet"),l=t("./util/eventEmitter"),u=t("./util/defaults"),c=t("./util/retry"),p=t("./util/chain"),f=t("./util/inherits"),d="undefined"!=typeof MARZIPANODEBUG&&MARZIPANODEBUG.textureStore,m="idle",v="start",_="end",y={previouslyVisibleCacheSize:32},g=0;f(n,Error),r.prototype.asset=function(){return this._asset},r.prototype.texture=function(){return this._texture},r.prototype.destroy=function(){var t=this,e=t._id,i=t._store,r=t._tile,s=t._asset,o=t._texture,a=t._cancel;return a?void a(new n("Texture load cancelled")):(s&&(s.removeEventListener("change",t._changeHandler),s.destroy()),o&&o.destroy(),i.emit("textureUnload",r),d&&console.log("unload",e,r),t._changeHandler=null,t._asset=null,t._texture=null,t._tile=null,t._store=null,void(t._id=null))},l(r),l(s),s.prototype.destroy=function(){this.clear(),this._source=null,this._stage=null,this._itemMap=null,this._visible=null,this._previouslyVisible=null,this._pinMap=null,this._newVisible=null,this._noLongerVisible=null,this._visibleAgain=null,this._evicted=null},s.prototype.stage=function(){return this._stage},s.prototype.source=function(){return this._source},s.prototype.clear=function(){var t=this;t._evicted.length=0,t._itemMap.each(function(e){t._evicted.push(e)}),t._evicted.forEach(function(e){t._unloadTile(e)}),t._itemMap.clear(),t._visible.clear(),t._previouslyVisible.clear(),t._pinMap.clear(),t._newVisible.clear(),t._noLongerVisible.length=0,t._visibleAgain.length=0,t._evicted.length=0},s.prototype.clearNotPinned=function(){var t=this;t._evicted.length=0,t._itemMap.each(function(e){t._pinMap.has(e)||t._evicted.push(e)}),t._evicted.forEach(function(e){t._unloadTile(e)}),t._visible.clear(),t._previouslyVisible.clear(),t._evicted.length=0},s.prototype.startFrame=function(){if(this._clientPhase!==m&&this._clientPhase!==v)throw new Error("TextureStore: startFrame called out of sequence");this._clientPhase=v,this._clientCounter++,this._newVisible.clear()},s.prototype.markTile=function(t){if(this._clientPhase!==v)throw new Error("TextureStore: markTile called out of sequence");this._newVisible.add(t)},s.prototype.endFrame=function(){if(this._clientPhase!==v&&this._clientPhase!==_)throw new Error("TextureStore: endFrame called out of sequence");this._clientPhase=_,this._clientCounter--,this._clientCounter||(this._update(),this._clientPhase=m)},s.prototype._update=function(){var t=this;t._noLongerVisible.length=0,t._visible.each(function(e){t._newVisible.has(e)||t._noLongerVisible.push(e)}),t._visibleAgain.length=0,t._newVisible.each(function(e){t._previouslyVisible.has(e)&&t._visibleAgain.push(e)}),t._visibleAgain.forEach(function(e){t._previouslyVisible.remove(e)}),t._evicted.length=0,t._noLongerVisible.forEach(function(e){var i=t._itemMap.get(e),n=i&&i.texture();if(n){var r=t._previouslyVisible.add(e);null!=r&&t._evicted.push(r)}else i&&t._unloadTile(e)}),t._evicted.forEach(function(e){t._pinMap.has(e)||t._unloadTile(e)}),t._newVisible.each(function(e){var i=t._itemMap.get(e);if(i){var n=i.texture(),r=i.asset();n&&r&&(n.refresh(e,r),t.emit("textureInvalid",e))}else t._loadTile(e)});var e=t._visible;t._visible=t._newVisible,t._newVisible=e,t._noLongerVisible.length=0,t._visibleAgain.length=0,t._evicted.length=0},s.prototype._loadTile=function(t){if(this._itemMap.has(t))throw new Error("TextureStore: loading texture already in cache");var e=new r(this,t);this._itemMap.set(t,e)},s.prototype._unloadTile=function(t){var e=this._itemMap.del(t);if(!e)throw new Error("TextureStore: unloading texture not in cache");e.destroy()},s.prototype.asset=function(t){var e=this._itemMap.get(t);return e?e.asset():null},s.prototype.texture=function(t){var e=this._itemMap.get(t);return e?e.texture():null},s.prototype.pin=function(t){var e=this._pinMap.get(t)||0;this._pinMap.set(t,e+1),this._itemMap.has(t)||this._loadTile(t)},s.prototype.unpin=function(t){var e=this._pinMap.get(t);if(!e)throw new Error("TextureStore: unpin when not pinned");e--,e>0?this._pinMap.set(t,e):(this._pinMap.del(t),this._visible.has(t)||this._previouslyVisible.has(t)||this._unloadTile(t))},s.prototype.query=function(t){var e=this._itemMap.get(t),i=this._pinMap.get(t)||0;return{visible:this._visible.has(t),previouslyVisible:this._previouslyVisible.has(t),hasAsset:null!=e&&null!=e.asset(),hasTexture:null!=e&&null!=e.texture(),pinned:0!==i,pinCount:i}},e.exports=s},{"./collections/LruSet":23,"./collections/Map":24,"./collections/Set":25,"./util/chain":87,"./util/defaults":93,"./util/eventEmitter":96,"./util/inherits":98,"./util/retry":106}],12:[function(t,e,i){"use strict";function n(t){t=s(t||{},a),this._duration=t.duration,this._startTime=null,this._handle=null,this._check=this._check.bind(this)}var r=t("./util/eventEmitter"),s=t("./util/defaults"),o=t("./util/clock"),a={duration:1/0};r(n),n.prototype.start=function(){this._startTime=o(),null==this._handle&&this._duration<1/0&&this._setup(this._duration)},n.prototype.started=function(){return null!=this._startTime},n.prototype.stop=function(){this._startTime=null,null!=this._handle&&(clearTimeout(this._handle),this._handle=null)},n.prototype.reset=function(){this.start()},n.prototype._setup=function(t){this._handle=setTimeout(this._check,t)},n.prototype._check=function(){var t=o(),e=t-this._startTime,i=this._duration-e;this._handle=null,0>=i?(this.emit("timeout"),this._startTime=null):1/0>i&&this._setup(i)},n.prototype.duration=function(){return this._duration},n.prototype.setDuration=function(t){this._duration=t,null!=this._startTime&&(null!=this._handle&&(clearTimeout(this._handle),this._handle=null),this._check())},e.exports=n},{"./util/clock":89,"./util/defaults":93,"./util/eventEmitter":96}],13:[function(t,e,i){"use strict";function n(t,e){e=e||{},this._domElement=t;var i;if(e.stageType){if(i=E[e.stageType],!i)throw new Error("Unknown stage type: "+e.stageType)}else i=m();this._stage=new i(e),_(this._stage),this._domElement.appendChild(this._stage.domElement()),this._controlContainer=document.createElement("div"),y.setAbsolute(this._controlContainer),y.setFullSize(this._controlContainer),y.setBlocking(this._controlContainer),t.appendChild(this._controlContainer),this.updateSize(),this._updateSizeListener=this.updateSize.bind(this),window.addEventListener("resize",this._updateSizeListener),this._renderLoop=new o(this._stage),this._controls=new a,this._controlMethods=v(this._controls,this._controlContainer,e.controls),this._controls.attach(this._renderLoop),this._hammerManagerTouch=b.get(this._controlContainer,"touch"),this._hammerManagerMouse=b.get(this._controlContainer,"mouse"),e.cursors=e.cursors||{},this._dragCursor=new x(this._controls,"mouseViewDrag",t,e.cursors.drag),this._renderLoop.start(),this._scenes=[],this._scene=null,this._cancelCurrentTween=null,this._viewChangeHandler=this.emit.bind(this,"viewChange"),this._idleTimer=new c,this._idleTimer.start(),this._resetIdleHandler=this._resetIdle.bind(this),this.addEventListener("viewChange",this._resetIdleHandler),this._enterIdleHandler=this._enterIdle.bind(this),this._idleTimer.addEventListener("timeout",this._enterIdleHandler),this._leaveIdleHandler=this._leaveIdle.bind(this),this._controls.addEventListener("active",this._leaveIdleHandler),this.addEventListener("sceneChange",this._leaveIdleHandler),this._idleMovement=null}function r(t,e,i){e.layer().setEffects({opacity:t}),e._hotspotContainer.style.opacity=t}var s=t("./util/eventEmitter"),o=t("./RenderLoop"),a=t("./controls/Controls"),h=t("./Layer"),l=t("./TextureStore"),u=t("./Scene"),c=t("./Timer"),p=t("./stages/WebGl"),f=t("./stages/Css"),d=t("./stages/Flash"),m=t("./chooseBestStage"),v=t("./controls/registerDefaultControls"),_=t("./renderers/registerDefaultRenderers"),y=t("./domUtil"),g=t("./util/tween"),w=t("./util/noop"),x=t("./controls/DragCursor"),b=t("./controls/HammerGestures"),E={webgl:p,css:f,flash:d};s(n),n.prototype.destroy=function(){this._domElement.removeChild(this._stage.domElement()),window.removeEventListener("resize",this._updateSizeListener),this._updateSizeListener=null,this._scene&&this._scene.view().removeEventListener("change",this._viewChangeHandler),this._viewChangeHandler=null;for(var t in this._controlMethods)this._controlMethods[t].destroy();this._controlMethods=null;for(var e=0;e<this._scenes.length;e++)this._scenes[e].destroy();this._scenes=null,this._scene=null,this._stage.destroy(),this._stage=null,this._renderLoop.destroy(),this._renderLoop=null,this._controls.destroy(),this._controls=null,this._cancelCurrentTween&&(this._cancelCurrentTween(),this._cancelCurrentTween=null),this._domElement=null,this._controlContainer=null},n.prototype.updateSize=function(){this._stage.updateSize()},n.prototype.stage=function(){return this._stage},n.prototype.renderLoop=function(){return this._renderLoop},n.prototype.controls=function(){return this._controls},n.prototype.createScene=function(t){t=t||{};var e=this._stage,i=t.source,n=t.geometry,r=t.view,s=new l(n,i,e,t.textureStore),o=new h(e,i,n,r,s,t.layerOpts);t.pinFirstLevel&&o.pinFirstLevel();var a=new u(this,o);return this._scenes.push(a),a},n.prototype._addLayer=function(t){t.pinFirstLevel(),this._stage.addLayer(t)},n.prototype._removeLayer=function(t){this._stage.hasLayer(t)&&(t.unpinFirstLevel(),this._stage.removeLayer(t)),t.textureStore().clearNotPinned()},n.prototype.destroyScene=function(t){var e=this._scenes.indexOf(t);if(0>e)throw new Error("No such scene in viewer");this._removeLayer(t._layer),this._scene===t&&(this._scene=null,this._cancelCurrentTween&&(this._cancelCurrentTween(),this._cancelCurrentTween=null)),this._scenes.splice(e,1);var i=t._layer,n=i.textureStore();t._destroy(),i.destroy(),n.destroy()},n.prototype.destroyAllScenes=function(){for(;this._scenes.length>0;)this.destroyScene(this._scenes[0])},n.prototype.hasScene=function(t){return this._scenes.indexOf(t)>=0},n.prototype.listScenes=function(){return[].concat(this._scenes)},n.prototype.scene=function(){return this._scene},n.prototype.view=function(){var t=this._scene;return t?t.layer().view():null},n.prototype.lookTo=function(t,e,i){var n=this._scene;n&&n.lookTo(t,e,i)},n.prototype.startMovement=function(t,e){var i=this._scene;i&&i.startMovement(t,e)},n.prototype.stopMovement=function(){var t=this._scene;t&&t.stopMovement()},n.prototype.setIdleMovement=function(t,e){this._idleTimer.setDuration(t),this._idleMovement=e},n.prototype._resetIdle=function(){this._idleTimer.reset()},n.prototype._enterIdle=function(){var t=this._scene,e=this._idleMovement;t&&e&&t.startMovement(e)},n.prototype._leaveIdle=function(){var t=this._scene;t&&t.movement()===this._idleMovement&&t.stopMovement()};var T=1e3;n.prototype.switchScene=function(t,e,i){function n(e){u(e,t,a)}function s(){a&&c._removeLayer(a.layer()),c._cancelCurrentTween=null,i()}e=e||{},i=i||w;var o=this._stage,a=this._scene;if(a===t)return void i();if(this._scenes.indexOf(t)<0)throw new Error("No such scene in viewer");var h=o.listLayers();if(a&&a.layer()!==h[h.length-1])throw new Error("Stage not in sync with viewer");this._cancelCurrentTween&&(this._cancelCurrentTween(),this._cancelCurrentTween=null);var l=null!=e.transitionDuration?e.transitionDuration:T,u=null!=e.transitionUpdate?e.transitionUpdate:r,c=this;c._addLayer(t.layer()),this._cancelCurrentTween=g(l,n,s),this._scene=t,this.emit("sceneChange"),this.emit("viewChange"),a&&a.view().removeEventListener("change",this._viewChangeHandler),t.view().addEventListener("change",this._viewChangeHandler)},e.exports=n},{"./Layer":7,"./RenderLoop":9,"./Scene":10,"./TextureStore":11,"./Timer":12,"./chooseBestStage":21,"./controls/Controls":30,"./controls/DragCursor":32,"./controls/HammerGestures":34,"./controls/registerDefaultControls":40,"./domUtil":42,"./renderers/registerDefaultRenderers":63,"./stages/Css":75,"./stages/Flash":76,"./stages/WebGl":79,"./util/eventEmitter":96,"./util/noop":101,"./util/tween":108}],14:[function(t,e,i){"use strict";function n(t,e){e=e||{};var i=s(e.watermarkPosition||{});this.constructor.super_.apply(this,arguments),this._domElement.appendChild(a(i))}function r(t){return Math.min(200,Math.max(t,0))}function s(t){var e={},i=parseInt(t.top,10),n=parseInt(t.bottom,10),s=parseInt(t.left,10),o=parseInt(t.right,10);return isNaN(i)?isNaN(n)?(e.top="auto",e.bottom=u+"px"):(e.top="auto",e.bottom=r(n)+"px"):(e.top=r(i)+"px",e.bottom="auto"),isNaN(s)?isNaN(o)?(e.left="auto",e.right=c+"px"):(e.left="auto",e.right=r(o)+"px"):(e.left=r(s)+"px",e.right="auto"),e}function o(t){var e="";for(var i in t)e+=i+":"+t[i]+" !important;";return e}function a(t){var e=document.createElement("a"),i=document.createElement("img");return e.appendChild(i),e.setAttribute("href","http://www.marzipano.net/"),e.setAttribute("target","_blank"),e.setAttribute("style",o(m)+o(f)),e.style.top=t.top,e.style.bottom=t.bottom,e.style.left=t.left,e.style.right=t.right,i.setAttribute("style",o(m)+o(d)),i.src=p,e}var h=t("./Viewer"),l=t("./util/inherits"),u=10,c=15;l(n,h);var p="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAREAAABLCAMAAABgKEOZAAAAXVBMVEX///////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////8/beDHAAAAHnRSTlMAEBEgIjAzQERQVWBmcHd/iI+Zn6qvu7/Mz93f7u9X10/4AAAG2klEQVR4AeyYUYu1OAyGU6QUKVKKlFCk7///mTv4NujiqS574Rn4vudmepGjyTNpKpUBPoQgfyYgdT0JCKUBAEqUnYQmYkvMx0+TSAAMlR+U66aLs1/ASAwgtURGHATYj7Pv753EUOh7RkhxQvKelFYA6nqm5qsC+cjffzZCmh8bIW25GjFWEXEbVulEwMsrsFg3K1BkZwXK/nKXGuqupCHJjkPDJufOCYCcUYb6paFNDNNPAS7kxrqN41lTrECihkkI5bxnhCJ2DwsQpeMbNRWrKkIbvJVWxkZEPJBHRohbgXQxQiq2swe6edmIY3qOEjoLEPhHhGpSsSqAZWyEGsdGLATTZyOJy7mn5zYkeduI1H836rlZvUU1hAXV0p9ujaRnIxOQb42I2kOa+5aRwoKNjEYxif+yJlNXlrDJrZH8bERWbJ+N5MN72Bt3EfnCrlmuE2xm/SuUeRaRyuwU672RivXRSATcxQhX87H3aP91I4m1X4ddYOZslUgte+DcA1JnOhfMEcResoCrET7esGflijYfG2uegPi6kSkDWYZGpv0PN4wH3N48rgcYobdO+GFRIJpp49mIUfx5Y7FD3wKoqtoArDI2IhVZpA/VhsiN/rlHOlsQ+b89ooA6IVOj7NdApwQZG6EAK2bFSkWf58imqpVbcDRHxkZMQ0U1JQlQeRFgCSFY+pfJysOYm8QB3k4cx1KGk3WD/hcjC/D5rDmNDr7q/clKBqcv05r7WvY1ZGjEDotnI4r62QhPKvJNI6MvNBaSbV2QEnRshDGbezTigTQwotBfYuTyFe/FClPMZk0Vy72RCUhPRlxFcwMjQP4VRihhsbVvWC1bbICzTd4a/NCIKYS/NzJVIMrwK37+LUbOtwE4Jr40HKVVoMmDEbdBb4z4uMKEXIyElS/7upHBjREpp95JOPWOAbWCSQTi/Y3RFsY3Ruq+b2R4q0iW08j1QLw3wmVzYyOaZ5GBkY1v/o6RvzfP/7Rrhi2Os1AUFglBQriIBJEg/v+f+W5qtvXMsU1vty/MB8+nJbk999xHrTvDmKGhoaGhoaGhUor8n/6DyCAyiAwig8iQc24yv19DdpE/WuzjyXw8WJ+v3uJjLiVHv9Cr1sMoBe579DM8VkeYpZbI/KoLv3VbORWms3YvVdGZnta93LVL96uhepwNCslh8XP31RhFBOQRHyVxNm93sVsTNN9ehebJZqnTlApon5lI9dATYfc4GaOMULViyfq6i30AOV+lxwfD2SXXF/Yn+vN5EJHI3eqQoaiJgHv0IqFmyjxtPwLK1yGCSKi7wfcNqMvNUKYDW91Hs9zOzxHZSj7CUZrmfNUSzHMEOXp4d3axrlU43k1PiMy3dGLPlQwY9joC7pD9BO92rECDSdou0na04e8wrv0oHrL8Y5PaG9M2NB030JQrBCACL1NzTtzxIFujjFCNgoWvhjy1Bqmpn9PhWKtzu4PrgYFFcUepaRT5IIVqh0SCQYFBhGJ55W4T1F9EgAfbzw+Fl11q/fIzeyoQsVo319vCS1btBIaEGUCCBkhkrYPxEVmMLsJENfawmcgA9pQ7553p+Nk2EDKLsKeamgxDwghYii+RyM7ulWEyugiCgPBRYoOKKVb3jLCxfT1XERrT8uNGqkRMX3bHL30kAvRx3866CNttXWmyjQ0A9ITjVnVPLYDm5cdR2AJzJ/uMiMDiwb4VXYQE6wrP2AC6FCWRiOzb7R7fILLgnQBEYMeCLBhqI+AgOBDtIT0RZs9FZMEXLxPBoXh1948jQAF0YaTpgohiWM9FlxcvE8HvmO9FQBd8h++/R0TeLcrTayLyMRH5XUQ2Lrq+eHtEtidZsz7CB0SykghmA6VrInanu5WI9LPCjaiOQIMkMMAuSiLwPzqQLf04/B/tKyLF9jeX/zwCDlI309TvEvREVggHZ5jj8MXrzCWRtf+duXwcgQaRtiV2WfVELPxIAAeC4/Qv3gsiO69+hm2ujUCDTGCAXbRE8GdKxPtGnGTeIMLYNnz4TxHuBr7bRU+kv9Zr4Tj9i/eaCB8twSXVR6BBJjid0EVBBM+rYJrLODNkuCCSHUbFO1sfgQcRirPWLioisGnLdl9v629TUBw65Jt5iwhOO2342yd9BByk+WfxFn/57o2SCOYpYTkSOX8EKVEoDh3yxYFsn4hPt+m8O3AsoTAQfQQexP7tYh8GwWiJ4ICgYDgOWrBcn4gc06I8eGkjYArYFSAxSiKgZW+99sV8kwi7s/QRaBDJYOCMnghovTNOYsxXiRzu6e6+gtHnEXgQK9Dl32Wd/JGz3//LCXT/fgQ2GH9L8ns1iAwig8ggMogMIoPIIPIfiGyGLaAclDgAAAAASUVORK5CYII=",f={display:"block",position:"absolute",height:"30px",width:"auto"},d={height:"100%",width:"auto",position:"static"},m={display:"block",opacity:1,visibility:"visible",transform:"none","-webkit-transform":"none","-moz-transform":"none",margin:"auto","margin-left":"auto","margin-right":"auto","margin-top":"auto","margin-bottom":"auto","z-index":"10000"};e.exports=n},{"./Viewer":13,"./util/inherits":98}],15:[function(t,e,i){"use strict";function n(t,e,i){i=i||{},this._opts=i,this._element=t,this.source=e,this._timestamp=1,this._lastUsedTime=null}var r=t("../util/clock"),s=t("../util/eventEmitter");s(n),n.prototype.element=function(){return this._element},n.prototype.width=function(){return this._element.width},n.prototype.height=function(){return this._element.height},n.prototype.dynamic=!0,n.prototype.timestamp=function(){return this._timestamp},n.prototype.changed=function(){this._timestamp++,this.emit("change")},n.prototype.used=function(){this._lastUsedTime=r()},n.prototype.destroy=function(){this._opts.unload&&this._opts.unload(),this.source.unload(this)},e.exports=n},{"../util/clock":89,"../util/eventEmitter":96}],16:[function(t,e,i){"use strict";function n(t,e){this._flashElement=t,this._imageId=e,this._timestamp=r()}var r=t("../util/clock");n.prototype.element=function(){return this._imageId},n.prototype.timestamp=function(){return this._timestamp},n.prototype.dynamic=!1,n.prototype.destroy=function(){var t=this._flashElement,e=this._imageId;t.unloadImage(e),this._flashElement=null,this._imageId=null},e.exports=n},{"../util/clock":89}],17:[function(t,e,i){"use strict";function n(t){this._element=t,this._timestamp=r()}var r=t("../util/clock"),s=t("../util/noop");n.prototype.element=function(){return this._element},n.prototype.width=function(){return this._element.width},n.prototype.height=function(){return this._element.height},n.prototype.timestamp=function(){return this._timestamp},n.prototype.dynamic=!1,n.prototype.destroy=s,e.exports=n},{"../util/clock":89,"../util/noop":101}],18:[function(t,e,i){"use strict";function n(t){this._element=t,this._timestamp=r()}var r=t("../util/clock"),s=t("../util/noop");n.prototype.element=function(){return this._element},n.prototype.width=function(){return this._element.naturalWidth},n.prototype.height=function(){return this._element.naturalHeight},n.prototype.timestamp=function(){return this._timestamp},n.prototype.dynamic=!1,n.prototype.destroy=s,e.exports=n},{"../util/clock":89,"../util/noop":101}],19:[function(t,e,i){"use strict";function n(t){t=r(t||{},a);var e=t.yawSpeed,i=t.pitchSpeed,n=t.fovSpeed,s=t.yawAccel,o=t.pitchAccel,h=t.fovAccel,l=t.targetPitch,u=t.targetFov;return function(){var t,r,a,c,p=0,f=0,d=0,m=0,v=0,_=0,y=0;return function(g,w){if(t=(w-p)/1e3,v=Math.min(f+t*s,e),r=v*t,g.yaw=g.yaw+r,null!=l&&g.pitch!==l){var x=.5*d*d/o;_=Math.abs(l-g.pitch)>x?Math.min(d+t*o,i):d-t*o,a=_*t,l<g.pitch&&(g.pitch=Math.max(l,g.pitch-a)),l>g.pitch&&(g.pitch=Math.min(l,g.pitch+a))}if(null!=u&&g.fov!==l){var b=.5*m*m/h;y=Math.abs(u-g.fov)>b?Math.min(m+t*h,n):m-t*h,c=y*t,u<g.fov&&(g.fov=Math.max(u,g.fov-c)),u>g.fov&&(g.fov=Math.min(u,g.fov+c))}return p=w,f=v,d=_,m=y,g}}}var r=t("./util/defaults"),s=.1,o=.01,a={yawSpeed:s,pitchSpeed:s,fovSpeed:s,yawAccel:o,pitchAccel:o,fovAccel:o,targetPitch:0,targetFov:null};e.exports=n},{"./util/defaults":93}],20:[function(t,e,i){"use strict";function n(t,e,i,n){n=n||{};var r;r=null!=i&&null!=i.absoluteWidth?i.absoluteWidth:null!=i&&null!=i.relativeWidth?i.relativeWidth*t:t;var s;s=i&&null!=i.absoluteHeight?i.absoluteHeight:null!=i&&null!=i.relativeHeight?i.relativeHeight*e:e;var o;o=null!=i&&null!=i.absoluteX?i.absoluteX:null!=i&&null!=i.relativeX?i.relativeX*t:0;var a;return a=null!=i&&null!=i.absoluteY?i.absoluteY:null!=i&&null!=i.relativeY?i.relativeY*e:0,n.height=s,n.width=r,n.left=o,n.top=a,n.right=o+r,n.bottom=a+s,n.totalWidth=t,n.totalHeight=e,n}e.exports=n},{}],21:[function(t,e,i){"use strict";function n(){for(var t=0;t<a.length;t++){var e=a[t];if(e.supported())return e}throw new Error("None of the stage types are supported")}var r=t("./stages/WebGl"),s=t("./stages/Css"),o=t("./stages/Flash"),a=[r,s,o];e.exports=n},{"./stages/Css":75,"./stages/Flash":76,"./stages/WebGl":79}],22:[function(t,e,i){"use strict";function n(t,e,i){if("function"!=typeof t)throw new Error("LruMap: bad equals function");if(this._equals=t,"function"!=typeof e)throw new Error("LruMap: bad hash function");if(this._hash=e,"number"!=typeof i||isNaN(i)||0>i)throw new Error("LruMap: bad maximum size");this._maxsize=i,this._keys=[],this._values=[],this._pivot=0}var r=t("../util/mod");n.prototype._modulus=function(){return this._maxsize>this._keys.length?this._keys.length+1:this._maxsize},n.prototype.get=function(t){for(var e=0;e<this._keys.length;e++){var i=this._keys[e];if(this._equals(t,i)){var n=this._values[e];return n}}return null},n.prototype.set=function(t,e){var i=null,n=!1;if(0===this._maxsize)return t;for(var s=0;s<this._keys.length;s++){var o=this._keys[s];if(this._equals(t,o)){for(var a=s,h=this._modulus();a!==this._pivot;){var l=r(a+1,h);this._keys[a]=this._keys[l],this._values[a]=this._values[l],a=l}n=!0;break}}return n||(i=this._pivot<this._keys.length?this._keys[this._pivot]:null),this._keys[this._pivot]=t,this._values[this._pivot]=e,this._pivot=r(this._pivot+1,this._modulus()),i},n.prototype.del=function(t){for(var e=0;e<this._keys.length;e++){var i=this._keys[e];if(this._equals(t,i)){for(var n=this._values[e],s=e;s<this._keys.length-1;s++)this._keys[s]=this._keys[s+1],this._values[s]=this._values[s+1];return this._keys.length=this._keys.length-1,this._values.length=this._values.length-1,e<this._pivot&&(this._pivot=r(this._pivot-1,this._modulus())),n}}return null},n.prototype.has=function(t){for(var e=0;e<this._keys.length;e++){var i=this._keys[e];if(this._equals(t,i))return!0}return!1},n.prototype.size=function(){return this._keys.length},n.prototype.clear=function(){this._keys.length=0,this._values.length=0,this._pivot=0},n.prototype.each=function(t){for(var e=0,i=0;i<this._keys.length;i++){var n=this._keys[i],r=this._values[i];t(n,r),e+=1}return e},e.exports=n},{"../util/mod":100}],23:[function(t,e,i){"use strict";function n(t,e,i){if("function"!=typeof t)throw new Error("LruSet: bad equals function");if(this._equals=t,"function"!=typeof e)throw new Error("LruSet: bad hash function");if(this._hash=e,"number"!=typeof i||isNaN(i)||0>i)throw new Error("LruSet: bad maximum size");this._maxsize=i,this._items=[],this._pivot=0}var r=t("../util/mod");n.prototype._modulus=function(){return this._maxsize>this._items.length?this._items.length+1:this._maxsize},n.prototype.add=function(t){var e=null,i=!1;if(0===this._maxsize)return t;for(var n=0;n<this._items.length;n++){var s=this._items[n];if(this._equals(t,s)){for(var o=n,a=this._modulus();o!==this._pivot;){var h=r(o+1,a);this._items[o]=this._items[h],o=h}i=!0;break}}return i||(e=this._pivot<this._items.length?this._items[this._pivot]:null),this._items[this._pivot]=t,this._pivot=r(this._pivot+1,this._modulus()),e},n.prototype.remove=function(t){for(var e=0;e<this._items.length;e++){var i=this._items[e];if(this._equals(t,i)){for(var n=e;n<this._items.length-1;n++)this._items[n]=this._items[n+1];return this._items.length=this._items.length-1,e<this._pivot&&(this._pivot=r(this._pivot-1,this._modulus())),i}}return null},n.prototype.has=function(t){for(var e=0;e<this._items.length;e++){var i=this._items[e];if(this._equals(t,i))return!0}return!1},n.prototype.size=function(){return this._items.length},n.prototype.clear=function(){this._items.length=0,this._pivot=0},n.prototype.each=function(t){for(var e=0,i=0;i<this._items.length;i++){var n=this._items[i];t(n),e+=1}return e},e.exports=n},{"../util/mod":100}],24:[function(t,e,i){"use strict";function n(t,e,i){if("function"!=typeof t)throw new Error("Map: bad equals function");if(this._equals=t,"function"!=typeof e)throw new Error("Map: bad hash function");if(this._hash=e,null!=i){if("number"!=typeof i||isNaN(i)||1>i)throw new Error("Map: bad number of buckets");this._nbuckets=i}else this._nbuckets=r;this._keyBuckets=[],this._valBuckets=[];for(var n=0;n<this._nbuckets;n++)this._keyBuckets.push([]),this._valBuckets.push([])}var r=32;n.prototype._hashmod=function(t){return this._hash(t)%this._nbuckets},n.prototype.get=function(t){for(var e=this._hashmod(t),i=this._keyBuckets[e],n=0;n<i.length;n++){var r=i[n];if(this._equals(t,r)){var s=this._valBuckets[e],o=s[n];return o}}return null},n.prototype.set=function(t,e){for(var i=this._hashmod(t),n=this._keyBuckets[i],r=this._valBuckets[i],s=0;s<n.length;s++){var o=n[s];if(this._equals(t,o)){var a=r[s];return n[s]=t,r[s]=e,a}}return n.push(t),r.push(e),null},n.prototype.del=function(t){for(var e=this._hashmod(t),i=this._keyBuckets[e],n=this._valBuckets[e],r=0;r<i.length;r++){var s=i[r];if(this._equals(t,s)){for(var o=n[r],a=r;a<i.length-1;a++)i[a]=i[a+1],n[a]=n[a+1];return i.length=i.length-1,n.length=n.length-1,o}}return null},n.prototype.has=function(t){for(var e=this._hashmod(t),i=this._keyBuckets[e],n=0;n<i.length;n++){var r=i[n];if(this._equals(t,r))return!0}return!1},n.prototype.size=function(){for(var t=0,e=0;e<this._nbuckets;e++){var i=this._keyBuckets[e];t+=i.length}return t},n.prototype.clear=function(){for(var t=0;t<this._nbuckets;t++){var e=this._keyBuckets[t],i=this._valBuckets[t];e.length=0,i.length=0}},n.prototype.each=function(t){for(var e=0,i=0;i<this._nbuckets;i++)for(var n=this._keyBuckets[i],r=this._valBuckets[i],s=0;s<n.length;s++){var o=n[s],a=r[s];t(o,a),e+=1}return e},e.exports=n},{}],25:[function(t,e,i){"use strict";function n(t,e,i){if("function"!=typeof t)throw new Error("Set: bad equals function");if(this._equals=t,"function"!=typeof e)throw new Error("Set: bad hash function");if(this._hash=e,null!=i){if("number"!=typeof i||isNaN(i)||1>i)throw new Error("Set: bad number of buckets");this._nbuckets=i}else this._nbuckets=r;this._buckets=[];for(var n=0;n<this._nbuckets;n++)this._buckets.push([])}var r=32;n.prototype._hashmod=function(t){return this._hash(t)%this._nbuckets},n.prototype.add=function(t){for(var e=this._hashmod(t),i=this._buckets[e],n=0;n<i.length;n++){var r=i[n];if(this._equals(t,r))return i[n]=t,r}return i.push(t),null},n.prototype.remove=function(t){for(var e=this._hashmod(t),i=this._buckets[e],n=0;n<i.length;n++){var r=i[n];if(this._equals(t,r)){for(var s=n;s<i.length-1;s++)i[s]=i[s+1];return i.length=i.length-1,r}}return null},n.prototype.has=function(t){for(var e=this._hashmod(t),i=this._buckets[e],n=0;n<i.length;n++){var r=i[n];if(this._equals(t,r))return!0}return!1},n.prototype.size=function(){for(var t=0,e=0;e<this._nbuckets;e++){var i=this._buckets[e];t+=i.length}return t},n.prototype.clear=function(){for(var t=0;t<this._nbuckets;t++){var e=this._buckets[t];e.length=0}},n.prototype.each=function(t){for(var e=0,i=0;i<this._nbuckets;i++)for(var n=this._buckets[i],r=0;r<n.length;r++){var s=n[r];t(s),e+=1}return e},e.exports=n},{}],26:[function(t,e,i){"use strict";function n(t){this._concurrency=t&&t.concurrency||1,this._paused=t&&!!t.paused||!1,this._pool=[];for(var e=0;e<this._concurrency;e++)this._pool.push(new r(t));this._next=0}var r=t("./WorkQueue"),s=t("../util/mod");n.prototype.length=function(){for(var t=0,e=0;e<this._pool.length;e++)t+=this._pool[e].length();return t},n.prototype.push=function(t,e){var i=this._next,n=this._pool[i].push(t,e);return this._next=s(this._next+1,this._concurrency),n},n.prototype.pause=function(){if(!this._paused){this._paused=!0;for(var t=0;t<this._concurrency;t++)this._pool[t].pause()}},n.prototype.resume=function(){if(this._paused){this._paused=!1;for(var t=0;t<this._concurrency;t++)this._pool[t].resume()}},e.exports=n},{"../util/mod":100,"./WorkQueue":27}],27:[function(t,e,i){"use strict";function n(t,e){this.fn=t,this.cb=e,this.cfn=null}function r(t){this._queue=[],this._delay=t&&t.delay||0,this._paused=t&&!!t.paused||!1,this._currentTask=null,this._lastFinished=null}var s=t("../util/clock");r.prototype.length=function(){return this._queue.length},r.prototype.push=function(t,e){var i=new n(t,e),r=this._cancel.bind(this,i);return this._queue.push(i),this._next(),r},r.prototype.pause=function(){this._paused||(this._paused=!0)},r.prototype.resume=function(){this._paused&&(this._paused=!1,this._next())},r.prototype._start=function(t){if(this._currentTask)throw new Error("WorkQueue: called start while running task");this._currentTask=t;var e=this._finish.bind(this,t);if(t.cfn=t.fn(e),"function"!=typeof t.cfn)throw new Error("WorkQueue: function is not cancellable")},r.prototype._finish=function(t){var e=Array.prototype.slice.call(arguments,1);if(this._currentTask!==t)throw new Error("WorkQueue: called finish on wrong task");t.cb.apply(null,e),this._currentTask=null,this._lastFinished=s(),this._next()},r.prototype._cancel=function(t){var e=Array.prototype.slice.call(arguments,1);if(this._currentTask===t)t.cfn.apply(null,e);else{var i=this._queue.indexOf(t);i>=0&&(this._queue.splice(i,1),t.cb.apply(null,e))}},r.prototype._next=function(){if(!this._paused&&this._queue.length&&!this._currentTask){if(null!=this._lastFinished){var t=s()-this._lastFinished,e=this._delay-t;if(e>0)return void setTimeout(this._next.bind(this),e)}var i=this._queue.shift();this._start(i)}},e.exports=r},{"../util/clock":89}],28:[function(t,e,i){"use strict";function n(t){this._element=t||document,this._keys={},this._keydownHandler=this._set.bind(this,!0),this._keyupHandler=this._set.bind(this,!1),this._blurHandler=this._unsetAll.bind(this),this._element.addEventListener("keydown",this._keydownHandler),this._element.addEventListener("keyup",this._keyupHandler),window.addEventListener("blur",this._blurHandler)}var r=t("../util/eventEmitter");r(n),n.prototype.destroy=function(){this._element.removeEventListener("keydown",this._keydownHandler),this._element.removeEventListener("keyup",this._keyupHandler),window.removeEventListener("blur",this._blurHandler)},n.prototype._set=function(t,e){var i=!1;for(var n in this._keys){var r=!1;this._keys[n][e.keyCode]&&(this._keys[n][e.keyCode].active!==t&&(i=!0,r=!0),this._keys[n][e.keyCode].active=t),r&&this.emit("changeOnType",n)}i&&this.emit("change")},n.prototype._unsetAll=function(){var t=!1;for(var e in this._keys){var i=!1;for(var n in this._keys[e])this._keys[e][n].active&&(i=!0,t=!0),this._keys[e][n].active=!1;i&&this.emit("changeOnType",e)}t&&this.emit("change")},n.prototype.register=function(t,e){return this._keys[e]=this._keys[e]||{},this._keys[e][t]?!1:void(this._keys[e][t]={isActive:!1})},n.prototype.count=function(t){var e=0;if(!this._keys[t])return 0;for(var i in this._keys[t])this._keys[t][i]&&this._keys[t][i].active&&(e+=1);return e},n.prototype.unregister=function(t,e){this._keys[e][t]=void 0},n.prototype.unregisterKey=function(t){for(var e in this._keys)this.unregister(t,e)},e.exports=n},{"../util/eventEmitter":96}],29:[function(t,e,i){"use strict";function n(t){t=t||{},this._methods=[],this._parameters=["x","y","axisScaledX","axisScaledY","zoom","yaw","pitch"],this._clock=t.clock||o,this._composedOffsets={},this._composeReturn={offsets:this._composedOffsets,changing:null}}var r=t("../util/eventEmitter"),s=t("./Dynamics"),o=t("../util/clock");r(n),n.prototype.add=function(t){if(!this.has(t)){var e={};this._parameters.forEach(function(t){e[t]={dynamics:new s,time:null}});var i=this._updateDynamics.bind(this,e),n={instance:t,dynamics:e,parameterDynamicsHandler:i};t.addEventListener("parameterDynamics",i),this._methods.push(n)}},n.prototype.remove=function(t){var e=this._indexOfInstance(t);if(e>=0){var i=this._methods.splice(e,1)[0];i.instance.removeEventListener("parameterDynamics",i.parameterDynamicsHandler)}},n.prototype.has=function(t){return this._indexOfInstance(t)>=0;

},n.prototype._indexOfInstance=function(t){for(var e=0;e<this._methods.length;e++)if(this._methods[e].instance===t)return e;return-1},n.prototype.list=function(){for(var t=[],e=0;e<this._methods.length;e++)t.push(this._methods[e].instance);return t},n.prototype._updateDynamics=function(t,e,i){var n=t[e];if(!n)throw new Error("Unknown control parameter "+e);var r=this._clock();n.dynamics.update(i,(r-n.time)/1e3),n.time=r,this.emit("change")},n.prototype._resetComposedOffsets=function(){for(var t=0;t<this._parameters.length;t++)this._composedOffsets[this._parameters[t]]=0},n.prototype.offsets=function(){var t,e=!1,i=this._clock();this._resetComposedOffsets();for(var n=0;n<this._methods.length;n++)for(var r=this._methods[n].dynamics,s=0;s<this._parameters.length;s++){t=this._parameters[s];var o=r[t],a=o.dynamics;null!=a.offset&&(this._composedOffsets[t]+=a.offset,a.offset=null);var h=(i-o.time)/1e3,l=a.offsetFromVelocity(h);l&&(this._composedOffsets[t]+=l);var u=a.velocityAfter(h);a.velocity=u,u&&(e=!0),o.time=i}return this._composeReturn.changing=e,this._composeReturn},n.prototype.destroy=function(){for(var t=this.list(),e=0;e<t.length;e++)this.remove(t[e]);this._methods=null},e.exports=n},{"../util/clock":89,"../util/eventEmitter":96,"./Dynamics":33}],30:[function(t,e,i){"use strict";function n(t){t=t||{},this._methods={},this._composer=new r,this._enabled=t&&t.enabled?!!t.enabled:!0,this._activeCount=0,this._attachedRenderLoop=null}var r=t("./Composer"),s=t("../util/eventEmitter"),o="undefined"!=typeof MARZIPANODEBUG&&MARZIPANODEBUG.controls;s(n),n.prototype.methods=function(){var t={};for(var e in this._methods)t[e]=this._methods[e];return t},n.prototype.method=function(t){return this._methods[t]},n.prototype.registerMethod=function(t,e){if(this._methods[t])throw new Error("Control method already registered with id "+t);this._methods[t]={instance:e,enabled:!1,active:!1,activeHandler:this._handleActive.bind(this,t),inactiveHandler:this._handleInactive.bind(this,t)}},n.prototype.unregisterMethod=function(t){var e=this._methods[t];if(!e)throw new Error("No control method registered with id "+t);e.enabled&&this.disableMethod(t),delete this._methods[t]},n.prototype.enableMethod=function(t){var e=this._methods[t];if(!e)throw new Error("No control method registered with id "+t);e.enabled||(e.enabled=!0,e.active&&this._incrementActiveCount(),this._listen(t),this._updateComposer(),this.emit("methodEnabled",t))},n.prototype.disableMethod=function(t){var e=this._methods[t];if(!e)throw new Error("No control method registered with id "+t);e.enabled&&(e.enabled=!1,e.active&&this._decrementActiveCount(),this._unlisten(t),this._updateComposer(),this.emit("methodDisabled",t))},n.prototype.enabled=function(){return this._enabled},n.prototype.enable=function(){this._enabled=!0,this._activeCount>0&&this.emit("active"),this._updateComposer()},n.prototype.disable=function(){this._enabled=!1,this._activeCount>0&&this.emit("inactive"),this._updateComposer()},n.prototype.attach=function(t){this._attachedRenderLoop&&this.detach(),this._attachedRenderLoop=t,this._beforeRenderHandler=this._updateViewsWithControls.bind(this),this._changeHandler=t.renderOnNextFrame.bind(t),this._attachedRenderLoop.addEventListener("beforeRender",this._beforeRenderHandler),this._composer.addEventListener("change",this._changeHandler)},n.prototype.detach=function(){this._attachedRenderLoop&&(this._attachedRenderLoop.removeEventListener("beforeRender",this._beforeRenderHandler),this._composer.removeEventListener("change",this._changeHandler),this._beforeRenderHandler=null,this._changeHandler=null,this._attachedRenderLoop=null)},n.prototype.attached=function(){return null!=this._attachedRenderLoop},n.prototype._listen=function(t){var e=this._methods[t];if(!e)throw new Error("Bad method id");e.instance.addEventListener("active",e.activeHandler),e.instance.addEventListener("inactive",e.inactiveHandler)},n.prototype._unlisten=function(t){var e=this._methods[t];if(!e)throw new Error("Bad method id");e.instance.removeEventListener("active",e.activeHandler),e.instance.removeEventListener("inactive",e.inactiveHandler)},n.prototype._handleActive=function(t){var e=this._methods[t];if(!e)throw new Error("Bad method id");if(!e.enabled)throw new Error("Should not receive event from disabled control method");e.active||(e.active=!0,this._incrementActiveCount())},n.prototype._handleInactive=function(t){var e=this._methods[t];if(!e)throw new Error("Bad method id");if(!e.enabled)throw new Error("Should not receive event from disabled control method");e.active&&(e.active=!1,this._decrementActiveCount())},n.prototype._incrementActiveCount=function(){this._activeCount++,o&&this._checkActiveCount(),this._enabled&&1===this._activeCount&&this.emit("active")},n.prototype._decrementActiveCount=function(){this._activeCount--,o&&this._checkActiveCount(),this._enabled&&0===this._activeCount&&this.emit("inactive")},n.prototype._checkActiveCount=function(){var t=0;for(var e in this._methods){var i=this._methods[e];i.enabled&&i.active&&t++}if(t!=this._activeCount)throw new Error("Bad control state")},n.prototype._updateComposer=function(){var t=this._composer;for(var e in this._methods){var i=this._methods[e],n=this._enabled&&i.enabled;n&&!t.has(i.instance)&&t.add(i.instance),!n&&t.has(i.instance)&&t.remove(i.instance)}},n.prototype._updateViewsWithControls=function(){var t=this._composer.offsets();t.changing&&this._attachedRenderLoop.renderOnNextFrame();for(var e=this._attachedRenderLoop.stage().listLayers(),i=0;i<e.length;i++)e[i].view().updateWithControlParameters(t.offsets)},n.prototype.destroy=function(){this.detach(),this._composer.destroy(),this._methods=null},e.exports=n},{"../util/eventEmitter":96,"./Composer":29}],31:[function(t,e,i){"use strict";function n(t,e,i){this._element=t,this._opts=o(i||{},l),this._startEvent=null,this._lastEvent=null,this._active=!1,this._dynamics={x:new r,y:new r},this._hammer=s.get(t,e),this._hammer.on("hammer.input",this._handleHammerEvent.bind(this)),this._hammer.on("panstart",this._handleStart.bind(this)),this._hammer.on("panmove",this._handleMove.bind(this)),this._hammer.on("panend",this._handleEnd.bind(this)),this._hammer.on("pancancel",this._handleEnd.bind(this))}var r=t("./Dynamics"),s=t("./HammerGestures"),o=t("../util/defaults"),a=t("../util/eventEmitter"),h=t("./util").maxFriction,l={friction:6,maxFrictionTime:.3},u="undefined"!=typeof MARZIPANODEBUG&&MARZIPANODEBUG.controls;a(n),n.prototype.destroy=function(){this._hammer.release(),this._element=null,this._opts=null,this._startEvent=null,this._lastEvent=null,this._active=null,this._dynamics=null,this._hammer=null},n.prototype._handleHammerEvent=function(t){if(t.isFirst){if(u&&this._active)throw new Error("DragControlMethod active detected when already active");this._active=!0,this.emit("active")}else if(t.isFinal){if(u&&!this._active)throw new Error("DragControlMethod inactive detected when already inactive");this._active=!1,this.emit("inactive")}},n.prototype._handleStart=function(t){t.preventDefault(),this._startEvent=t},n.prototype._handleMove=function(t){t.preventDefault(),this._startEvent&&(this._updateDynamicsMove(t),this.emit("parameterDynamics","axisScaledX",this._dynamics.x),this.emit("parameterDynamics","axisScaledY",this._dynamics.y))},n.prototype._handleEnd=function(t){t.preventDefault(),this._startEvent&&(this._updateDynamicsRelease(t),this.emit("parameterDynamics","axisScaledX",this._dynamics.x),this.emit("parameterDynamics","axisScaledY",this._dynamics.y)),this._startEvent=!1,this._lastEvent=!1},n.prototype._updateDynamicsMove=function(t){var e=t.deltaX,i=t.deltaY,n=this._lastEvent||this._startEvent;n&&(e-=n.deltaX,i-=n.deltaY);var r=this._element.getBoundingClientRect(),s=r.right-r.left,o=r.bottom-r.top;e/=s,i/=o,this._dynamics.x.reset(),this._dynamics.y.reset(),this._dynamics.x.offset=-1*e,this._dynamics.y.offset=i,this._lastEvent=t};var c=[null,null];n.prototype._updateDynamicsRelease=function(t){var e=this._element.getBoundingClientRect(),i=e.right-e.left,n=e.bottom-e.top,r=1e3*t.velocityX/i,s=-1e3*t.velocityY/n;this._dynamics.x.reset(),this._dynamics.y.reset(),this._dynamics.x.velocity=r,this._dynamics.y.velocity=s,h(this._opts.friction,this._dynamics.x.velocity,this._dynamics.y.velocity,this._opts.maxFrictionTime,c),this._dynamics.x.friction=c[0],this._dynamics.y.friction=c[1]},e.exports=n},{"../util/defaults":93,"../util/eventEmitter":96,"./Dynamics":33,"./HammerGestures":34,"./util":41}],32:[function(t,e,i){"use strict";function n(t,e,i,n){n=n||{},n.active=["move"],n.inactive=["default"],n.disabled=[null],this._controls=t,this._id=e,this._setActiveCursor=r.bind(null,i,n.active),this._setInactiveCursor=r.bind(null,i,n.inactive),this._setDisabledCursor=r.bind(null,i,n.disabled),t.method(e).enabled&&this._attachCursor(t.method(e));var s=this;this._methodEnabledHandler=function(i){i===e&&s._attachCursor(t.method(e))},this._methodDisabledHandler=function(i){i===e&&s._detachCursor(t.method(e))},t.addEventListener("methodEnabled",this._methodEnabledHandler),t.addEventListener("methodDisabled",this._methodDisabledHandler)}function r(t,e){e.forEach(function(e){t.style.cursor=e})}n.prototype.destroy=function(){this._detachCursor(this._controls.method(this._id)),this._controls.removeEventListener("methodEnabled",this._methodEnabledHandler),this._controls.removeEventListener("methodDisabled",this._methodDisabledHandler)},n.prototype._attachCursor=function(t){t.instance.addEventListener("active",this._setActiveCursor),t.instance.addEventListener("inactive",this._setInactiveCursor),t.active?this._setActiveCursor():this._setInactiveCursor()},n.prototype._detachCursor=function(t){t.instance.removeEventListener("active",this._setActiveCursor),t.instance.removeEventListener("inactive",this._setInactiveCursor),this._setDisabledCursor()},e.exports=n},{}],33:[function(t,e,i){"use strict";function n(){this.velocity=null,this.friction=null,this.offset=null}function r(t,e){return 0>t?Math.min(0,t+e):t>0?Math.max(0,t-e):0}n.equals=function(t,e){return t.velocity===e.velocity&&t.friction===e.friction&&t.offset===e.offset},n.prototype.equals=function(t){return n.equals(this,t)},n.prototype.update=function(t,e){t.offset&&(this.offset=this.offset||0,this.offset+=t.offset);var i=this.offsetFromVelocity(e);i&&(this.offset=this.offset||0,this.offset+=i),this.velocity=t.velocity,this.friction=t.friction},n.prototype.reset=function(){this.velocity=null,this.friction=null,this.offset=null},n.prototype.velocityAfter=function(t){return this.velocity?this.friction?r(this.velocity,this.friction*t):this.velocity:null},n.prototype.offsetFromVelocity=function(t){t=Math.min(t,this.nullVelocityTime());var e=this.velocityAfter(t),i=(this.velocity+e)/2;return i*t},n.prototype.nullVelocityTime=function(){return null==this.velocity?0:this.velocity&&!this.friction?1/0:Math.abs(this.velocity/this.friction)},e.exports=n},{}],34:[function(t,e,i){"use strict";function n(){this._managers=new h(r,s)}function r(t,e){return t===e}function s(t){for(var e=t.id||t.toString();e.length<5;)e+="0";return l(e.charCodeAt(0),e.charCodeAt(1),e.charCodeAt(2),e.charCodeAt(3),e.charCodeAt(4))}function o(t,e,i,n){this._manager=e,this._element=i,this._type=n,this._hammerGestures=t,this._eventHandlers=[]}var a=t("hammerjs"),h=t("../collections/Map"),l=t("../util/hash"),u=t("bowser").browser;n.prototype.get=function(t,e){this._managers.has(t)||this._managers.set(t,{});var i=this._managers.get(t);i[e]||(i[e]=this._createManager(t,e));var n=i[e];return n.refs+=1,new o(this,n.manager,t,e)},n.prototype._createManager=function(t,e){var i=new a.Manager(t);return"mouse"===e?i.add(new a.Pan({direction:a.DIRECTION_ALL,threshold:0})):("touch"===e||"pen"===e||"kinect"===e)&&(i.add(new a.Pan({direction:a.DIRECTION_ALL,threshold:20,pointers:1})),u.msie&&parseFloat(u.version)<10||i.add(new a.Pinch)),{manager:i,refs:0}},n.prototype._releaseHandle=function(t,e){var i=this._managers.get(t)[e];i.refs-=1,i.refs<=0&&(i.manager.destroy(),this._managers.get(t)[e]=null)},o.prototype.on=function(t,e){var i=this._type,n=function(t){i===t.pointerType&&e(t)};this._eventHandlers.push({events:t,handler:n}),this._manager.on(t,n)},o.prototype.release=function(){for(var t=0;t<this._eventHandlers.length;t++){var e=this._eventHandlers[t];this._manager.off(e.events,e.handler)}this._hammerGestures._releaseHandle(this._element,this._type),this._manager=null,this._element=null,this._type=null,this._hammerGestures=null},o.prototype.manager=function(){return this._manager},e.exports=new n},{"../collections/Map":24,"../util/hash":97,bowser:1,hammerjs:3}],35:[function(t,e,i){"use strict";function n(t,e){this._dynamics={x:new s,y:new s,zoom:new s},this._opts=o(e||{},h),this._activeKeys=new r;for(var i=Object.keys(t),n=0;n<i.length;n++)for(var a=i[n],l=0;l<t[a].length;l++)this._activeKeys.register(t[a][l],a);this._changeOnTypeHandler=this._updateDynamics.bind(this),this._activeKeys.addEventListener("changeOnType",this._changeOnTypeHandler)}var r=t("./ActiveKeys"),s=t("./Dynamics"),o=t("../util/defaults"),a=t("../util/eventEmitter"),h={velocity:.7,zoomVelocity:.7,friction:3,zoomFriction:3};a(n),n.prototype.destroy=function(){this._activeKeys.removeEventListener("changeOnType",this._changeOnTypeHandler),this._activeKeys.destroy(),this._changeOnTypeHandler=null,this._activeKeys=null,this._opts=null},n.prototype._updateDynamics=function(t){"right"===t||"left"===t?(this._setParameterDynamics("x",this._activation("right","left"),this._opts.velocity,this._opts.friction),this.emit("parameterDynamics","x",this._dynamics.x)):"up"===t||"down"===t?(this._setParameterDynamics("y",this._activation("up","down"),this._opts.velocity,this._opts.friction),this.emit("parameterDynamics","y",this._dynamics.y)):("out"===t||"in"===t)&&(this._setParameterDynamics("zoom",this._activation("out","in"),this._opts.zoomVelocity,this._opts.zoomFriction),this.emit("parameterDynamics","zoom",this._dynamics.zoom)),this.emit("active"),this.emit("inactive")},n.prototype._activation=function(t,e){var i=this._activeKeys.count(t)-this._activeKeys.count(e);return i>0?1:0>i?-1:0},n.prototype._setParameterDynamics=function(t,e,i,n){0!==e&&(this._dynamics[t].velocity=i*e),this._dynamics[t].friction=0===e?n:null},e.exports=n},{"../util/defaults":93,"../util/eventEmitter":96,"./ActiveKeys":28,"./Dynamics":33}],36:[function(t,e,i){"use strict";function n(t,e,i){this._hammer=s.get(t,e),this._lastEvent=null,this._active=!1,this._dynamics=new r,this._hammer.on("pinchstart",this._handleStart.bind(this)),this._hammer.on("pinch",this._handleEvent.bind(this)),this._hammer.on("pinchend",this._handleEnd.bind(this)),this._hammer.on("pinchcancel",this._handleEnd.bind(this))}var r=t("./Dynamics"),s=t("./HammerGestures"),o=t("../util/eventEmitter");o(n),n.prototype.destroy=function(){this._hammer.release(),this._hammer=null,this._lastEvent=null,this._active=null,this._dynamics=null},n.prototype._handleStart=function(){this._active||(this._active=!0,this.emit("active"))},n.prototype._handleEnd=function(){this._lastEvent=null,this._active&&(this._active=!1,this.emit("inactive"))},n.prototype._handleEvent=function(t){var e=t.scale;this._lastEvent&&(e/=this._lastEvent.scale),this._dynamics.offset=-1*(e-1),this.emit("parameterDynamics","zoom",this._dynamics),this._lastEvent=t},e.exports=n},{"../util/eventEmitter":96,"./Dynamics":33,"./HammerGestures":34}],37:[function(t,e,i){"use strict";function n(t,e,i){this._element=t,this._opts=o(i||{},l),this._active=!1,this._hammer=s.get(t,e),this._dynamics={x:new r,y:new r},this._hammer.on("panstart",this._handleStart.bind(this)),this._hammer.on("panmove",this._handleMove.bind(this)),this._hammer.on("panend",this._handleRelease.bind(this)),this._hammer.on("pancancel",this._handleRelease.bind(this))}var r=t("./Dynamics"),s=t("./HammerGestures"),o=t("../util/defaults"),a=t("../util/eventEmitter"),h=t("./util").maxFriction,l={speed:8,friction:6,maxFrictionTime:.3};a(n),n.prototype.destroy=function(){this._hammer.release(),this._hammer=null,this._element=null,this._opts=null,this._active=null,this._dynamics=null},n.prototype._handleStart=function(t){t.preventDefault(),this._active||(this._active=!0,this.emit("active"))},n.prototype._handleMove=function(t){t.preventDefault(),this._updateDynamics(t,!1)},n.prototype._handleRelease=function(t){t.preventDefault(),this._updateDynamics(t,!0),this._active&&(this._active=!1,this.emit("inactive"))};var u=[null,null];n.prototype._updateDynamics=function(t,e){var i=this._element.getBoundingClientRect(),n=i.right-i.left,r=i.bottom-i.top,s=Math.max(n,r),o=t.deltaX/s*this._opts.speed,a=-t.deltaY/s*this._opts.speed;this._dynamics.x.reset(),this._dynamics.y.reset(),this._dynamics.x.velocity=o,this._dynamics.y.velocity=a,e&&(h(this._opts.friction,this._dynamics.x.velocity,this._dynamics.y.velocity,this._opts.maxFrictionTime,u),this._dynamics.x.friction=u[0],this._dynamics.y.friction=u[1]),this.emit("parameterDynamics","x",this._dynamics.x),this.emit("parameterDynamics","y",this._dynamics.y)},e.exports=n},{"../util/defaults":93,"../util/eventEmitter":96,"./Dynamics":33,"./HammerGestures":34,"./util":41}],38:[function(t,e,i){"use strict";function n(t,e){this._opts=a(e||{},l),this._dynamics=new s,this._eventList=[];var i=this._opts.frictionTime?this.withSmoothing:this.withoutSmoothing;this._wheelListener=new o(t,i.bind(this))}function r(t){var e=1==t.deltaMode?20:1;return t.deltaY*e}var s=t("./Dynamics"),o=t("./WheelListener"),a=t("../util/defaults"),h=t("../util/eventEmitter"),l={frictionTime:.2,zoomDelta:.001};h(n),n.prototype.destroy=function(){this._wheelListener.remove(),this._opts=null,this._dynamics=null,this._eventList=null},n.prototype.withoutSmoothing=function(t){this._dynamics.offset=r(t)*this._opts.zoomDelta,this.emit("parameterDynamics","zoom",this._dynamics),t.preventDefault(),this.emit("active"),this.emit("inactive")},n.prototype.withSmoothing=function(t){var e=t.timeStamp;for(this._eventList.push(t);this._eventList[0].timeStamp<e-1e3*this._opts.frictionTime;)this._eventList.shift(0);for(var i=0,n=0;n<this._eventList.length;n++){var s=r(this._eventList[n])*this._opts.zoomDelta;i+=s/this._opts.frictionTime}this._dynamics.velocity=i,this._dynamics.friction=Math.abs(i)/this._opts.frictionTime,this.emit("parameterDynamics","zoom",this._dynamics),t.preventDefault(),this.emit("active"),this.emit("inactive")},e.exports=n},{"../util/defaults":93,"../util/eventEmitter":96,"./Dynamics":33,"./WheelListener":39}],39:[function(t,e,i){"use strict";function n(){return"onwheel"in document.createElement("div")?"wheel":void 0!==document.onmousewheel?"mousewheel":null}function r(t,e,i){var r=n();if("wheel"===r)this._fun=e,this._elem=t,this._elem.addEventListener("wheel",this._fun,i);else{if("mousewheel"!==r)throw new Error("Browser does not support mouse wheel events");this._fun=s(e),this._elem=t,this._elem.addEventListener("mousewheel",this._fun,i)}}function s(t){return function(e){e||(e=window.event);var i={originalEvent:e,target:e.target||e.srcElement,type:"wheel",deltaMode:1,deltaX:0,deltaZ:0,timeStamp:e.timeStamp||Date.now(),preventDefault:e.preventDefault.bind(e)};return i.deltaY=-1/40*e.wheelDelta,e.wheelDeltaX&&(i.deltaX=-1/40*e.wheelDeltaX),t(i)}}r.prototype.remove=function(){var t=n();"wheel"===t?this._elem.removeEventListener("wheel",this._fun):"mousewheel"===t&&this._elem.removeEventListener("mousewheel",this._fun)},e.exports=r},{}],40:[function(t,e,i){"use strict";function n(t,e,i){i=r(i||{},u);var n={left:[37,65],up:[38,87],right:[39,68],down:[40,83],"in":[107],out:[109]},c={keyboard:new s(n),mouseViewDrag:new o(e,"mouse"),mouseViewQtvr:new a(e,"mouse"),scrollZoom:new h(e),touchView:new o(e,"touch"),pinch:new l(e,"touch")},p=["gyro"];switch(i.mouseViewMode){case"drag":p.push("mouseViewQtvr");break;case"qtvr":p.push("mouseViewDrag");break;default:throw new Error("Unknown mouse view mode: "+i.mouseViewMode)}for(var f in c){var d=c[f];t.registerMethod(f,d),p.indexOf(f)<0&&t.enableMethod(f)}return c}var r=t("../util/defaults"),s=t("./Keyboard"),o=t("./Drag"),a=t("./Qtvr"),h=t("./ScrollZoom"),l=t("./PinchZoom"),u={mouseViewMode:"drag"};e.exports=n},{"../util/defaults":93,"./Drag":31,"./Keyboard":35,"./PinchZoom":36,"./Qtvr":37,"./ScrollZoom":38}],41:[function(t,e,i){"use strict";function n(t,e,i,n,s){var o=Math.sqrt(Math.pow(e,2)+Math.pow(i,2));t=Math.max(t,o/n),r(e,i,t,s),s[0]=Math.abs(s[0]),s[1]=Math.abs(s[1])}function r(t,e,i,n){var r=Math.atan(e/t);n[0]=i*Math.cos(r),n[1]=i*Math.sin(r)}e.exports={maxFriction:n,changeVectorNorm:r}},{}],42:[function(t,e,i){"use strict";function n(t){for(var e=document.documentElement.style,i=["Moz","Webkit","Khtml","O","ms"],n=0;n<i.length;n++){var r=i[n],s=t[0].toUpperCase()+t.slice(1),o=r+s;if(o in e)return o}return t}function r(t){var e=n(t);return function(t){return t.style[e]}}function s(t){var e=n(t);return function(t,i){return t.style[e]=i}}function o(t){m(t,"translateZ(0)")}function a(t){v(t,"0 0 0")}function h(t){t.style.position="absolute"}function l(t,e,i){t.style.width=e+"px",t.style.height=i+"px"}function u(t){t.style.width=t.style.height=0}function c(t){t.style.width=t.style.height="100%"}function p(t){t.style.overflow="hidden"}function f(t){t.style.pointerEvents="none"}function d(t){t.style.backgroundColor="#000",t.style.opacity="0",t.style.filter="alpha(opacity=0)"}var m=s("transform"),v=s("transformOrigin");e.exports={prefixProperty:n,getWithVendorPrefix:r,setWithVendorPrefix:s,setTransform:m,setTransformOrigin:v,setNullTransform:o,setNullTransformOrigin:a,setAbsolute:h,setPixelSize:l,setNullSize:u,setFullSize:c,setOverflowHidden:p,setNoPointerEvents:f,setBlocking:d}},{}],43:[function(t,e,i){"use strict";function n(t,e,i,n,r){this.face=t,this.x=e,this.y=i,this.z=n,this._cube=r}function r(t){if(this.constructor.super_.call(this,t),this._size=t.size,this._tileSize=t.tileSize,this._size%this._tileSize!==0)throw new Error("Level size is not multiple of tile size: "+this._size+" "+this._tileSize)}function s(t){if("array"!==y(t))throw new Error("Argument 0 must be an array");this.levelList=p(t,r),this.selectableLevelList=f(this.levelList),d(this.levelList),this._graphFinder=new h(n.equals,n.hash),this._neighborsCache=new u(n.equals,n.hash,64),this._vec=m.create(),this._tileVertices=[m.create(),m.create(),m.create(),m.create()]}for(var o=t("../util/inherits"),a=t("../util/hash"),h=t("../GraphFinder"),l=t("../util/rotateVector"),u=t("../collections/LruMap"),c=t("./Level"),p=t("./common").makeLevelList,f=t("./common").makeSelectableLevelList,d=t("./common").checkLevelDimensions,m=t("gl-matrix").vec3,v=t("../util/clamp"),_=t("../util/cmp"),y=t("../util/type"),g="fblrud",w={f:{x:0,y:0},b:{x:0,y:Math.PI},l:{x:0,y:Math.PI/2},r:{x:0,y:-Math.PI/2},u:{x:Math.PI/2,y:0},d:{x:-Math.PI/2,y:0}},x={},b=0;b<g.length;b++){var E=g[b],T=w[E],M=m.fromValues(0,0,-1);l(M,M,0,T.y,T.x),x[E]=M}var C={f:["l","r","u","d"],b:["r","l","u","d"],l:["b","f","u","d"],r:["f","b","u","d"],u:["l","r","b","f"],d:["l","r","f","b"]},L=[[0,1],[1,0],[0,-1],[-1,0]];n.prototype.level=function(){return this._cube.levelList[this.z]},n.prototype.rotX=function(){return w[this.face].x},n.prototype.rotY=function(){return w[this.face].y},n.prototype.centerX=function(){return(this.x+.5)/this.level().numHorizontalTiles()-.5},n.prototype.centerY=function(){return.5-(this.y+.5)/this.level().numVerticalTiles()},n.prototype.scaleX=function(){return 1/this.level().numHorizontalTiles()},n.prototype.scaleY=function(){return 1/this.level().numVerticalTiles()},n.prototype.width=function(){return this.level().tileWidth()},n.prototype.height=function(){return this.level().tileHeight()},n.prototype.levelWidth=function(){return this.level().width()},n.prototype.levelHeight=function(){return this.level().height()},n.prototype.vertices=function(t){return this._cube.vertices(this,t)},n.prototype.atTopLevel=function(){return 0===this.z},n.prototype.atBottomLevel=function(){return this.z===this._cube.levelList.length-1},n.prototype.parent=function(){return this._cube.parent(this)},n.prototype.children=function(t){return this._cube.children(this,t)},n.prototype.atTopEdge=function(){return 0===this.y},n.prototype.atBottomEdge=function(){return this.y===this.level().numVerticalTiles()-1},n.prototype.atLeftEdge=function(){return 0===this.x},n.prototype.atRightEdge=function(){return this.x===this.level().numHorizontalTiles()-1},n.prototype.padTop=function(){return this.atTopEdge()&&/[fu]/.test(this.face)},n.prototype.padBottom=function(){return!this.atBottomEdge()||/[fd]/.test(this.face)},n.prototype.padLeft=function(){return this.atLeftEdge()&&/[flud]/.test(this.face)},n.prototype.padRight=function(){return!this.atRightEdge()||/[frud]/.test(this.face)},n.hash=function(t){return null!=t?a(t.face.charCodeAt(0),t.z,t.x,t.y):0},n.equals=function(t,e){return null!=t&&null!=e&&t.face===e.face&&t.z===e.z&&t.x===e.x&&t.y===e.y},n.cmp=function(t,e){var i="fudlrb".indexOf(t.face),n="fudlrb".indexOf(e.face);return _(t.z,e.z)||_(i,n)||_(t.y,e.y)||_(t.x,e.x)},n.str=function(t){return"CubeTile("+t.face+", "+t.x+", "+t.y+", "+t.z+")"},n.prototype.hash=function(){return n.hash(this)},n.prototype.equals=function(t){return n.equals(this,t)},n.prototype.cmp=function(t){return n.cmp(this,t)},n.prototype.str=function(){return n.str(this)},o(r,c),r.prototype.width=function(){return this._size},r.prototype.height=function(){return this._size},r.prototype.tileWidth=function(){return this._tileSize},r.prototype.tileHeight=function(){return this._tileSize},s.prototype.maxTileSize=function(){for(var t=0,e=0;e<this.levelList.length;e++){var i=this.levelList[e];t=Math.max(t,i.tileWidth,i.tileHeight)}return t},s.prototype._tile=function(t,e,i,r){return new n(t,e,i,r,this)},s.prototype.tileAt=function(t,e,i){var r=this._vec,s=1/0,o=null;m.set(r,0,0,-1),l(r,r,0,-t,-e);for(var a in x){var h=x[a],u=1-m.dot(h,r);s>u&&(s=u,o=a)}for(var c=Math.max(Math.abs(r[0]),Math.abs(r[1]),Math.abs(r[2]))/.5,p=0;3>p;p++)r[p]=r[p]/c;var f=w[o];l(r,r,0,-f.y,-f.x);var d=this.levelList.indexOf(i),_=i.numHorizontalTiles(),y=i.numVerticalTiles(),g=r[0],b=r[1],E=v(Math.floor((.5+g)*_),0,_-1),T=v(Math.floor((.5-b)*y),0,y-1);return new n(o,E,T,d,this)},s.prototype.neighbors=function(t){var e=this._neighborsCache.get(t);if(e)return e;for(var i=this._vec,r=t.face,s=t.x,o=t.y,a=t.z,h=t.level(),u=h.numHorizontalTiles(),c=h.numVerticalTiles(),p=[],f=0;f<L.length;f++){var d=L[f][0],_=L[f][1],y=s+d,g=o+_,x=r;if(0>y||y>=u||0>g||g>=c){var b=t.centerX(),E=t.centerY();0>y?(m.set(i,-.5,E,-.5),x=C[r][0]):y>=u?(m.set(i,.5,E,-.5),x=C[r][1]):0>g?(m.set(i,b,.5,-.5),x=C[r][2]):g>=c&&(m.set(i,b,-.5,-.5),x=C[r][3]);var T;T=w[r],l(i,i,0,T.y,T.x),T=w[x],l(i,i,0,-T.y,-T.x),y=v(Math.floor((.5+i[0])*u),0,u-1),g=v(Math.floor((.5-i[1])*c),0,c-1)}p.push(new n(x,y,g,a,this))}return this._neighborsCache.set(t,p),p},s.prototype.vertices=function(t,e){function i(e,i,n){switch(t.face){case"f":m.set(e,i,n,-.5);break;case"b":m.set(e,-i,n,.5);break;case"l":m.set(e,-.5,n,-i);break;case"r":m.set(e,.5,n,i);break;case"u":m.set(e,i,.5,n);break;case"d":m.set(e,i,-.5,-n);break;default:throw new Error("bad cube face")}}var n=t.centerX()-t.scaleX()/2,r=t.centerX()+t.scaleX()/2,s=t.centerY()-t.scaleY()/2,o=t.centerY()+t.scaleY()/2;return i(e[0],n,o),i(e[1],r,o),i(e[2],r,s),i(e[3],n,s),e},s.prototype.getLevelTiles=function(t,e){var i=this.levelList.indexOf(t),r=t.numHorizontalTiles()-1,s=t.numVerticalTiles()-1;e||(e=[]);for(var o=0;o<g.length;o++)for(var a=g[o],h=0;r>=h;h++)for(var l=0;s>=l;l++)e.push(new n(a,h,l,i,this));return e},s.prototype.parent=function(t){if(t.atTopLevel())return null;var e=t.z-1,i=t.face,r=t.x/t.level().numHorizontalTiles(),s=t.y/t.level().numVerticalTiles(),o=this.levelList[e],a=Math.floor(r*o.numHorizontalTiles()),h=Math.floor(s*o.numVerticalTiles());return new n(i,a,h,e,this)},s.prototype.children=function(t,e){if(t.atBottomLevel())return null;e||(e=[]);for(var i=t.z+1,r=t.level(),s=this.levelList[i],o=s.numHorizontalTiles()/r.numHorizontalTiles(),a=s.numVerticalTiles()/r.numVerticalTiles(),h=0;o>h;h++)for(var l=0;a>l;l++)e.push(new n(t.face,o*t.x+h,a*t.y+l,i,this));return e},s.prototype.visibleTiles=function(t,e,i){function n(e){return e.vertices(r),t.intersects(r)}var r=this._tileVertices,s=this._graphFinder,o=this.tileAt(t.yaw(),t.pitch(),e);if(!n(o))throw new Error("Starting tile is not visible");i||(i=[]);var a;for(s.start(o,this.neighbors.bind(this),n);null!=(a=s.next());)i.push(a);return i},s.TileClass=s.prototype.TileClass=n,s.type=s.prototype.type="cube",n.type=n.prototype.type="cube",e.exports=s},{"../GraphFinder":5,"../collections/LruMap":22,"../util/clamp":88,"../util/cmp":90,"../util/hash":97,"../util/inherits":98,"../util/rotateVector":107,"../util/type":109,"./Level":46,"./common":47,"gl-matrix":2}],44:[function(t,e,i){"use strict";function n(t,e){this.z=t,this._equirect=e}function r(t){this.constructor.super_.call(this,t),this._width=t.width}function s(t){if("array"!==c(t))throw new Error("Argument 0 must be an array");this.levelList=l.makeLevelList(t,r),this.selectableLevelList=l.makeSelectableLevelList(this.levelList)}var o=t("../util/inherits"),a=t("../util/hash"),h=t("../util/cmp"),l=t("./common"),u=t("./Level"),c=t("../util/type");n.prototype.level=function(){return this._equirect.levelList[this.z]},n.prototype.width=function(){return this.level().tileWidth()},n.prototype.height=function(){return this.level().tileHeight()},n.prototype.atTopLevel=function(){return 0===this.z},n.prototype.atBottomLevel=function(){return this.z===this._equirect.levelList.length-1},n.prototype.padTop=function(){return!1},n.prototype.padBottom=function(){return!1},n.prototype.padLeft=function(){return!1},n.prototype.padRight=function(){return!1},n.prototype.neighbors=function(){return this._equirect.neighbors(this)},n.prototype.parent=function(){return this._equirect.parent(this)},n.prototype.children=function(t){return this._equirect.children(this,t)},n.prototype.atTopEdge=function(){return!0},n.prototype.atBottomEdge=function(){return!0},n.prototype.atLeftEdge=function(){return!0},n.prototype.atRightEdge=function(){return!0},n.hash=function(t){return a(t.z)},n.equals=function(t,e){return t.z===e.z},n.cmp=function(t,e){return h(t.z,e.z)},n.str=function(t){return"EquirectTile("+t.z+")"},n.prototype.hash=function(){return n.hash(this)},n.prototype.equals=function(t){return n.equals(this,t)},n.prototype.cmp=function(t){return n.cmp(this,t)},n.prototype.str=function(){return n.str(this)},o(r,u),r.prototype.width=function(){return this._width},r.prototype.height=function(){return this._width/2},r.prototype.tileWidth=function(){return this._width},r.prototype.tileHeight=function(){return this._width/2},s.prototype.maxTileSize=function(){for(var t=0,e=0;e<this.levelList.length;e++){var i=this.levelList[e];t=Math.max(t,i.tileWidth,i.tileHeight)}return t},s.prototype.getLevelTiles=function(t,e){var i=this.levelList.indexOf(t);return e||(e=[]),e.push(new n(i,this)),e},s.prototype.parent=function(t){return t.atTopLevel()?null:new n(t.z-1,this)},s.prototype.children=function(t,e){return t.atBottomLevel()?null:(e||(e=[]),e.push(new n(t.z+1,this)),e)},s.prototype.neighbors=function(t){return[]},s.prototype.getFirstLevel=function(){return new n(0,this)},s.prototype.visibleTiles=function(t,e,i){var r=new n(this.levelList.indexOf(e),this);i||(i=[]),i.length=0,i.push(r)},s.TileClass=s.prototype.TileClass=n,s.type=s.prototype.type="equirect",n.type=n.prototype.type="equirect",n.disableMipmapping=n.prototype.disableMipmapping=!0,e.exports=s},{"../util/cmp":90,"../util/hash":97,"../util/inherits":98,"../util/type":109,"./Level":46,"./common":47}],45:[function(t,e,i){"use strict";function n(t,e,i,n){this.x=t,this.y=e,this.z=i,this._flat=n}function r(t){if(this.constructor.super_.call(this,t),this._width=t.width,this._height=t.height,this._tileWidth=t.tileWidth,this._tileHeight=t.tileHeight,this._width%this._tileWidth!==0)throw new Error("Level width is not multiple of tile width: "+this._width+" vs. "+this._tileWidth);

if(this._height%this._tileHeight!==0)throw new Error("Level height is not multiple of tile height: "+this._height+" vs. "+this._tileHeight)}function s(t){if("array"!==_(t))throw new Error("Argument 0 must be an array");this.levelList=c(t,r),this.selectableLevelList=p(this.levelList),f(this.levelList),this._graphFinder=new h(n.equals,n.hash),this._neighborsCache=new l(n.equals,n.hash,64),this._tileVertices=[d.create(),d.create(),d.create(),d.create()]}var o=t("../util/inherits"),a=t("../util/hash"),h=t("../GraphFinder"),l=t("../collections/LruMap"),u=t("./Level"),c=t("./common").makeLevelList,p=t("./common").makeSelectableLevelList,f=t("./common").checkLevelDimensions,d=t("gl-matrix").vec2,m=t("../util/clamp"),v=t("../util/cmp"),_=t("../util/type"),y=[[0,1],[1,0],[0,-1],[-1,0]];n.prototype.level=function(){return this._flat.levelList[this.z]},n.prototype.rotX=function(){return 0},n.prototype.rotY=function(){return 0},n.prototype.centerX=function(){return(this.x+.5)/this.level().numHorizontalTiles()},n.prototype.centerY=function(){return-(this.y+.5)/this.level().numVerticalTiles()},n.prototype.scaleX=function(){return 1/this.level().numHorizontalTiles()},n.prototype.scaleY=function(){return 1/this.level().numVerticalTiles()},n.prototype.width=function(){return this.level().tileWidth()},n.prototype.height=function(){return this.level().tileHeight()},n.prototype.levelWidth=function(){return this.level().width()},n.prototype.levelHeight=function(){return this.level().height()},n.prototype.vertices=function(t){return this._flat.vertices(this,t)},n.prototype.atTopLevel=function(){return 0===this.z},n.prototype.atBottomLevel=function(){return this.z===this._flat.levelList.length-1},n.prototype.neighbors=function(){return this._flat.neighbors(this)},n.prototype.parent=function(){return this._flat.parent(this)},n.prototype.children=function(t){return this._flat.children(this,t)},n.prototype.atTopEdge=function(){return 0===this.y},n.prototype.atBottomEdge=function(){return this.y===this.level().numVerticalTiles()-1},n.prototype.atLeftEdge=function(){return 0===this.x},n.prototype.atRightEdge=function(){return this.x===this.level().numHorizontalTiles()-1},n.prototype.padTop=function(){return!1},n.prototype.padBottom=function(){return!this.atBottomEdge()},n.prototype.padLeft=function(){return!1},n.prototype.padRight=function(){return!this.atRightEdge()},n.hash=function(t){return null!=t?a(t.z,t.x,t.y):0},n.equals=function(t,e){return null!=t&&null!=e&&t.z===e.z&&t.x===e.x&&t.y===e.y},n.cmp=function(t,e){return v(t.z,e.z)||v(t.y,e.y)||v(t.x,e.x)},n.str=function(t){return"FlatTile("+t.x+", "+t.y+", "+t.z+")"},n.prototype.hash=function(){return n.hash(this)},n.prototype.equals=function(t){return n.equals(this,t)},n.prototype.cmp=function(t){return n.cmp(this,t)},n.prototype.str=function(){return n.str(this)},o(r,u),r.prototype.width=function(){return this._width},r.prototype.height=function(){return this._height},r.prototype.tileWidth=function(){return this._tileWidth},r.prototype.tileHeight=function(){return this._tileHeight},s.prototype.maxTileSize=function(){for(var t=0,e=0;e<this.levelList.length;e++){var i=this.levelList[e];t=Math.max(t,i.tileWidth,i.tileHeight)}return t},s.prototype.vertices=function(t,e){var i=t.centerX()-t.scaleX()/2,n=t.centerX()+t.scaleX()/2,r=t.centerY()-t.scaleY()/2,s=t.centerY()+t.scaleY()/2;return d.set(e[0],i,s),d.set(e[1],n,s),d.set(e[2],n,r),d.set(e[3],i,r),e},s.prototype.getLevelTiles=function(t,e){var i=this.levelList.indexOf(t),r=t.numHorizontalTiles()-1,s=t.numVerticalTiles()-1;e||(e=[]);for(var o=0;r>=o;o++)for(var a=0;s>=a;a++)e.push(new n(o,a,i,this));return e},s.prototype.parent=function(t){if(t.atTopLevel())return null;var e=t.z-1,i=Math.floor(t.x/2),r=Math.floor(t.y/2);return new n(i,r,e,this)},s.prototype.children=function(t,e){if(t.atBottomLevel())return null;e||(e=[]);var i=t.z+1;return e.push(new n(2*t.x,2*t.y,i,this)),e.push(new n(2*t.x,2*t.y+1,i,this)),e.push(new n(2*t.x+1,2*t.y,i,this)),e.push(new n(2*t.x+1,2*t.y+1,i,this)),e},s.prototype.neighbors=function(t){var e=this._neighborsCache.get(t);if(e)return e;for(var i=t.x,r=t.y,s=t.z,o=t.level(),a=o.numHorizontalTiles()-1,h=o.numVerticalTiles()-1,l=[],u=0;u<y.length;u++){var c=y[u][0],p=y[u][1],f=i+c,d=r+p;f>=0&&a>=f&&d>=0&&h>=d&&l.push(new n(f,d,s,this))}return this._neighborsCache.set(t,l),l},s.prototype.getFirstLevel=function(t){var e=this.levelList[0],i=e.numHorizontalTiles()-1,r=e.numVerticalTiles()-1;t||(t=[]);for(var s=0;i>=s;s++)for(var o=0;r>=o;o++)t.push(new n(s,o,0,this));return t},s.prototype.tileAt=function(t,e,i){var r=this.levelList.indexOf(i),s=i.numHorizontalTiles(),o=i.numVerticalTiles(),a=m(Math.floor(t*s),0,s-1),h=m(Math.floor(e*o),0,o-1);return new n(a,h,r,this)},s.prototype.visibleTiles=function(t,e,i){function n(e){return e.vertices(r),t.intersects(r)}var r=this._tileVertices,s=this._graphFinder,o=this.tileAt(t.x(),t.y(),e);if(!n(o))throw new Error("Starting tile is not visible");i||(i=[]);var a;for(s.start(o,this.neighbors.bind(this),n);null!=(a=s.next());)i.push(a);return i},s.TileClass=s.prototype.TileClass=n,s.type=s.prototype.type="flat",n.type=n.prototype.type="flat",e.exports=s},{"../GraphFinder":5,"../collections/LruMap":22,"../util/clamp":88,"../util/cmp":90,"../util/hash":97,"../util/inherits":98,"../util/type":109,"./Level":46,"./common":47,"gl-matrix":2}],46:[function(t,e,i){"use strict";function n(t){this._fallbackOnly=!!t.fallbackOnly}n.prototype.numHorizontalTiles=function(){return this.width()/this.tileWidth()},n.prototype.numVerticalTiles=function(){return this.height()/this.tileHeight()},n.prototype.fallbackOnly=function(){return this._fallbackOnly},e.exports=n},{}],47:[function(t,e,i){"use strict";function n(t){for(var e=1;e<t.length;e++){var i=t[e],n=t[e-1];if(i.width()%n.width()!==0)throw new Error("Level width must be multiple of previous level: "+i.width()+" vs. "+n.width());if(i.height()%n.height()!==0)throw new Error("Level height must be multiple of previous level: "+i.height()+" vs. "+n.height());if(i.numHorizontalTiles()%n.numHorizontalTiles()!==0)throw new Error("Number of horizontal tiles must be multiple of that on parent level: "+i.numHorizontalTiles()+" ("+i.width()+"/"+i.tileWidth()+") vs. "+n.numHorizontalTiles()+" ("+n.width()+"/"+n.tileWidth()+")");if(i.numVerticalTiles()%n.numVerticalTiles()!==0)throw new Error("Number of vertical tiles must be multiple of that on parent level: "+i.numVerticalTiles()+" ("+i.height()+"/"+i.tileHeight()+") vs. "+n.numVerticalTiles()+" ("+n.height()+"/"+n.tileHeight()+")")}}function r(t,e){for(var i=[],n=0;n<t.length;n++)i.push(new e(t[n]));return i.sort(function(t,e){return o(t.width(),e.width())}),i}function s(t){var e=t.filter(function(t){return!t.fallbackOnly()});if(!e.length)throw new Error("No selectable levels in list");return e}var o=t("../util/cmp");e.exports={makeLevelList:r,makeSelectableLevelList:s,checkLevelDimensions:n}},{"../util/cmp":90}],48:[function(t,e,i){var n=t("./index");n.Viewer=t("./WatermarkedViewer"),e.exports=n},{"./WatermarkedViewer":14,"./index":49}],49:[function(t,e,i){e.exports={WebGlStage:t("./stages/WebGl"),CssStage:t("./stages/Css"),FlashStage:t("./stages/Flash"),WebGlCubeRenderer:t("./renderers/WebGlCube"),WebGlFlatRenderer:t("./renderers/WebGlFlat"),WebGlEquirectRenderer:t("./renderers/WebGlEquirect"),CssCubeRenderer:t("./renderers/CssCube"),CssFlatRenderer:t("./renderers/CssFlat"),FlashCubeRenderer:t("./renderers/FlashCube"),FlashFlatRenderer:t("./renderers/FlashFlat"),registerDefaultRenderers:t("./renderers/registerDefaultRenderers"),CubeGeometry:t("./geometries/Cube"),FlatGeometry:t("./geometries/Flat"),EquirectGeometry:t("./geometries/Equirect"),RectilinearView:t("./views/Rectilinear"),FlatView:t("./views/Flat"),ImageUrlSource:t("./sources/ImageUrl"),VideoUrlSource:t("./sources/VideoUrl"),SolidColorSource:t("./sources/SolidColor"),DynamicCanvasAsset:t("./assets/DynamicCanvas"),TextureStore:t("./TextureStore"),Layer:t("./Layer"),RenderLoop:t("./RenderLoop"),KeyboardControls:t("./controls/Keyboard"),DragControls:t("./controls/Drag"),QtvrControls:t("./controls/Qtvr"),ScrollZoomControls:t("./controls/ScrollZoom"),PinchZoomControls:t("./controls/PinchZoom"),Controls:t("./controls/Controls"),Viewer:t("./Viewer"),Scene:t("./Scene"),Hotspot:t("./Hotspot"),chooseBestStage:t("./chooseBestStage"),registerDefaultControls:t("./controls/registerDefaultControls"),autorotate:t("./autorotate"),version:t("./version"),dependencies:{hammerjs:t("hammerjs"),bowser:t("bowser")}}},{"./Hotspot":6,"./Layer":7,"./RenderLoop":9,"./Scene":10,"./TextureStore":11,"./Viewer":13,"./assets/DynamicCanvas":15,"./autorotate":19,"./chooseBestStage":21,"./controls/Controls":30,"./controls/Drag":31,"./controls/Keyboard":35,"./controls/PinchZoom":36,"./controls/Qtvr":37,"./controls/ScrollZoom":38,"./controls/registerDefaultControls":40,"./geometries/Cube":43,"./geometries/Equirect":44,"./geometries/Flat":45,"./renderers/CssCube":51,"./renderers/CssFlat":52,"./renderers/FlashCube":54,"./renderers/FlashFlat":55,"./renderers/WebGlCube":58,"./renderers/WebGlEquirect":60,"./renderers/WebGlFlat":62,"./renderers/registerDefaultRenderers":63,"./sources/ImageUrl":70,"./sources/SolidColor":71,"./sources/VideoUrl":73,"./stages/Css":75,"./stages/Flash":76,"./stages/WebGl":79,"./version":110,"./views/Flat":111,"./views/Rectilinear":112,bowser:1,hammerjs:3}],50:[function(t,e,i){"use strict";function n(t,e){return t.cmp(e)}function r(t,e,i){this._root=t,this._browserQuirks=e;var n=document.createElement("div");t.appendChild(n),n.style.position="absolute",o.setOverflowHidden(n),o.setNoPointerEvents(n),this._browserQuirks.useNullTransform&&o.setNullTransform(n),this.domElement=n,this._oldTileList=[],this._newTileList=[],this._textureMap=new s(i.equals,i.hash)}var s=t("../collections/Map"),o=t("../domUtil"),a="undefined"!=typeof MARZIPANODEBUG&&MARZIPANODEBUG.css;r.prototype.destroy=function(){this._root.removeChild(this.domElement),this._textureMap=null,this.domElement=null},r.prototype.startLayer=function(t,e){var i=this.domElement;i.style.left=e.left+"px",i.style.top=e.top+"px",i.style.width=e.width+"px",i.style.height=e.height+"px";var n=1,r=t.effects();r&&null!=r.opacity&&(n=r.opacity),i.style.opacity=n,this._newTileList.length=0,this._textureMap.clear()},r.prototype.renderTile=function(t,e){this._newTileList.push(t),this._textureMap.set(t,e)},r.prototype.endLayer=function(t){var e,i,r,s,h,l,u,c,p=this.domElement,f=this._oldTileList,d=this._newTileList,m=this._textureMap,v=t.view();if(p.children.length!==f.length)throw new Error("DOM not in sync with tile list");for(d.sort(n),e=0,r=f[e],u=p.firstChild,i=0;i<d.length;i++){for(s=d[i];e<f.length&&!(r.cmp(s)>=0);)c=u.nextSibling,p.removeChild(u),u=c,r=f[++e];if(h=m.get(s),l=h?h._canvas:null,!l)throw new Error("Rendering tile with missing texture");if(r&&0===r.cmp(s)){if(l!=u)throw new Error("DOM not in sync with tile list");u=u.nextSibling,r=f[++e]}else p.insertBefore(l,u);o.setTransform(l,this.calculateTransform(s,h,v)),a&&l.setAttribute("data-tile",s.str())}for(;u;)c=u.nextSibling,p.removeChild(u),u=c;if(p.children.length!==d.length)throw new Error("DOM not in sync with tile list");var _=this._oldTileList;this._oldTileList=this._newTileList,this._newTileList=_},e.exports=r},{"../collections/Map":24,"../domUtil":42}],51:[function(t,e,i){"use strict";function n(t,e){this.constructor.super_.call(this,t,e,r)}var r=t("../geometries/Cube").TileClass,s=t("./CssBase"),o=t("../util/inherits");o(n,s),n.prototype.calculateTransform=function(t,e,i){var n=this._browserQuirks.padSize,r=this._browserQuirks.reverseLevelDepth,s=this._browserQuirks.perspectiveNudge,o="",a=r?256-t.z:t.levelWidth(),h=i.size(),l=h.width,u=h.height;o+="translate3d("+l/2+"px, "+u/2+"px, 0px) ";var c=.5*u/Math.tan(i.fov()/2),p=c+s;o+="perspective("+c+"px) translateZ("+p+"px) ";var f=-i.pitch(),d=i.yaw();o+="rotateX("+f+"rad) rotateY("+d+"rad) ";var m=-t.rotX(),v=t.rotY();o+="rotateX("+m+"rad) rotateY("+v+"rad) ";var _=t.centerX()-t.scaleX()/2,y=-(t.centerY()+t.scaleY()/2),g=_*a,w=y*a,x=-a/2;if(o+="translate3d("+g+"px, "+w+"px, "+x+"px) ",r){var b=a*t.scaleX()/t.width(),E=a*t.scaleY()/t.height();o+="scale("+b+", "+E+") "}var T=t.padLeft()?n:0,M=t.padTop()?n:0;return(0!==T||0!==M)&&(o+="translate3d("+-T+"px, "+-M+"px, 0) "),o},e.exports=n},{"../geometries/Cube":43,"../util/inherits":98,"./CssBase":50}],52:[function(t,e,i){"use strict";function n(t,e){this.constructor.super_.call(this,t,e,r)}var r=t("../geometries/Flat").TileClass,s=t("./CssBase"),o=t("../util/inherits");o(n,s),n.prototype.calculateTransform=function(t,e,i){var n=this._browserQuirks.padSize,r="",s=i.width(),o=i.height();r+="translateX("+s/2+"px) translateY("+o/2+"px) ";var a=s/i.zoomX(),h=o/i.zoomY(),l=t.centerX()-t.scaleX()/2,u=-t.centerY()-t.scaleY()/2,c=l*a,p=u*h;r+="translateX("+c+"px) translateY("+p+"px) ";var f=-i.x()*a,d=-i.y()*h;r+="translateX("+f+"px) translateY("+d+"px) ";var m=t.padLeft()?n:0,v=t.padTop()?n:0;(0!==m||0!==v)&&(r+="translateX("+-m+"px) translateY("+-v+"px) ");var _=a/t.levelWidth();return r+="scale("+_+") "},e.exports=n},{"../geometries/Flat":45,"../util/inherits":98,"./CssBase":50}],53:[function(t,e,i){"use strict";function n(t,e){return t.cmp(e)}function r(t,e,i,n){this._flashElement=t,this._layerId=e,this._quirks=i,this._tileList=[],this._textureMap=new s(n.equals,n.hash),this._layerCreated=!1}var s=t("../collections/Map");r.prototype.destroy=function(){this._flashElement.destroyLayer(this._layerId),this._flashElement=null,this._layerId=null,this._layerCreated=null,this._tileList=null,this._padSize=null},r.prototype.startLayer=function(t,e){this._flashElement.isReady&&(this._layerCreated||(this._flashElement.createLayer(this._layerId),this._layerCreated=!0),this._tileList.length=0,this._textureMap.clear())},r.prototype.renderTile=function(t,e){this._tileList.push(t),this._textureMap.set(t,e)},r.prototype.endLayer=function(t,e){if(this._flashElement.isReady){var i=this._tileList;i.sort(n),this._renderOnFlash(t,e)}},e.exports=r},{"../collections/Map":24}],54:[function(t,e,i){"use strict";function n(t,e,i){this.constructor.super_.call(this,t,e,i,s),this._flashTileList=[]}var r=t("./FlashBase"),s=t("../geometries/Cube").TileClass,o=t("../util/inherits"),a=t("../util/radToDeg");o(n,r),n.prototype._renderOnFlash=function(t,e){var i=this._flashElement,n=this._layerId,r=this._quirks.padSize,s=this._tileList,o=this._textureMap,h=this._flashTileList;h.length=0;for(var l=0;l<s.length;l++){var u=s[l],c=o.get(u);if(!c)throw new Error("Rendering tile with missing texture");var p=u.padTop()?r:0,f=u.padBottom()?r:0,d=u.padLeft()?r:0,m=u.padRight()?r:0;h.push({textureId:c._textureId,face:u.face,width:u.width(),height:u.height(),centerX:u.centerX(),centerY:u.centerY(),rotX:a(u.rotX()),rotY:a(u.rotY()),levelSize:u.levelWidth(),padTop:p,padBottom:f,padLeft:d,padRight:m})}var v=1,_=t.effects();_&&null!=_.opacity&&(v=_.opacity);var y=t.view(),g=y.yaw(),w=y.pitch(),x=y.fov();i.drawCubeTiles(n,e.width,e.height,e.left,e.top,v,g,w,x,h)},e.exports=n},{"../geometries/Cube":43,"../util/inherits":98,"../util/radToDeg":104,"./FlashBase":53}],55:[function(t,e,i){"use strict";function n(t,e,i){this.constructor.super_.call(this,t,e,i,s),this._flashTileList=[]}var r=t("./FlashBase"),s=t("../geometries/Flat").TileClass,o=t("../util/inherits");o(n,r),n.prototype._renderOnFlash=function(t,e){var i=this._flashElement,n=this._layerId,r=this._quirks.padSize,s=this._tileList,o=this._textureMap,a=this._flashTileList;a.length=0;for(var h=0;h<s.length;h++){var l=s[h],u=o.get(l);if(!u)throw new Error("Rendering tile with missing texture");var c=l.padTop()?r:0,p=l.padBottom()?r:0,f=l.padLeft()?r:0,d=l.padRight()?r:0;a.push({textureId:u._textureId,tileWidth:l.width(),tileHeight:l.height(),levelWidth:l.levelWidth(),levelHeight:l.levelHeight(),x:l.x,y:l.y,padTop:c,padBottom:p,padLeft:f,padRight:d})}var m=1,v=t.effects();v&&null!=v.opacity&&(m=v.opacity);var _=t.view(),y=_.x(),g=_.y(),w=_.zoom();i.drawFlatTiles(n,e.width,e.height,e.left,e.top,m,y,g,w,a)},e.exports=n},{"../geometries/Flat":45,"../util/inherits":98,"./FlashBase":53}],56:[function(t,e,i){"use strict";function n(t){this.gl=t,this.mvMatrix=g.create(),this.vccMatrix=g.create(),this.translateVector=w.create(),this.scaleVector=w.create(),this.constantBuffers=s(this.gl,d,m,v),this.shaderProgram=a(this.gl,p,f,_,y)}var r=t("./WebGlCommon"),s=r.createConstantBuffers,o=r.destroyConstantBuffers,a=r.createShaderProgram,h=r.destroyShaderProgram,l=r.setViewport,u=r.setDepth,c=r.setTexture,p=t("../shaders/vertexNormal"),f=t("../shaders/fragmentNormal"),d=[0,1,2,0,2,3],m=[-.5,-.5,0,.5,-.5,0,.5,.5,0,-.5,.5,0],v=[0,0,1,0,1,1,0,1],_=["aVertexPosition","aTextureCoord"],y=["uPMatrix","uMVMatrix","vccMatrix","uDepth","uSampler","uOpacity"],g=t("gl-matrix").mat4,w=t("gl-matrix").vec3;n.prototype.destroy=function(){this.mvMatrix=null,this.vccMatrix=null,this.translateVector=null,this.scaleVector=null,o(this.gl,this.constantBuffers),this.constantBuffers=null,h(this.gl,this.shaderProgram),this.shaderProgram=null,this.gl=null},n.prototype.startLayer=function(t,e){var i=this.gl,n=this.shaderProgram,r=this.constantBuffers;i.useProgram(n),l(i,t,e,this.vccMatrix),i.uniformMatrix4fv(n.vccMatrix,!1,this.vccMatrix),i.bindBuffer(i.ARRAY_BUFFER,r.vertexPositions),i.vertexAttribPointer(n.aVertexPosition,3,i.FLOAT,i.FALSE,0,0),i.bindBuffer(i.ARRAY_BUFFER,r.textureCoords),i.vertexAttribPointer(n.aTextureCoord,2,i.FLOAT,i.FALSE,0,0),i.uniformMatrix4fv(n.uPMatrix,!1,t.view().projection());var s=1,o=t.effects();o&&null!=o.opacity&&(s=o.opacity),i.uniform1f(n.uOpacity,s)},n.prototype.endLayer=function(){},n.prototype.renderTile=function(t,e,i,n){var r=this.gl,s=this.shaderProgram,o=this.constantBuffers,a=this.mvMatrix,h=this.translateVector,l=this.scaleVector;h[0]=t.centerX(),h[1]=t.centerY(),h[2]=-.5,l[0]=t.scaleX(),l[1]=t.scaleY(),l[2]=1,g.identity(a),g.rotateX(a,a,t.rotX()),g.rotateY(a,a,t.rotY()),g.translate(a,a,h),g.scale(a,a,l),r.uniformMatrix4fv(s.uMVMatrix,!1,a),u(r,s,n,t.z),c(r,s,e),r.bindBuffer(r.ELEMENT_ARRAY_BUFFER,o.vertexIndices),r.drawElements(r.TRIANGLES,d.length,r.UNSIGNED_SHORT,0)},e.exports=n},{"../shaders/fragmentNormal":67,"../shaders/vertexNormal":69,"./WebGlCommon":57,"gl-matrix":2}],57:[function(t,e,i){"use strict";function n(t,e,i){var n=t.createShader(e);if(t.shaderSource(n,i),t.compileShader(n),!t.getShaderParameter(n,t.COMPILE_STATUS))throw t.getShaderInfoLog(n);return n}function r(t,e,i,r,s){var o=n(t,t.VERTEX_SHADER,e),a=n(t,t.FRAGMENT_SHADER,i),h=t.createProgram();if(t.attachShader(h,o),t.attachShader(h,a),t.linkProgram(h),!t.getProgramParameter(h,t.LINK_STATUS))throw t.getProgramInfoLog(h);for(var l=0;l<r.length;l++){var u=r[l];h[u]=t.getAttribLocation(h,u),t.enableVertexAttribArray(h[u])}for(var c=0;c<s.length;c++){var p=s[c];h[p]=t.getUniformLocation(h,p)}return h}function s(t,e){for(var i=t.getAttachedShaders(e),n=0;n<i.length;n++){var r=i[n];t.detachShader(e,r),t.deleteShader(r)}t.deleteProgram(e)}function o(t,e,i,n){var r=t.createBuffer();return t.bindBuffer(e,r),t.bufferData(e,n,i),r}function a(t,e,i,n){return{vertexIndices:o(t,t.ELEMENT_ARRAY_BUFFER,t.STATIC_DRAW,new Uint16Array(e)),vertexPositions:o(t,t.ARRAY_BUFFER,t.STATIC_DRAW,new Float32Array(i)),textureCoords:o(t,t.ARRAY_BUFFER,t.STATIC_DRAW,new Float32Array(n))}}function h(t,e){t.deleteBuffer(e.vertexIndices),t.deleteBuffer(e.vertexPositions),t.deleteBuffer(e.textureCoords)}function l(t,e,i){t.activeTexture(t.TEXTURE0),t.bindTexture(t.TEXTURE_2D,i._texture),t.uniform1i(e.uSampler,0)}function u(t,e,i,n){var r=((i+1)*d-n)/(d*f);t.uniform1f(e.uDepth,r)}function c(t,e,i,n){var r=m();p(i,g,n),t.viewport(r*g.offsetX,r*g.offsetY,r*g.width,r*g.height)}function p(t,e,i){var n=t.left,r=t.totalWidth,s=v(n,0,r),o=t.width-(s-n),a=r-s,h=v(o,0,a);e.offsetX=s,e.width=h;var l=t.totalHeight-t.bottom,u=t.totalHeight,c=v(l,0,u),p=t.height-(c-l),f=u-c,d=v(p,0,f);e.offsetY=c,e.height=d,x[0]=t.width/h,x[1]=t.height/d,x[2]=1;var m=s-n,y=n+t.width,g=s+h,b=y-g,E=c-l,T=l+t.height,M=c+d,C=T-M;w[0]=(b-m)/h,w[1]=(C-E)/d,w[2]=0;var L=i;_.identity(L),_.translate(L,L,w),_.scale(L,L,x)}var f=256,d=256,m=t("../util/pixelRatio"),v=t("../util/clamp"),_=t("gl-matrix").mat4,y=t("gl-matrix").vec3,g={},w=y.create(),x=y.create();e.exports={createShaderProgram:r,destroyShaderProgram:s,createConstantBuffers:a,destroyConstantBuffers:h,setTexture:l,setDepth:u,setViewport:c}},{"../util/clamp":88,"../util/pixelRatio":103,"gl-matrix":2}],58:[function(t,e,i){"use strict";var n=t("./WebGlBase");e.exports=n},{"./WebGlBase":56}],59:[function(t,e,i){"use strict";function n(t){this.gl=t,this.viewTransformMatrix=_.create(),this.constantBuffers=o(this.gl,p,f,d),this.shaderProgram=a(this.gl,u,c,m,v)}function r(t,e,i,n,r){r=r||0;var s=((i+1)*g-n)/(g*y);s-=r/1e5,t.uniform1f(e.uDepth,s)}var s=t("./WebGlCommon"),o=s.createConstantBuffers,a=s.createShaderProgram,h=s.setViewport,l=(s.setDepth,s.setTexture),u=t("../shaders/vertexEquirect"),c=t("../shaders/fragmentCubeStereographic"),p=[0,1,2,0,2,3],f=[-1,-1,0,1,-1,0,1,1,0,-1,1,0],d=[0,0,1,0,1,1,0,1],m=["aVertexPosition","aTextureCoord"],v=["viewTransformMatrix","uDepth","uSampler","uOpacity","uWidth","uHeight","fov","stereographicDistance","outerSide","tileFace","tileXMin","tileXMax","tileYMin","tileYMax"],_=t("gl-matrix").mat4;n.prototype.startLayer=function(t,e){var i=this.gl,n=this.shaderProgram,r=this.constantBuffers,s=this.viewTransformMatrix,o=t.view();h(i,t,e),i.useProgram(this.shaderProgram),i.bindBuffer(i.ARRAY_BUFFER,r.vertexPositions),i.vertexAttribPointer(n.aVertexPosition,3,i.FLOAT,i.FALSE,0,0),i.bindBuffer(i.ARRAY_BUFFER,r.textureCoords),i.vertexAttribPointer(n.aTextureCoord,2,i.FLOAT,i.FALSE,0,0),_.identity(s),_.rotateX(s,s,-o.pitch()),_.rotateY(s,s,-o.yaw()),i.uniformMatrix4fv(n.viewTransformMatrix,!1,s),this.gl.uniform1f(this.shaderProgram.uWidth,o.width()),this.gl.uniform1f(this.shaderProgram.uHeight,o.height()),this.gl.uniform1f(this.shaderProgram.fov,o.fov()),this.gl.uniform1f(this.shaderProgram.stereographicDistance,o.distance()),this.gl.uniform1f(this.shaderProgram.outerSide,o.outerSide());var a=1,l=t.effects();l&&null!=l.opacity&&(a=l.opacity),i.uniform1f(n.uOpacity,a)},n.prototype.endLayer=function(){},n.prototype.renderTile=function(t,e,i,n,s){var o=this.gl,a=this.shaderProgram,h=this.constantBuffers;r(o,a,n,t.z,s),l(o,a,e),this.gl.uniform1i(this.shaderProgram.tileFace,"fblrud".indexOf(t.face));var u=t.x/t.level().numHorizontalTiles(),c=u+1/t.level().numHorizontalTiles(),f=1-t.y/t.level().numVerticalTiles(),d=f-1/t.level().numVerticalTiles();this.gl.uniform1f(this.shaderProgram.tileXMin,u),this.gl.uniform1f(this.shaderProgram.tileXMax,c),this.gl.uniform1f(this.shaderProgram.tileYMin,d),this.gl.uniform1f(this.shaderProgram.tileYMax,f),o.bindBuffer(o.ELEMENT_ARRAY_BUFFER,h.vertexIndices),o.drawElements(o.TRIANGLES,p.length,o.UNSIGNED_SHORT,0)};var y=256,g=256;e.exports=n},{"../shaders/fragmentCubeStereographic":64,"../shaders/vertexEquirect":68,"./WebGlCommon":57,"gl-matrix":2}],60:[function(t,e,i){"use strict";function n(t){this.gl=t,this.pMatrix=g.create(),this.vccMatrix=g.create(),this.constantBuffers=s(this.gl,d,m,v),this.shaderProgram=o(this.gl,p,f,_,y)}var r=t("./WebGlCommon"),s=r.createConstantBuffers,o=r.createShaderProgram,a=r.setViewport,h=r.destroyConstantBuffers,l=r.destroyShaderProgram,u=r.setDepth,c=r.setTexture,p=t("../shaders/vertexEquirect"),f=t("../shaders/fragmentEquirect"),d=[0,1,2,0,2,3],m=[-1,-1,0,1,-1,0,1,1,0,-1,1,0],v=[0,0,1,0,1,1,0,1],_=["aVertexPosition","aTextureCoord"],y=["uPInvMatrix","uDepth","vccMatrix","uSampler","uOpacity","uWidth","uHeight"],g=t("gl-matrix").mat4;n.prototype.destroy=function(){this.pMatrix=null,h(this.gl,this.constantBuffers),this.constantBuffers=null,l(this.gl,this.shaderProgram),this.shaderProgram=null,this.gl=null},n.prototype.startLayer=function(t,e){var i=this.gl,n=this.shaderProgram,r=this.constantBuffers,s=this.pMatrix;i.useProgram(this.shaderProgram),a(i,t,e,this.vccMatrix),i.uniformMatrix4fv(n.vccMatrix,!1,this.vccMatrix),i.bindBuffer(i.ARRAY_BUFFER,r.vertexPositions),i.vertexAttribPointer(n.aVertexPosition,3,i.FLOAT,i.FALSE,0,0),i.bindBuffer(i.ARRAY_BUFFER,r.textureCoords),i.vertexAttribPointer(n.aTextureCoord,2,i.FLOAT,i.FALSE,0,0),g.copy(this.pMatrix,t.view().projection()),g.invert(s,s),i.uniformMatrix4fv(n.uPInvMatrix,!1,s),this.gl.uniform1f(this.shaderProgram.uWidth,e.width),this.gl.uniform1f(this.shaderProgram.uHeight,e.height);var o=1,h=t.effects();h&&null!=h.opacity&&(o=h.opacity),i.uniform1f(n.uOpacity,o)},n.prototype.endLayer=function(){},n.prototype.renderTile=function(t,e,i,n){var r=this.gl,s=this.shaderProgram,o=this.constantBuffers;u(r,s,n,t.z),c(r,s,e),r.bindBuffer(r.ELEMENT_ARRAY_BUFFER,o.vertexIndices),r.drawElements(r.TRIANGLES,d.length,r.UNSIGNED_SHORT,0)},e.exports=n},{"../shaders/fragmentEquirect":65,"../shaders/vertexEquirect":68,"./WebGlCommon":57,"gl-matrix":2}],61:[function(t,e,i){"use strict";function n(t){this.gl=t,this.viewTransformMatrix=_.create(),this.constantBuffers=s(this.gl,p,f,d),this.shaderProgram=o(this.gl,u,c,m,v)}var r=t("./WebGlCommon"),s=r.createConstantBuffers,o=r.createShaderProgram,a=r.setViewport,h=r.setDepth,l=r.setTexture,u=t("../shaders/vertexEquirect"),c=t("../shaders/fragmentEquirectStereographic"),p=[0,1,2,0,2,3],f=[-1,-1,0,1,-1,0,1,1,0,-1,1,0],d=[0,0,1,0,1,1,0,1],m=["aVertexPosition","aTextureCoord"],v=["viewTransformMatrix","uDepth","uSampler","uOpacity","uWidth","uHeight","fov","stereographicDistance","outerSide"],_=t("gl-matrix").mat4;n.prototype.startLayer=function(t,e){var i=this.gl,n=this.shaderProgram,r=this.constantBuffers,s=this.viewTransformMatrix,o=t.view();a(i,t,e),i.useProgram(this.shaderProgram),i.bindBuffer(i.ARRAY_BUFFER,r.vertexPositions),i.vertexAttribPointer(n.aVertexPosition,3,i.FLOAT,i.FALSE,0,0),i.bindBuffer(i.ARRAY_BUFFER,r.textureCoords),i.vertexAttribPointer(n.aTextureCoord,2,i.FLOAT,i.FALSE,0,0),_.identity(s),_.rotateX(s,s,-o.pitch()),_.rotateY(s,s,-o.yaw()),i.uniformMatrix4fv(n.viewTransformMatrix,!1,s),this.gl.uniform1f(this.shaderProgram.uWidth,o.width()),this.gl.uniform1f(this.shaderProgram.uHeight,o.height()),this.gl.uniform1f(this.shaderProgram.fov,o.fov()),this.gl.uniform1f(this.shaderProgram.stereographicDistance,o.distance()),this.gl.uniform1f(this.shaderProgram.outerSide,o.outerSide());var h=1,l=t.effects();l&&null!=l.opacity&&(h=l.opacity),i.uniform1f(n.uOpacity,h)},n.prototype.endLayer=function(){},n.prototype.renderTile=function(t,e,i,n){var r=this.gl,s=this.shaderProgram,o=this.constantBuffers;h(r,s,n,t.z),l(r,s,e),r.bindBuffer(r.ELEMENT_ARRAY_BUFFER,o.vertexIndices),r.drawElements(r.TRIANGLES,p.length,r.UNSIGNED_SHORT,0)},e.exports=n},{"../shaders/fragmentEquirectStereographic":66,"../shaders/vertexEquirect":68,"./WebGlCommon":57,"gl-matrix":2}],62:[function(t,e,i){arguments[4][58][0].apply(i,arguments)},{"./WebGlBase":56,dup:58}],63:[function(t,e,i){"use strict";function n(t){switch(t.type){case"webgl":t.registerRenderer("flat","flat",o),t.registerRenderer("cube","rectilinear",r),t.registerRenderer("cube","stereographic",s),t.registerRenderer("equirect","rectilinear",a),t.registerRenderer("equirect","stereographic",h);break;case"css":t.registerRenderer("flat","flat",u),t.registerRenderer("cube","rectilinear",l);break;case"flash":t.registerRenderer("flat","flat",p),t.registerRenderer("cube","rectilinear",c);break;default:throw new Error("Unknown stage type: "+t.type)}}var r=t("./WebGlCube"),s=t("./WebGlCubeStereographic"),o=t("./WebGlFlat"),a=t("./WebGlEquirect"),h=t("./WebGlEquirectStereographic"),l=t("./CssCube"),u=t("./CssFlat"),c=t("./FlashCube"),p=t("./FlashFlat");e.exports=n},{"./CssCube":51,"./CssFlat":52,"./FlashCube":54,"./FlashFlat":55,"./WebGlCube":58,"./WebGlCubeStereographic":59,"./WebGlEquirect":60,"./WebGlEquirectStereographic":61,"./WebGlFlat":62}],64:[function(t,e,i){e.exports="//TODO: support multiresolution\n//share code with fragmentEquirectangularStereographic\n\n#ifdef GL_FRAGMENT_PRECISION_HIGH\nprecision highp float;\n#else\nprecision mediump float;\n#endif\n\nuniform sampler2D uSampler;\nuniform mat4 viewTransformMatrix;\nuniform float uWidth;\nuniform float uHeight;\nuniform float uOpacity;\n\nuniform float fov;\nuniform float stereographicDistance;\nuniform bool outerSide;\n\n// Face encoding as int:\n// fblrud\n// 012345\nuniform int tileFace;\n// Tile position inside face as [xmin, xmax, ymin, ymax]\nuniform float tileXMin;\nuniform float tileXMax;\nuniform float tileYMin;\nuniform float tileYMax;\n\nvarying vec2 vTextureCoord;\n\nconst float PI = 3.14159265358979323846264;\n\n// Inspired by https://github.com/notlion/streetview-stereographic\n\n\nvec3 intersectWithUnitSphere(vec2 pnt, float s, bool small) {\n  // Formulas from http://en.wikipedia.org/wiki/Line%E2%80%93sphere_intersection\n\n  // s - distance from center (r is stereographic projection, 0 is normal)\n\n  //float r = 1.0;\n  //vec3 c = vec3(0,0,0)\n  vec3 o = vec3(0.0, 0.0, -s);\n\n  //v is a non-unit vector in the same direction as l\n  //v = (x,y,r) - (0, 0, -s)\n  vec3 v = vec3(pnt, 1.0 + s);\n  vec3 l = v / length(v);\n\n  float sqrtComponent = pow(dot(l,o), 2.0) - pow(length(o), 2.0) + 1.0;\n  // if sqrtComponent < 0, there is no intersection\n\n  float d = 0.0;\n  if(small) {\n    d = -dot(l, o) - sqrt(sqrtComponent);\n  }\n  else {\n    d = -dot(l, o) + sqrt(sqrtComponent);\n  }\n\n  return o + l * d;\n}\n\nbool intersectsSphere(vec2 pnt, float s) {\n  //TODO: code duplicated with function above\n  vec3 o = vec3(0.0, 0.0, -s);\n  vec3 v = vec3(pnt, 1.0 + s);\n  vec3 l = v / length(v);\n\n  float sqrtComponent = pow(dot(l,o), 2.0) - pow(length(o), 2.0) + 1.0;\n  return sqrtComponent > 0.0;\n}\n\nbool spherePointInTile(vec3 p) {\n  // Project view ray onto cube, i.e., normalize the coordinate with\n  // largest absolute value to Â±0.5.\n  float maxRayComponent = max(max(abs(p[0]), abs(p[1])), abs(p[2]));\n  float maxVal = maxRayComponent / 0.5;\n  p = p / maxVal;\n\n  // The largest coordinate can be used to check if we are on the correct face\n  bool correctFace = false;\n\n  if(tileFace == 0) {\n    //For the front tile, z should be the maximum value\n    correctFace = p.z > 0.0 && abs(p.z) >= abs(p.x) && abs(p.z) >= abs(p.y) && (0.5 + p.x) >= tileXMin && (0.5 + p.x) <= tileXMax && (0.5 + p.y) >= tileYMin && (0.5 + p.y) <= tileYMax;\n  }\n  else if(tileFace == 1) {\n    correctFace = p.z < 0.0 && abs(p.z) >= abs(p.x) && abs(p.z) >= abs(p.y) && (0.5 - p.x) >= tileXMin && (0.5 - p.x) <= tileXMax && (0.5 + p.y) >= tileYMin && (0.5 + p.y) <= tileYMax;\n  }\n  else if (tileFace == 2) {\n    correctFace = p.x < 0.0 && abs(p.x) >= abs(p.y) && abs(p.x) >= abs(p.z) && (0.5 + p.z) >= tileXMin && (0.5 + p.z) <= tileXMax && (0.5 + p.y) >= tileYMin && (0.5 + p.y) <= tileYMax;\n  }\n  else if (tileFace == 3) {\n    correctFace = p.x > 0.0 && abs(p.x) >= abs(p.y) && abs(p.x) >= abs(p.z) && (0.5 - p.z) >= tileXMin && (0.5 - p.z) <= tileXMax && (0.5 + p.y) >= tileYMin && (0.5 + p.y) <= tileYMax;\n  }\n  else if (tileFace == 4) {\n    correctFace = p.y > 0.0 && abs(p.y) >= abs(p.x) && abs(p.y) >= abs(p.z) && (0.5 + p.x) >= tileXMin && (0.5 + p.x) <= tileXMax && (0.5 - p.z) >= tileYMin && (0.5 - p.z) <= tileYMax;\n  }\n  else if (tileFace == 5) {\n    correctFace = p.y < 0.0 && abs(p.y) >= abs(p.x) && abs(p.y) >= abs(p.z) && (0.5 + p.x) >= tileXMin && (0.5 + p.x) <= tileXMax && (0.5 + p.z) >= tileYMin && (0.5 + p.z) <= tileYMax;\n  }\n\n  return correctFace;\n}\n\nvec2 tileCoordinates(vec3 p) {\n  // Project view ray onto cube, i.e., normalize the coordinate with\n  // largest absolute value to Â±0.5.\n  float maxRayComponent = max(max(abs(p[0]), abs(p[1])), abs(p[2]));\n  float maxVal = maxRayComponent / 0.5;\n  p = p / maxVal;\n\n  float xScale = tileXMax - tileXMin;\n  float yScale = tileYMax - tileYMin;\n\n  if(tileFace == 0) {\n    return vec2( (0.5 + p.x - tileXMin) / xScale, (0.5 + p.y - tileYMin) / yScale);\n  }\n  else if(tileFace == 1) {\n    return vec2( (0.5 - p.x - tileXMin) / xScale, (0.5 + p.y - tileYMin) / yScale);\n  }\n  else if(tileFace == 2) {\n    return vec2( (0.5 + p.z - tileXMin) / xScale, (0.5 + p.y - tileYMin) / yScale);\n  }\n  else if(tileFace == 3) {\n    return vec2( (0.5 - p.z - tileXMin) / xScale, (0.5 + p.y - tileYMin) / yScale);\n  }\n  else if(tileFace == 4) {\n    return vec2( (0.5 + p.x - tileXMin) / xScale, (0.5 - p.z - tileYMin) / yScale);\n  }\n  else if(tileFace == 5) {\n    return vec2( (0.5 + p.x - tileXMin) / xScale, (0.5 + p.z - tileYMin) / yScale);\n  }\n  else {\n    return vec2(-999.0, -999.0);\n  }\n}\n\nvoid main(void) {\n  // x and y value in range [-1, 1]\n  float x = 2.0 * (vTextureCoord.x - 0.5);\n  float y = 2.0 * (vTextureCoord.y - 0.5);\n\n  // range of visible projection plane according to fov\n  float yRange = tan(fov / 2.0);\n  float xRange = yRange * uWidth / uHeight;\n\n  vec2 pnt = vec2(x, y) * vec2(xRange, yRange);\n\n  if(!intersectsSphere(pnt, stereographicDistance)) {\n    // If sphere is not intersected (happens at stereographicDistance > 1), paint black\n    gl_FragColor = vec4(0.0, 0.0, 0.0, 0.0);\n    return;\n  }\n  vec3 sphere_pnt = intersectWithUnitSphere(pnt, stereographicDistance, outerSide);\n\n  // Transform the view by multiplying by viewTransformMatrix\n  sphere_pnt = (vec4(sphere_pnt, 0.0) * viewTransformMatrix).xyz;\n\n\n  // Convert to Spherical Coordinates\n  float r = 1.0 / length(sphere_pnt);\n  float phi  = acos(sphere_pnt.y * r);\n  float theta = atan(sphere_pnt.x, -sphere_pnt.z);\n\n  if(!spherePointInTile(sphere_pnt)) {\n    gl_FragColor = vec4(0.0, 0.0, 0.0, 0.0);\n    return;\n  }\n\n  vec2 tileCoords = tileCoordinates(sphere_pnt);\n\n  vec4 color = texture2D(uSampler, tileCoords);\n  gl_FragColor = vec4(color.rgb * color.a * uOpacity, color.a * uOpacity);\n}";

},{}],65:[function(t,e,i){e.exports="#ifdef GL_FRAGMENT_PRECISION_HIGH\nprecision highp float;\n#else\nprecision mediump float;\n#endif\n\nuniform sampler2D uSampler;\nuniform mat4 uPInvMatrix;\nuniform float uWidth;\nuniform float uHeight;\nuniform float uOpacity;\nvarying vec2 vTextureCoord;\n\nconst float PI = 3.14159265358979323846264;\n\nvoid main(void) {\n  float x = 2.0 * vTextureCoord.x - 1.0;\n  float y = 2.0 * vTextureCoord.y - 1.0;\n  vec4 pos = uPInvMatrix * vec4(x, y, 1.0, 1.0);\n  float r = inversesqrt(pos.x * pos.x + pos.y * pos.y + pos.z * pos.z);\n  float phi  = acos(pos.y * r);\n  float theta = atan(pos.x, -pos.z);\n  float s = 0.5 + 0.5 * theta / PI;\n  float t = 1.0 - phi / PI;\n  vec4 color = texture2D(uSampler, vec2(s, t));\n  gl_FragColor = vec4(color.rgb * color.a * uOpacity, color.a * uOpacity);\n}\n"},{}],66:[function(t,e,i){e.exports="#ifdef GL_FRAGMENT_PRECISION_HIGH\nprecision highp float;\n#else\nprecision mediump float;\n#endif\n\nuniform sampler2D uSampler;\nuniform mat4 viewTransformMatrix;\nuniform float uWidth;\nuniform float uHeight;\nuniform float uOpacity;\n\nuniform float fov;\nuniform float stereographicDistance;\nuniform bool outerSide;\n\nvarying vec2 vTextureCoord;\n\nconst float PI = 3.14159265358979323846264;\n\n// Inspired by https://github.com/notlion/streetview-stereographic\n\n\nvec3 intersectWithUnitSphere(vec2 pnt, float s, bool small) {\n  // Formulas from http://en.wikipedia.org/wiki/Line%E2%80%93sphere_intersection\n\n  // s - distance from center (r is stereographic projection, 0 is normal)\n\n  //float r = 1.0;\n  //vec3 c = vec3(0,0,0)\n  vec3 o = vec3(0.0, 0.0, -s);\n\n  //v is a non-unit vector in the same direction as l\n  //v = (x,y,r) - (0, 0, -s)\n  vec3 v = vec3(pnt, 1.0 + s);\n  vec3 l = v / length(v);\n\n  float sqrtComponent = pow(dot(l,o), 2.0) - pow(length(o), 2.0) + 1.0;\n  // if sqrtComponent < 0, there is no intersection\n\n  float d = 0.0;\n  if(small) {\n    d = -dot(l, o) - sqrt(sqrtComponent);\n  }\n  else {\n    d = -dot(l, o) + sqrt(sqrtComponent);\n  }\n\n  return o + l * d;\n}\n\nbool intersectsSphere(vec2 pnt, float s) {\n  //TODO: code duplicated with function above\n  vec3 o = vec3(0.0, 0.0, -s);\n  vec3 v = vec3(pnt, 1.0 + s);\n  vec3 l = v / length(v);\n\n  float sqrtComponent = pow(dot(l,o), 2.0) - pow(length(o), 2.0) + 1.0;\n  return sqrtComponent > 0.0;\n}\n\nvoid main(void) {\n  // x and y value in range [-1, 1]\n  float x = 2.0 * (vTextureCoord.x - 0.5);\n  float y = 2.0 * (vTextureCoord.y - 0.5);\n\n  // range of visible projection plane according to fov\n  float yRange = tan(fov / 2.0);\n  float xRange = yRange * uWidth / uHeight;\n\n  vec2 pnt = vec2(x, y) * vec2(xRange, yRange);\n\n  if(!intersectsSphere(pnt, stereographicDistance)) {\n    // If sphere is not intersected (happens at stereographicDistance > 1), paint black\n    gl_FragColor = vec4(0.0, 0.0, 0.0, 0.0);\n    return;\n  }\n  vec3 sphere_pnt = intersectWithUnitSphere(pnt, stereographicDistance, outerSide);\n\n  // Transform the view by multiplying by viewTransformMatrix\n  sphere_pnt = (vec4(sphere_pnt, 0.0) * viewTransformMatrix).xyz;\n\n\n  // Convert to Spherical Coordinates\n  float r = 1.0 / length(sphere_pnt);\n  float phi  = acos(sphere_pnt.y * r);\n  float theta = atan(sphere_pnt.x, -sphere_pnt.z);\n\n  float s = 0.5 + 0.5 * theta / PI;\n  float t = 1.0 - phi / PI;\n\n  // TODO: this looks odd. why can't we use the same formula as on the other equirectangular shader?\n  s = s * -1.0 + 1.0;\n  s += 0.5;\n  if(s > 1.0) { s -= 1.0; }\n\n  vec4 color = texture2D(uSampler, vec2(s, t));\n  gl_FragColor = vec4(color.rgb * color.a * uOpacity, color.a * uOpacity);\n}"},{}],67:[function(t,e,i){e.exports="#ifdef GL_FRAGMENT_PRECISION_HIGH\nprecision highp float;\n#else\nprecision mediump float;\n#endif\n\nvarying vec2 vTextureCoord;\nuniform sampler2D uSampler;\nuniform float uOpacity;\n\nvoid main(void) {\n  vec4 color = texture2D(uSampler, vTextureCoord);\n  gl_FragColor = vec4(color.rgb * color.a * uOpacity, color.a * uOpacity);\n}\n"},{}],68:[function(t,e,i){e.exports="attribute vec3 aVertexPosition;\nattribute vec2 aTextureCoord;\nvarying vec2 vTextureCoord;\nuniform float uDepth;\nuniform mat4 vccMatrix;\n\nvoid main(void) {\n  gl_Position = vccMatrix * vec4(aVertexPosition.xy, uDepth, 1.0);\n  vTextureCoord = aTextureCoord;\n}\n"},{}],69:[function(t,e,i){e.exports="attribute vec3 aVertexPosition;\nattribute vec2 aTextureCoord;\nvarying vec2 vTextureCoord;\nuniform float uDepth;\nuniform mat4 uMVMatrix;\nuniform mat4 uPMatrix;\nuniform mat4 vccMatrix;\n\nvoid main(void) {\n  gl_Position = vccMatrix * uPMatrix * uMVMatrix * vec4(aVertexPosition.xy, 0.0, 1.0);\n  gl_Position.z = uDepth * gl_Position.w;\n  vTextureCoord = aTextureCoord;\n}\n"},{}],70:[function(t,e,i){"use strict";function n(t,e){e=e?e:{},this._loadPool=new o({concurrency:e.concurrency||p}),this._retryDelay=e.retryDelay||f,this._retryMap={},this._sourceFromTile=t}function r(t){var e="\\{("+t+")\\}";return new RegExp(e,"g")}var s=t("../NetworkError"),o=t("../collections/WorkPool"),a=t("../util/chain"),h=t("../util/delay"),l=t("../util/clock"),u={x:"x",y:"y",z:"z",f:"face"},c="bdflru",p=4,f=1e4;n.prototype.loadAsset=function(t,e,i){var n,r=this,o=this._retryDelay,u=this._retryMap,c=this._sourceFromTile(e),p=c.url,f=c.rect,d=t.loadImage.bind(t,p,f),m=function(t){return r._loadPool.push(d,function(i,n){i?(i instanceof s&&(u[p]=l()),t(i,e)):(delete u[p],t(null,e,n))})},v=u[p];if(null!=v){var _=l(),y=_-v;o>y?n=o-y:(n=0,delete u[p])}var g=h.bind(null,n);return a(g,m)(i)},n.fromString=function(t,e){function i(e){var i=t;for(var n in u){var s=r(n),o=e[u[n]];i=i.replace(s,o)}return{url:i}}function s(t){return 0===t.z?o(t):i(t)}function o(t){var i=a.indexOf(t.face)/6;return{url:e.cubeMapPreviewUrl,rect:{x:0,y:i,width:1,height:1/6}}}e=e||{};var a=e&&e.cubeMapPreviewFaceOrder||c,h=e.cubeMapPreviewUrl?s:i;return new n(h)},n.stringHasFace=function(t){return n.stringHasProperty(t,"f")},n.stringHasX=function(t){return n.stringHasProperty(t,"x")},n.stringHasY=function(t){return n.stringHasProperty(t,"y")},n.stringHasLevel=function(t){return n.stringHasProperty(t,"z")},n.stringHasProperty=function(t,e){return!!t.match(r(e))},e.exports=n},{"../NetworkError":8,"../collections/WorkPool":26,"../util/chain":87,"../util/clock":89,"../util/delay":95}],71:[function(t,e,i){"use strict";function n(t,e,i,n,r){i=i||function(t){var e=[];return t.face&&e.push("face:"+t.face),e.push("x:"+t.x),e.push("y:"+t.y),e.push("zoom:"+t.z),e.join(" ")},n=n||function(t){if(t.face){if("u"==t.face)return"#999";if("b"==t.face)return"#aaa";if("d"==t.face)return"#bbb";if("f"==t.face)return"#ccc";if("r"==t.face)return"#ddd";if("l"==t.face)return"#eee"}return"#ddd"},r=r||function(){return"#000"},this._width=t,this._height=e,this._textFromTileFun=i,this._colorFromTileFun=n,this._textColorFromTileFun=r}function r(e,i){if("undefined"!=typeof document){var n=document.createElement("canvas");return n.width=e,n.height=i,n}var r=t,s=r("canvas"),o=new s(e,i);return o}var s=t("../util/defer"),o=t("../assets/StaticCanvas");n.prototype.loadAsset=function(t,e,i){var n=this._width,a=this._height,h=this._textFromTileFun(e),l=this._colorFromTileFun(e),u=this._textColorFromTileFun(e),c=r(n,a),p=c.getContext("2d");p.fillStyle=l,p.fillRect(0,0,n,a),p.fillStyle=u,p.font=n/20+"px Arial",p.textAlign="center",p.fillText(h,n/2,a/2),s(function(){var t=new o(c);i(null,e,t)})},e.exports=n},{"../assets/StaticCanvas":17,"../util/defer":94}],72:[function(t,e,i){"use strict";function n(){this._videos=[],this._lastRemovedVideoState=r}var r={paused:!0,currentTime:0};n.prototype._add=function(t){var e=this._videos.indexOf(t);if(e>=0)throw new Error("VideoMux.add(): videoElement already in list");this._videos.push(t)},n.prototype._remove=function(t){var e=this._videos.indexOf(t);if(-1>e)throw new Error("VideoMux.remove(): videoElement not in list");this._videos.splice(e,1),this._lastRemovedVideoState=this._cloneState(t)},n.prototype.play=function(){this._videos.forEach(function(t){t.play()})},n.prototype.pause=function(){this._videos.forEach(function(t){t.pause()})},n.prototype.paused=function(){if(0===this._videos.length)return this._lastRemovedVideoState.paused;var t=0;return this._videos.forEach(function(e){e.paused&&t++}),t>0},n.prototype.currentTime=function(){if(0===this._videos.length)return this._lastRemovedVideoState.currentTime;var t=0;return this._videos.forEach(function(e){t+=e.currentTime}),t/this._videos.length},n.prototype._cloneState=function(t){return{paused:t.paused,currentTime:t.currentTime}},e.exports=n},{}],73:[function(t,e,i){"use strict";function n(t,e){function i(){n&&r.paintCanvasFallback(),r._videoElement.paused||r.emit("changed"),r._unloaded||requestAnimationFrame(i)}var n=s.msie;n?(this._videoElement=t,this._drawElement=document.createElement("canvas"),this.paintCanvasFallback()):(this._videoElement=t,this._drawElement=t),this.source=e,this._unloaded=!1;var r=this;this._handleTimeUpdate=function(){n&&r.paintCanvasFallback(),r.emit("changed")},this._videoElement.addEventListener("timeupdate",this._handleTimeUpdate),i()}function r(t){this._urlFromTile=t,this._video=new l}var s=t("bowser").browser,o=(t("../util/clock"),t("../util/once")),a=t("./loadVideo"),h=t("../util/eventEmitter"),l=t("./VideoMux");h(n),n.prototype.dynamic=!0,n.prototype.disableMipmapping=!0,n.prototype.paintCanvasFallback=function(){this._drawElement.width=this._videoElement.videoWidth,this._drawElement.height=this._videoElement.videoHeight,this._drawElement.getContext("2d").drawImage(this._videoElement,0,0)},n.prototype.element=function(){return this._drawElement},n.prototype.videoElement=function(){return this._videoElement},n.prototype.timestamp=function(){return this._videoElement.currentTime},n.prototype.destroy=function(){this._unloaded=!0,this._videoElement.removeEventListener("timeupdate",this._handleProgress),this._videoElement.pause(),this._videoElement.volume=0,this._videoElement.removeAttribute("src"),this.source.destroyAsset(this)},n.prototype.width=function(){return this._videoElement.videoWidth},n.prototype.height=function(){return this._videoElement.videoHeight},r.prototype.video=function(){return this._video},r.prototype.loadAsset=function(t,e,i){function r(){h.removeAttribute("src"),i.apply(null,arguments)}i=o(i);var s=this,h=document.createElement("video"),l=this._urlFromTile(e,h);return h.style.position="absolute",h.style.display="none",a(h,l,this.video(),function(t){if(t)i(t);else{var r=new n(h,s);s.video()._add(h),i(null,e,r)}}),r},r.prototype.destroyAsset=function(t){var e=t.videoElement();this._video._remove(e)},e.exports=r},{"../util/clock":89,"../util/eventEmitter":96,"../util/once":102,"./VideoMux":72,"./loadVideo":74,bowser:1}],74:[function(t,e,i){"use strict";function n(t,e,i,n){t.controls=!0,t.crossOrigin="anonymous";var s=5e3;t.src=e,r(t,t.HAVE_CURRENT_DATA,.2,function(){i.paused()?t.currentTime=i.currentTime():t.currentTime=i.currentTime()+s/1e3,r(t,t.HAVE_ENOUGH_DATA,.2,function(){i.paused()?(t.currentTime=i.currentTime(),n(null,t)):t.currentTime<=i.currentTime()?(t.play(),n(null,t)):setTimeout(function(){t.play(),n(null,t)},1e3*(t.currentTime-i.currentTime()))})})}function r(t,e,i,n){var r=setInterval(function(){t.readyState>=e&&(clearInterval(r),n(null,!0))},i)}t("../util/clock");e.exports=n},{"../util/clock":89}],75:[function(t,e,i){"use strict";function n(t){this.constructor.super_.call(this,t),this._domElement=document.createElement("div"),h.setAbsolute(this._domElement),h.setFullSize(this._domElement)}function r(t,e,i){var n=document.createElement("canvas");h.setAbsolute(n),h.setNullTransformOrigin(n),this._canvas=n,this._timestamp=null,this.refresh(e,i)}var s=t("./Stage"),o=t("../support/Css"),a=t("../util/inherits"),h=t("../domUtil"),l=t("bowser").browser,u=t("./loadImageHtml"),c={padSize:l.ios?0:3,reverseLevelDepth:l.ios,useNullTransform:l.ios,perspectiveNudge:l.webkit||l.gecko?.001:0};a(n,s),n.prototype.destroy=function(){this.constructor.super_.prototype.destroy.call(this),this._domElement=null},n.supported=function(){return o()},n.prototype._updateSize=function(){var t=this._domElement,e=this._width,i=this._height;h.setPixelSize(t,e,i)},n.prototype.loadImage=u,n.prototype._validateLayer=function(t){},n.prototype.createRenderer=function(t){return new t(this._domElement,c)},n.prototype.destroyRenderer=function(t){t.destroy()},n.prototype.startFrame=function(){},n.prototype.endFrame=function(){},n.type=n.prototype.type="css",r.prototype.refresh=function(t,e){var i=e.timestamp();if(i!==this._timestamp){this._timestamp=i;var n=this._canvas,r=n.getContext("2d"),s=e.element(),o=t.width(),a=t.height(),h=c.padSize,l=t.padTop()?h:0,u=t.padBottom()?h:0,p=t.padLeft()?h:0,f=t.padRight()?h:0;n.width=p+o+f,n.height=l+a+u,r.drawImage(s,p,l,o,a);var d;for(d=0;l>d;d++)r.drawImage(n,p,l,o,1,p,d,o,1);for(d=0;p>d;d++)r.drawImage(n,p,l,1,a,d,l,1,a);for(d=0;u>d;d++)r.drawImage(n,p,l+a-1,o,1,p,l+a+d,o,1);for(d=0;f>d;d++)r.drawImage(n,p+o-1,l,1,a,p+o+d,l,1,a)}},r.prototype.destroy=function(){this._canvas=null,this._timestamp=null},n.TextureClass=n.prototype.TextureClass=r,e.exports=n},{"../domUtil":42,"../support/Css":82,"../util/inherits":98,"./Stage":78,"./loadImageHtml":81,bowser:1}],76:[function(t,e,i){"use strict";function n(t){this.constructor.super_.call(this,t),this._wmode=t&&t.wmode||d,this._swfPath=t&&t.swfPath||f,this._flashStageId=++_,this._callbacksObj=window[m][this._flashStageId]={},this._stageCallbacksObjVarName=m+"["+this._flashStageId+"]",this._callbackListeners={};for(var e=0;e<v.length;e++)this._callbacksObj[v[e]]=this._callListeners(v[e]);this._loadImageQueue=new h,this._loadImageQueue.pause(),this._flashReady=!1,this._nextLayerId=0;var i=r(this._swfPath,this._flashStageId,this._stageCallbacksObjVarName);this._domElement=i.root,this._blockingElement=i.blocking,this._flashElement=i.flash,this._checkReadyTimer=setInterval(this._checkReady.bind(this),50)}function r(t,e,i){var n=document.createElement("div");c.setAbsolute(n),c.setFullSize(n);var r="marzipano-flash-stage-"+e,s='<object id="'+r+'" name="'+r+'" type="application/x-shockwave-flash" data="'+t+'">',o="";o+='<param name="movie" value="'+t+'" />',o+='<param name="allowscriptaccess" value="always" />',o+='<param name="flashvars" value="callbacksObjName='+i+'" />',o+='<param name="wmode" value="transparent" />',s+=o,s+="</object>";var a=document.createElement("div");a.innerHTML=s;var h=a.firstChild;c.setAbsolute(h),c.setFullSize(h),n.appendChild(h);var l=document.createElement("div");return c.setAbsolute(l),c.setFullSize(l),c.setBlocking(l),n.appendChild(l),{root:n,flash:h,blocking:l}}function s(t,e,i){var n=i.element(),r=e.width(),s=e.height(),o=y.padSize,a=e.padTop()?o:0,h=e.padBottom()?o:0,l=e.padLeft()?o:0,u=e.padRight()?o:0,c=t._flashElement.createTexture(n,r,s,a,h,l,u);this._stage=t,this._textureId=c}var o=t("./Stage"),a=t("../support/Flash"),h=t("../collections/WorkQueue"),l=t("../util/inherits"),u=t("../util/defer"),c=t("../domUtil"),p=t("./loadImageFlash"),f="marzipano.swf",d="transparent",m="MarzipanoFlashCallbacks",v=["imageLoaded"];window[m]={};var _=0,y={padSize:3};l(n,o),n.prototype.destroy=function(){this.constructor.super_.prototype.destroy.call(this),this._domElement=null,this._blockingElement=null,this._flashElement=null,window[m][this._flashStageId]=null,this._callbacksObj=null,this._loadImageQueue=null,clearInterval(this._checkReadyTimer)},n.supported=function(){return a()},n.prototype._updateSize=function(){var t=this._domElement,e=this._width,i=this._height;c.setPixelSize(t,e,i)},n.prototype.loadImage=function(t,e,i){var n=p.bind(null,this,t,e);return this._loadImageQueue.push(n,i)},n.prototype._validateLayer=function(t){},n.prototype._onCallback=function(t,e){this._callbackListeners[t]=this._callbackListeners[t]||[],this._callbackListeners[t].push(e)},n.prototype._offCallback=function(t,e){var i=this._callbackListeners[t]||[],n=i.indexOf(e);n>=0&&i.splice(n,1)},n.prototype._callListeners=function(t){var e=this;return function(){for(var i=e._callbackListeners[t]||[],n=0;n<i.length;n++){var r=i[n];u(r,arguments)}}},n.prototype._checkReady=function(){return this._flashElement.isReady?(this._flashReady=!0,clearTimeout(this._checkReadyTimer),this._loadImageQueue.resume(),this.emitRenderInvalid(),!0):!1},n.prototype.createRenderer=function(t){return new t(this._flashElement,++this._nextLayerId,y)},n.prototype.destroyRenderer=function(t){t.destroy()},n.prototype.startFrame=function(){},n.prototype.endFrame=function(){},n.type=n.prototype.type="flash",s.prototype.refresh=function(t,e){},s.prototype.destroy=function(){var t=this._textureId,e=this._stage;e._flashElement.destroyTexture(t),this._stage=null,this._textureId=null},n.TextureClass=n.prototype.TextureClass=s,e.exports=n},{"../collections/WorkQueue":27,"../domUtil":42,"../support/Flash":83,"../util/defer":94,"../util/inherits":98,"./Stage":78,"./loadImageFlash":80}],77:[function(t,e,i){"use strict";function n(){this._renderers={}}n.prototype.set=function(t,e,i){this._renderers[t]||(this._renderers[t]={}),this._renderers[t][e]=i},n.prototype.get=function(t,e){var i=this._renderers[t]&&this._renderers[t][e];return i||null},e.exports=n},{}],78:[function(t,e,i){"use strict";function n(t,e){return-t.cmp(e)}function r(t){this._domElement=null,this._layers=[],this._renderers=[],this._visibleTiles=[],this._fallbackTiles={children:[],parents:[]},this._tmpTiles=[],this._width=null,this._height=null,this._rect={},this._createTextureWorkQueue=new o({delay:c}),this.emitRenderInvalid=this.emitRenderInvalid.bind(this),this._rendererRegistry=new u}var s=t("../util/eventEmitter"),o=t("../collections/WorkQueue"),a=t("../calcRect"),h=t("../util/async"),l=t("../util/cancelize"),u=t("./RendererRegistry"),c=20;s(r),r.prototype.destroy=function(){this.removeAllLayers(),this._layers=null,this._renderers=null,this._visibleTiles=null,this._fallbackTiles=null,this._tmpTiles=null,this._width=null,this._height=null,this._createTextureWorkQueue=null,this.emitRenderInvalid=null,this._rendererRegistry=null},r.prototype.registerRenderer=function(t,e,i){return this._rendererRegistry.set(t,e,i)},r.prototype.domElement=function(){return this._domElement},r.prototype.size=function(t){return t=t||{},t.width=this._width,t.height=this._height,t},r.prototype.updateSize=function(){this._width=this._domElement.parentElement.clientWidth,this._height=this._domElement.parentElement.clientHeight,this._updateSize(),this.emit("resize"),this.emitRenderInvalid()},r.prototype.emitRenderInvalid=function(){this.emit("renderInvalid")},r.prototype.addLayer=function(t){if(this._layers.indexOf(t)>=0)throw new Error("Layer already in stage");this._validateLayer(t),this._layers.push(t),this._renderers.push(null),t.addEventListener("viewChange",this.emitRenderInvalid),t.addEventListener("effectsChange",this.emitRenderInvalid),t.addEventListener("fixedLevelChange",this.emitRenderInvalid),t.addEventListener("textureStoreChange",this.emitRenderInvalid),this.emitRenderInvalid()},r.prototype.removeLayer=function(t){var e=this._layers.indexOf(t);if(0>e)throw new Error("No such layer in stage");var i=this._layers.splice(e,1)[0],n=this._renderers.splice(e,1)[0];n&&this.destroyRenderer(n),i.removeEventListener("viewChange",this.emitRenderInvalid),i.removeEventListener("effectsChange",this.emitRenderInvalid),i.removeEventListener("fixedLevelChange",this.emitRenderInvalid),i.removeEventListener("textureStoreChange",this.emitRenderInvalid),this.emitRenderInvalid()},r.prototype.removeAllLayers=function(){for(;this._layers.length>0;)this.removeLayer(this._layers[0])},r.prototype.listLayers=function(){return[].concat(this._layers)},r.prototype.hasLayer=function(t){return this._layers.indexOf(t)>=0},r.prototype.moveLayerToIndex=function(t,e){var i=this._layers.indexOf(t);if(0>i)throw new Error("No such layer in stage");var t=this._layers.splice(i,1)[0],n=this._renderers.splice(i,1)[0];this._layers.splice(e,0,t),this._renderers.splice(e,0,n),this.emitRenderInvalid()},r.prototype.render=function(){var t,e=this._visibleTiles,i=this._fallbackTiles,r=this._width,s=this._height,o=this._rect;if(!(0>=r||0>=s)){for(this.startFrame(),t=0;t<this._layers.length;t++)this._layers[t].textureStore().startFrame();for(t=0;t<this._layers.length;t++){var h=this._layers[t],l=h.effects(),u=h.view(),c=this._updateRenderer(t),p=this._layers.length-t,f=h.textureStore();a(r,s,l&&l.rect,o),u.setSize(o),e.length=0,h.visibleTiles(e),c.startLayer(h,o),i.children.length=0,i.parents.length=0,this._renderTiles(e,f,c,h,p,!0),this._renderTiles(i.children,f,c,h,p,!1),i.parents.sort(n),this._renderTiles(i.parents,f,c,h,p,!1),c.endLayer(h,o)}for(t=0;t<this._layers.length;t++)this._layers[t].textureStore().endFrame();this.endFrame()}},r.prototype._updateRenderer=function(t){var e=this._layers[t],i=this.type,n=e.geometry().type,r=e.view().type,s=this._rendererRegistry.get(n,r);if(!s)throw new Error("No "+i+" renderer avaiable for "+n+" geometry and "+r+" view");var o=this._renderers[t];return o?o instanceof s||(this._renderers[t]=this.createRenderer(s),this.destroyRenderer(o)):this._renderers[t]=this.createRenderer(s),this._renderers[t]},r.prototype._renderTiles=function(t,e,i,n,r,s){for(var o=0;o<t.length;o++){var a=t[o];e.texture(a)?i.renderTile(a,e.texture(a),n,r,o):s&&this._fallback(a,e),e.markTile(a)}},r.prototype._fallback=function(t,e){return this._childrenFallback(t,e)||this._parentFallback(t,e)},r.prototype._parentFallback=function(t,e){for(var i=this._fallbackTiles.parents;null!=(t=t.parent());)if(t&&e.texture(t)){for(var n=0;n<i.length;n++)if(t.equals(i[n]))return!0;return i.push(t),!0}return!1},r.prototype._childrenFallback=function(t,e){var i=this._fallbackTiles.children,n=this._tmpTiles;if(n.length=0,!t.children(n))return!1;if(1===n.length&&!e.texture(n[0]))return this._childrenFallback(n[0],e,i);for(var r=!1,s=0;s<n.length;s++)e.texture(n[s])?i.push(n[s]):r=!0;return!r},r.prototype.createTexture=function(t,e,i){function n(){return new r.TextureClass(r,t,e)}var r=this,s=l(h(n));return this._createTextureWorkQueue.push(s,function(n,r){i(n,t,e,r)})},e.exports=r},{"../calcRect":20,"../collections/WorkQueue":27,"../util/async":85,"../util/cancelize":86,"../util/eventEmitter":96,"./RendererRegistry":77}],79:[function(t,e,i){"use strict";function n(t,e){var i={alpha:!0,preserveDrawingBuffer:e&&e.preserveDrawingBuffer};v&&"undefined"!=typeof WebGLDebugUtils&&(console.log("Using WebGL lost context simulator"),t=WebGLDebugUtils.makeLostContextSimulatingCanvas(t));var n=t.getContext&&(t.getContext("webgl",i)||t.getContext("experimental-webgl",i));if(!n)throw new Error("Could not get WebGL context");return v&&"undefined"!=typeof WebGLDebugUtils&&(n=WebGLDebugUtils.makeDebugContext(n),console.log("Using WebGL debug context")),n}function r(t){function e(t,e){return t===e}function i(t){return d(t.toString())}var r=this;this.constructor.super_.call(this,t),this._mipmapping=null!=t.mipmapping?t.mipmapping:!1,this._domElement=document.createElement("canvas"),l.setAbsolute(this._domElement),l.setFullSize(this._domElement),this._gl=n(this._domElement,t),this._handleContextLoss=function(){r.emit("webglcontextlost"),r._gl=null},this._domElement.addEventListener("webglcontextlost",this._handleContextLoss),this._rendererInstances=new h(e,i)}function s(t,e,i){this._stage=t,this._gl=t._gl,this._texture=t._gl.createTexture(),this._timestamp=null,this.refresh(e,i)}var o=t("./Stage"),a=t("../support/WebGl"),h=t("../collections/Map"),l=t("../domUtil"),u=t("./loadImageHtml"),c=t("../util/inherits"),p=t("../util/defer"),f=t("../util/pixelRatio"),d=t("../util/hash"),m=t("../util/ispot"),v="undefined"!=typeof MARZIPANODEBUG&&MARZIPANODEBUG.webGl;c(r,o),r.prototype.destroy=function(){this.constructor.super_.prototype.destroy.call(this),this._domElement.removeEventListener("webglcontextlost",this._handleContextLoss),this._domElement=null,this._rendererInstances=null,this._gl=null},r.supported=function(){return a()},r.prototype._updateSize=function(){var t=this._domElement,e=this._width,i=this._height,n=f();this._domElement.width=n*e,this._domElement.height=n*i,p(l.setPixelSize.bind(null,t,e,i))},r.prototype.loadImage=u,r.prototype.maxTextureSize=function(){return this._gl.getParameter(this._gl.MAX_TEXTURE_SIZE)},r.prototype._validateLayer=function(t){var e=t.geometry().maxTileSize(),i=this.maxTextureSize();if(e>i)throw new Error("Layer has level with tile size larger than maximum texture size ("+e+" vs. "+i+")")},r.prototype.createRenderer=function(t){if(this._rendererInstances.has(t))return this._rendererInstances.get(t);var e=new t(this._gl);return this._rendererInstances.set(t,e),e},r.prototype.destroyRenderer=function(t){this._renderers.indexOf(t)<0&&(t.destroy(),this._rendererInstances.del(t.constructor))},r.prototype.startFrame=function(){var t=this._gl;if(!t)throw new Error("Bad WebGL context - maybe context was lost?");var e=this._width,i=this._height,n=f();t.viewport(0,0,n*e,n*i),t.clearColor(0,0,0,0),t.clear(t.COLOR_BUFFER_BIT|t.DEPTH_BUFFER_BIT),t.enable(t.DEPTH_TEST),t.enable(t.BLEND),t.blendFunc(t.ONE,t.ONE_MINUS_SRC_ALPHA)},r.prototype.endFrame=function(){},r.type=r.prototype.type="webgl",s.prototype.refresh=function(t,e){var i=e.timestamp();if(i!==this._timestamp){this._timestamp=i;var n=this._stage,r=this._texture,s=e.element(),o=e.width(),a=e.height(),h=t.width(),l=t.height(),u=n.maxTextureSize();if(h>u||l>u){var c=Math.min(h,l);throw new Error("Texture larger than max size ("+c+" vs. "+u+")")}if(h!==o||l!==a){var p=document.createElement("canvas");p.width=h,p.height=l;var f=p.getContext("2d");f.drawImage(s,0,0,h,l),s=p}var d=this._gl;d.bindTexture(d.TEXTURE_2D,r),d.pixelStorei(d.UNPACK_FLIP_Y_WEBGL,!0),d.texImage2D(d.TEXTURE_2D,0,d.RGBA,d.RGBA,d.UNSIGNED_BYTE,s);var v=m(h)&&m(l)&&!t.disableMipmapping&&!e.disableMipmapping&&this._stage._mipmapping;v?(d.texParameteri(d.TEXTURE_2D,d.TEXTURE_MAG_FILTER,d.LINEAR),d.texParameteri(d.TEXTURE_2D,d.TEXTURE_MIN_FILTER,d.LINEAR_MIPMAP_LINEAR),d.generateMipmap(d.TEXTURE_2D)):(d.texParameteri(d.TEXTURE_2D,d.TEXTURE_MAG_FILTER,d.LINEAR),d.texParameteri(d.TEXTURE_2D,d.TEXTURE_MIN_FILTER,d.LINEAR)),d.texParameteri(d.TEXTURE_2D,d.TEXTURE_WRAP_S,d.CLAMP_TO_EDGE),d.texParameteri(d.TEXTURE_2D,d.TEXTURE_WRAP_T,d.CLAMP_TO_EDGE),d.bindTexture(d.TEXTURE_2D,null)}},s.prototype.destroy=function(){var t=this._texture,e=this._gl;e.deleteTexture(t),this._stage=null,this._gl=null,this._texture=null,this._timestamp=null},r.TextureClass=r.prototype.TextureClass=s,e.exports=r},{"../collections/Map":24,"../domUtil":42,"../support/WebGl":84,"../util/defer":94,"../util/hash":97,"../util/inherits":98,"../util/ispot":99,"../util/pixelRatio":103,"./Stage":78,"./loadImageHtml":81}],80:[function(t,e,i){"use strict";function n(t,e,i,n){function a(i,s){s===d&&(t._offCallback("imageLoaded",a),i?n(new r("Network error: "+e)):n(null,new o(l,d)))}function h(){l.cancelImage(d),t._offCallback("imageLoaded",a),n.apply(null,arguments)}var l=t._flashElement,u=i&&i.x||0,c=i&&i.y||0,p=i&&i.width||1,f=i&&i.height||1,d=l.loadImage(e,p,f,u,c);return n=s(n),t._onCallback("imageLoaded",a),h}var r=t("../NetworkError"),s=t("../util/once"),o=t("../assets/FlashImage");e.exports=n},{"../NetworkError":8,"../assets/FlashImage":16,"../util/once":102}],81:[function(t,e,i){"use strict";function n(t,e,i){function n(){h.onload=h.onerror=null,h.src="",i.apply(null,arguments)}var h=new Image,l=e&&e.x||0,u=e&&e.y||0,c=e&&e.width||1,p=e&&e.height||1;return i=s(i),h.onload=function(){if(0===l&&0===u&&1===c&&1===p)i(null,new o(h));else{l*=h.naturalWidth,u*=h.naturalHeight,c*=h.naturalWidth,p*=h.naturalHeight;var t=document.createElement("canvas");t.width=c,t.height=p;var e=t.getContext("2d");e.drawImage(h,l,u,c,p,0,0,c,p),i(null,new a(t))}},h.onerror=function(){i(new r("Network error: "+t))},h.src=t,n}var r=t("../NetworkError"),s=t("../util/once"),o=t("../assets/StaticImage"),a=t("../assets/StaticCanvas");e.exports=n},{"../NetworkError":8,"../assets/StaticCanvas":17,"../assets/StaticImage":18,"../util/once":102}],82:[function(t,e,i){"use strict";function n(){var t=o("perspective"),e=document.createElement("div"),i="undefined"!=typeof e.style[t];if(i&&"WebkitPerspective"===t){var n="__testCssSupport__",r=document.createElement("style");r.textContent="@media(-webkit-transform-3d){#"+n+"{height: 3px;})",document.getElementsByTagName("head")[0].appendChild(r),e.id=n,document.body.appendChild(e),i=3===e.offsetHeight,r.parentNode.removeChild(r),e.parentNode.removeChild(e)}return i}function r(){return void 0!==s?s:s=n()}var s,o=t("../domUtil").prefixProperty;e.exports=r},{"../domUtil":42}],83:[function(t,e,i){"use strict";function n(){var t=null,e=navigator.plugins,i=navigator.mimeTypes,n=null;if(e&&e["Shockwave Flash"]&&i&&i["application/x-shockwave-flash"]&&i["application/x-shockwave-flash"].enabledPlugin)n=e["Shockwave Flash"].description,n=n.replace(/^.*\s+(\S+\s+\S+$)/,"$1"),t=[0,0,0],t[0]=parseInt(n.replace(/^(.*)\..*$/,"$1"),10),t[1]=parseInt(n.replace(/^.*\.(.*)\s.*$/,"$1"),10),t[2]=/[a-zA-Z]/.test(n)?parseInt(n.replace(/^.*[a-zA-Z]+(.*)$/,"$1"),10):0;else if(window.ActiveXObject)try{var r=new ActiveXObject("ShockwaveFlash.ShockwaveFlash");r&&(n=r.GetVariable("$version"))&&(n=n.split(" ")[1].split(","),t=[parseInt(n[0],10),parseInt(n[1],10),parseInt(n[2],10)])}catch(s){}return t}function r(){var t=n();return t&&t[0]>=11||10===t[0]&&t[1]>=1}function s(){return void 0!==o?o:o=r()}var o;e.exports=s},{}],84:[function(t,e,i){"use strict";function n(){var t=document.createElement("canvas"),e=t.getContext&&(t.getContext("webgl")||t.getContext("experimental-webgl"));return!!e}function r(){return void 0!==s?s:s=n()}var s;e.exports=r},{}],85:[function(t,e,i){"use strict";function n(t){return function(e){var i,n;try{n=t()}catch(r){i=r}finally{e(i||null,i?null:n)}}}e.exports=n},{}],86:[function(t,e,i){"use strict";function n(t){return function(){function e(){n.apply(null,arguments)}if(!arguments.length)throw new Error("cancelized: expected at least one argument");var i=Array.prototype.slice.call(arguments,0),n=i[i.length-1]=r(i[i.length-1]);return t.apply(null,i),e}}var r=t("./once");e.exports=n},{"./once":102}],87:[function(t,e,i){"use strict";function n(){var t=Array.prototype.slice.call(arguments,0);return function(){function e(){var t=arguments[0];if(t)return s=o=null,void h.apply(null,arguments);if(!n.length)return s=o=null,void h.apply(null,arguments);s=n.shift();var i=s,r=Array.prototype.slice.call(arguments,1);r.push(e);var a=s.apply(null,r);if(i===s){if("function"!=typeof a)throw new Error("chain: chaining on non-cancellable function");o=a}}function i(){o&&o.apply(null,arguments)}var n=t.slice(0),s=null,o=null,a=arguments.length?Array.prototype.slice.call(arguments,0,arguments.length-1):[],h=arguments.length?arguments[arguments.length-1]:r;return a.unshift(null),e.apply(null,a),i}}var r=t("./noop");e.exports=n},{"./noop":101}],88:[function(t,e,i){"use strict";function n(t,e,i){return Math.min(Math.max(t,e),i)}e.exports=n},{}],89:[function(t,e,i){"use strict";function n(){return window.performance&&window.performance.now?function(){return window.performance.now()}:null}function r(){return function(){return Date.now()}}var s=n()||r();e.exports=s},{}],90:[function(t,e,i){"use strict";function n(t,e){return e>t?-1:t>e?1:0}e.exports=n},{}],91:[function(t,e,i){"use strict";function n(){var t=arguments;return function(e){for(var i=e,n=0;n<t.length;n++){var r=t[n];i=r.call(null,i)}return i}}e.exports=n},{}],92:[function(t,e,i){"use strict";function n(t,e,i){return 2*Math.atan(e*Math.tan(t/2)/i)}function r(t,e,i){return n(t,e,i)}function s(t,e,i){return n(t,e,Math.sqrt(e*e+i*i))}function o(t,e,i){return n(t,i,e)}function a(t,e,i){return n(t,i,Math.sqrt(e*e+i*i))}function h(t,e,i){return n(t,Math.sqrt(e*e+i*i),e)}function l(t,e,i){return n(t,Math.sqrt(e*e+i*i),i)}e.exports={convert:n,htov:r,htod:s,vtoh:o,vtod:a,dtoh:h,dtov:l}},{}],93:[function(t,e,i){
"use strict";function n(t,e){for(var i in e)i in t||(t[i]=e[i]);return t}e.exports=n},{}],94:[function(t,e,i){"use strict";function n(t,e){function i(){e&&e.length>0?t.apply(null,e):t()}setTimeout(i,0)}e.exports=n},{}],95:[function(t,e,i){"use strict";function n(t,e){function i(){null!=r&&(r=null,e(null))}function n(){null!=r&&(clearTimeout(r),r=null,e.apply(null,arguments))}var r=null;return r=setTimeout(i,t),n}e.exports=n},{}],96:[function(t,e,i){"use strict";function n(){}function r(t){for(var e=Object.keys(n.prototype),i=0;i<e.length;i++){var r=e[i];t.prototype[r]=n.prototype[r]}}n.prototype.addEventListener=function(t,e){var i=this.__events=this.__events||{},n=i[t]=i[t]||[];n.push(e)},n.prototype.removeEventListener=function(t,e){var i=this.__events=this.__events||{},n=i[t];if(n){var r=n.indexOf(e);r>=0&&n.splice(r,1)}},n.prototype.emit=function(t,e,i,n,r,s){var o=this.__events=this.__events||{},a=o[t];if(a)for(var h=0;h<a.length;h++){var l=a[h];l.call(this,e,i,n,r,s)}},e.exports=r},{}],97:[function(t,e,i){"use strict";function n(){for(var t=0,e=0;e<arguments.length;e++){var i=arguments[e];t+=i,t+=i<<10,t^=i>>6}return t+=t<<3,t^=t>>11,t+=t<<15,t>=0?t:-t}e.exports=n},{}],98:[function(t,e,i){"use strict";function n(t,e){t.super_=e;var i=function(){};i.prototype=e.prototype,t.prototype=new i,t.prototype.constructor=t}e.exports=n},{}],99:[function(t,e,i){"use strict";function n(t){return 0===(t&t-1)}e.exports=n},{}],100:[function(t,e,i){"use strict";function n(t,e){return(+t%(e=+e)+e)%e}e.exports=n},{}],101:[function(t,e,i){"use strict";function n(){}e.exports=n},{}],102:[function(t,e,i){"use strict";function n(t){var e,i=!1;return function(){return i||(i=!0,e=t.apply(null,arguments)),e}}e.exports=n},{}],103:[function(t,e,i){"use strict";function n(){if("undefined"!=typeof window){if(window.devicePixelRatio)return window.devicePixelRatio;if(window.screen&&window.screen.deviceXDPI&&window.screen.logicalXDPI)return window.screen.deviceXDPI/window.screen.logicalXDPI;if(window.screen&&window.screen.systemXDPI&&window.screen.logicalXDPI)return window.screen.systemXDPI/window.screen.logicalXDPI}return r}var r=1;e.exports=n},{}],104:[function(t,e,i){"use strict";function n(t){return 180*t/Math.PI}e.exports=n},{}],105:[function(t,e,i){"use strict";function n(t){return"number"==typeof t&&isFinite(t)}e.exports=n},{}],106:[function(t,e,i){"use strict";function n(t){return function(){function e(){var e=arguments[0];!e||o?n.apply(null,arguments):s=t.apply(null,i)}var i=arguments.length?Array.prototype.slice.call(arguments,0,arguments.length-1):[],n=arguments.length?arguments[arguments.length-1]:r,s=null,o=!1;return i.push(e),e(!0),function(){o=!0,s.apply(null,arguments)}}}var r=t("./noop");e.exports=n},{"./noop":101}],107:[function(t,e,i){"use strict";function n(t,e,i,n,h){return r.copy(a,o),i&&r.rotateZ(a,a,i),n&&r.rotateY(a,a,n),h&&r.rotateX(a,a,h),s.transformMat4(t,e,a),t}var r=t("gl-matrix").mat4,s=t("gl-matrix").vec3,o=r.identity(r.create()),a=r.create();e.exports=n},{"gl-matrix":2}],108:[function(t,e,i){"use strict";function n(t,e,i){function n(){if(!s){var a=(r()-o)/t;1>a?(e(a),requestAnimationFrame(n)):(e(1),i())}}var s=!1,o=r();return e(0),requestAnimationFrame(n),function(){s=!0,i.apply(null,arguments)}}var r=t("./clock");e.exports=n},{"./clock":89}],109:[function(t,e,i){"use strict";function n(t){var e=typeof t;if("object"===e){if(null===t)return"null";if("[object Array]"===Object.prototype.toString.call(t))return"array";if("[object RegExp]"===Object.prototype.toString.call(t))return"regexp"}return e}e.exports=n},{}],110:[function(t,e,i){e.exports="0.1.2"},{}],111:[function(t,e,i){"use strict";function n(t,e){this._x=t&&null!=t.x?t.x:l,this._y=t&&null!=t.y?t.y:u,this._zoom=t&&null!=t.zoom?t.zoom:c,this._mediaAspectRatio=t&&null!=t.mediaAspectRatio?t.mediaAspectRatio:p,this._width=t&&null!=t.width?t.width:0,this._height=t&&null!=t.height?t.height:0,this._limiter=e||null,this._frustum=[0,0,0,0],this._projectionMatrix=o.create(),this._projectionChanged=!0,this._params={},this._update()}var r=t("../util/pixelRatio"),s=t("../util/eventEmitter"),o=t("gl-matrix").mat4,a=t("../util/real"),h=t("../util/clamp"),l=.5,u=.5,c=1,p=1,f=[1,0,1,0],d=[-1,-1,1,1],m=1e-4;s(n),n.prototype.destroy=function(){},n.prototype.x=function(){return this._x},n.prototype.y=function(){return this._y},n.prototype.width=function(){return this._width},n.prototype.height=function(){return this._height},n.prototype.zoom=function(){return this._zoom},n.prototype.zoomX=function(){return this._zoom},n.prototype.zoomY=function(){if(this._width<=0||this._height<=0)return 1;var t=this._width/this._height;return this._zoom*this._mediaAspectRatio/t},n.prototype.mediaAspectRatio=function(){return this._mediaAspectRatio},n.prototype.size=function(t){return t||(t={}),t.width=this._width,t.height=this._height,t},n.prototype.parameters=function(t){return t||(t={}),t.x=this._x,t.y=this._y,t.zoom=this._zoom,t.mediaAspectRatio=this._mediaAspectRatio,t},n.prototype.setX=function(t){this._resetParams(),this._params.x=t,this._update(this._params)},n.prototype.setY=function(t){this._resetParams(),this._params.y=t,this._update(this._params)},n.prototype.setZoom=function(t){this._resetParams(),this._params.zoom=t,this._update(this._params)},n.prototype.offsetX=function(t){this.setX(this._x+t)},n.prototype.offsetY=function(t){this.setY(this._y+t)},n.prototype.offsetZoom=function(t){this.setZoom(this._zoom+t)},n.prototype.setMediaAspectRatio=function(t){this._resetParams(),this._params.mediaAspectRatio=t,this._update(this._params)},n.prototype.setSize=function(t){this._resetParams(),this._params.width=t.width,this._params.height=t.height,this._update(this._params)},n.prototype.setParameters=function(t){this._resetParams();var e=this._params;e.x=t.x,e.y=t.y,e.zoom=t.zoom,e.mediaAspectRatio=t.mediaAspectRatio,this._update(e)},n.prototype._resetParams=function(){var t=this._params;t.x=null,t.y=null,t.zoom=null,t.mediaAspectRatio=null,t.width=null,t.height=null},n.prototype._update=function(t){null==t&&(this._resetParams(),t=this._params);var e=this._x,i=this._y,n=this._zoom,r=this._mediaAspectRatio,s=this._width,o=this._height;if(t.x=null!=t.x?t.x:e,t.y=null!=t.y?t.y:i,t.zoom=null!=t.zoom?t.zoom:n,t.mediaAspectRatio=null!=t.mediaAspectRatio?t.mediaAspectRatio:r,t.width=null!=t.width?t.width:s,t.height=null!=t.height?t.height:o,this._limiter&&(t=this._limiter(t),!t))throw new Error("Bad view limiter");var l=t.x,u=t.y,c=t.zoom,p=t.mediaAspectRatio,f=t.width,d=t.height;if(!(a(l)&&a(u)&&a(c)&&a(p)&&a(f)&&a(d)))throw new Error("Bad view - suspect a broken limiter");c=h(c,m,1/0),this._x=l,this._y=u,this._zoom=c,this._mediaAspectRatio=p,this._width=f,this._height=d,(l!==e||u!==i||c!==n||p!==r||f!==s||d!==o)&&(this._projectionChanged=!0,this.emit("change"))},n.prototype.updateWithControlParameters=function(t){var e=this.zoom();this.offsetX(t.axisScaledX*this.zoomX()+t.x*e),this.offsetY(-t.axisScaledY*this.zoomY()+-t.y*e),this.offsetZoom(t.zoom*e)},n.prototype.projection=function(){var t=this._projectionMatrix;if(this._projectionChanged){var e=this._x,i=this._y,n=this.zoomX(),r=this.zoomY(),s=this._frustum,a=s[0]=-i+.5*r,h=s[1]=e+.5*n,l=s[2]=-i-.5*r,u=s[3]=e-.5*n;o.ortho(t,u,h,l,a,-1,1),this._projectionChanged=!1}return t},n.prototype.selectLevel=function(t){for(var e=r()*this.width(),i=this._zoom,n=0;n<t.length;n++){var s=t[n];if(i*s.width()>=e)return s}return t[t.length-1]},n.prototype.intersects=function(t){var e=this._frustum;this.projection();for(var i=0;i<e.length;i++){for(var n=e[i],r=f[i],s=d[i],o=!1,a=0;a<t.length;a++){var h=t[a];if(0>s&&h[r]<n||s>0&&h[r]>n){o=!0;break}}if(!o)return!1}return!0},n.prototype.coordinatesToScreen=function(t,e){e||(e={}),this.projection();var i=this._frustum,n=i[0],r=i[1],s=i[2],o=i[3],a=this.width(),h=this.height();return e.x=a*(t.x-o)/(r-o),e.y=h*(t.y+n)/(n-s),e},n.prototype.screenToCoordinates=function(t,e){e||(e={}),this.projection();var i=this._frustum,n=i[0],r=i[1],s=i[2],o=i[3],a=this.width(),h=this.height();return e.x=o+t.x*(r-o)/a,e.y=t.y*(n-s)/h-n,e},n.limit={x:function(t,e){return function(i){return i.x=h(i.x,t,e),i}},y:function(t,e){return function(i){return i.y=h(i.y,t,e),i}},zoom:function(t,e){return function(i){return i.zoom=h(i.zoom,t,e),i}},resolution:function(t){return function(e){var i=e.width,n=r()*i/t;return e.zoom=h(e.zoom,n,1/0),e}},visibleX:function(t,e){return function(i){var n=e-t;i.zoom>n&&(i.zoom=n);var r=0+.5*i.zoom/n,s=1-.5*i.zoom/n;return i.x=h(i.x,r,s),i}},visibleY:function(t,e){return function(i){var n=i.width/i.height,r=(e-t)*n/i.mediaAspectRatio;i.zoom>r&&(i.zoom=r);var s=0+.5*i.zoom/r,o=1-.5*i.zoom/r;return i.y=h(i.y,s,o),i}},letterbox:function(){return function(t){var e=t.width/t.height,i=1,n=e/t.mediaAspectRatio;t.mediaAspectRatio>=e&&(t.zoom=Math.min(t.zoom,i)),t.mediaAspectRatio<=e&&(t.zoom=Math.min(t.zoom,n));var r,s;t.zoom>i?r=s=.5:(r=0+.5*t.zoom/i,s=1-.5*t.zoom/i);var o,a;return t.zoom>n?o=a=.5:(o=0+.5*t.zoom/n,a=1-.5*t.zoom/n),t.x=h(t.x,r,s),t.y=h(t.y,o,a),t}}},n.type=n.prototype.type="flat",e.exports=n},{"../util/clamp":88,"../util/eventEmitter":96,"../util/pixelRatio":103,"../util/real":105,"gl-matrix":2}],112:[function(t,e,i){"use strict";function n(t,e){this._yaw=t&&null!=t.yaw?t.yaw:_,this._pitch=t&&null!=t.pitch?t.pitch:y,this._fov=t&&null!=t.fov?t.fov:g,this._width=t&&null!=t.width?t.width:m,this._height=t&&null!=t.height?t.height:v,this._limiter=e||null,this._params={},this._frustum=new c,this._projectionMatrix=p.create(),this._projectionChanged=!0,this._ray=f.create(),this._invProj=p.create(),this._update()}var r=t("../util/eventEmitter"),s=t("../util/pixelRatio"),o=t("../util/convertFov"),a=t("../util/rotateVector"),h=t("../util/mod"),l=t("../util/real"),u=t("../util/clamp"),c=t("../Frustum"),p=t("gl-matrix").mat4,f=t("gl-matrix").vec4,d=t("../util/compose"),m=0,v=0,_=0,y=0,g=Math.PI/4,w=1e-4;r(n),n.prototype.destroy=function(){this._yaw=null,this._pitch=null,this._fov=null,this._width=null,this._height=null,this._limiter=null,this._params=null,this._frustum=null,this._projectionMatrix=null,this._projectionChanged=null,this._ray=null,this._invProj=null},n.prototype.yaw=function(){return this._yaw},n.prototype.pitch=function(){return this._pitch},n.prototype.fov=function(){return this._fov},n.prototype.size=function(t){return t||(t={}),t.width=this._width,t.height=this._height,t},n.prototype.parameters=function(t){return t||(t={}),t.yaw=this._yaw,t.pitch=this._pitch,t.fov=this._fov,t},n.prototype.setYaw=function(t){this._resetParams(),this._params.yaw=t,this._update(this._params)},n.prototype.setPitch=function(t){this._resetParams(),this._params.pitch=t,this._update(this._params)},n.prototype.setFov=function(t){this._resetParams(),this._params.fov=t,this._update(this._params)},n.prototype.offsetYaw=function(t){this.setYaw(this._yaw+t)},n.prototype.offsetPitch=function(t){this.setPitch(this._pitch+t)},n.prototype.offsetFov=function(t){this.setFov(this._fov+t)},n.prototype.setSize=function(t){this._resetParams(),this._params.width=t.width,this._params.height=t.height,this._update(this._params)},n.prototype.setParameters=function(t){this._resetParams();var e=this._params;e.yaw=t.yaw,e.pitch=t.pitch,e.fov=t.fov,this._update(e)},n.prototype._resetParams=function(){var t=this._params;t.yaw=null,t.pitch=null,t.fov=null,t.width=null,t.height=null},n.prototype._update=function(t){null==t&&(this._resetParams(),t=this._params);var e=this._yaw,i=this._pitch,n=this._fov,r=this._width,s=this._height;if(t.yaw=null!=t.yaw?t.yaw:e,t.pitch=null!=t.pitch?t.pitch:i,t.fov=null!=t.fov?t.fov:n,t.width=null!=t.width?t.width:r,t.height=null!=t.height?t.height:s,this._limiter&&(t=this._limiter(t),!t))throw new Error("Bad view limiter");t=this._normalize(t);var o=t.yaw,a=t.pitch,h=t.fov,u=t.width,c=t.height;if(!(l(o)&&l(a)&&l(h)&&l(u)&&l(c)))throw new Error("Bad view - suspect a broken limiter");this._yaw=o,this._pitch=a,this._fov=h,this._width=u,this._height=c,(o!==e||a!==i||h!==n||u!==r||c!==s)&&(this._projectionChanged=!0,this.emit("change"))},n.prototype._normalize=function(t){this._normalizeCoordinates(t);var e=o.htov(Math.PI,t.width,t.height),i=isNaN(e)?Math.PI:Math.min(Math.PI,e);return t.fov=u(t.fov,w,i-w),t},n.prototype._normalizeCoordinates=function(t){return t.yaw=h(t.yaw-Math.PI,-2*Math.PI)+Math.PI,t.pitch=h(t.pitch-Math.PI,-2*Math.PI)+Math.PI,t},n.prototype.normalizeToClosest=function(t,e){return e=e||{},e.yaw=t.yaw,e.pitch=t.pitch,this._normalizeCoordinates(e),Math.abs(e.yaw-2*Math.PI-this._yaw)<Math.abs(e.yaw-this._yaw)?e.yaw=e.yaw-2*Math.PI:Math.abs(e.yaw+2*Math.PI-this._yaw)<Math.abs(e.yaw-this._yaw)&&(e.yaw=e.yaw+2*Math.PI),Math.abs(e.pitch-2*Math.PI-this._pitch)<Math.abs(e.pitch-this._pitch)?e.pitch=e.pitch-2*Math.PI:Math.abs(e.pitch+2*Math.PI-this._pitch)<Math.abs(e.pitch-this._pitch)&&(e.pitch=e.pitch+2*Math.PI),e},n.prototype.updateWithControlParameters=function(t){var e=this._fov,i=o.vtoh(e,this._height,this._width);isNaN(i)&&(i=e),this.offsetYaw(t.axisScaledX*i+2*t.x*i+t.yaw),this.offsetPitch(-t.axisScaledY*e+2*-t.y*i+t.pitch),this.offsetFov(t.zoom*e)},n.prototype.projection=function(){var t=this._projectionMatrix;if(this._projectionChanged){var e=this._width/this._height;p.perspective(t,this._fov,e,-1,1),p.rotateX(t,t,this.pitch()),p.rotateY(t,t,this.yaw()),this._projectionChanged=!1}return t},n.prototype.selectLevel=function(t){for(var e=s()*this._height,i=Math.tan(.5*this._fov),n=0;n<t.length;n++){var r=t[n];if(i*r.height()>=e)return r}return t[t.length-1]},n.prototype.intersects=function(t){var e=this._frustum,i=this._yaw,n=this._pitch,r=this._fov,s=o.vtoh(r,this._height,this._width);return isNaN(s)&&(s=r),e.intersects(i,n,s,r,t)},n.prototype.coordinatesToScreen=function(t,e){var i=this._ray;e||(e={});var n=this._width,r=this._height;if(0>=n||0>=r)return e.x=null,e.y=null,null;f.set(i,0,0,-1,1),a(i,i,0,-t.yaw,-t.pitch),f.transformMat4(i,i,this.projection());for(var s=0;3>s;s++)i[s]/=i[3];return i[2]>=0?(e.x=n*(i[0]+1)/2,e.y=r*(1-i[1])/2,e):(e.x=null,e.y=null,null)},n.prototype.screenToCoordinates=function(t,e){var i=this._ray,n=this._invProj;e||(e={});var r=this._width,s=this._height;p.invert(n,this.projection());var o=2*t.x/r-1,a=1-2*t.y/s;f.set(i,o,a,1,1),f.transformMat4(i,i,n);var h=Math.sqrt(i[0]*i[0]+i[1]*i[1]+i[2]*i[2]);return e.yaw=Math.atan2(i[0],-i[2]),e.pitch=Math.acos(i[1]/h)-Math.PI/2,this._normalizeCoordinates(e),e},n.prototype.setLimiter=function(t){this._limiter=t||null,this._update()},n.limit={yaw:function(t,e){return function(i){return i.yaw=u(i.yaw,t,e),i}},pitch:function(t,e){return function(i){return i.pitch=u(i.pitch,t,e),i}},hfov:function(t,e){return function(i){var n=i.width,r=i.height;if(n>0&&r>0){var s=o.htov(t,n,r),a=o.htov(e,n,r);i.fov=u(i.fov,s,a)}return i}},vfov:function(t,e){return function(i){return i.fov=u(i.fov,t,e),i}},resolution:function(t){return function(e){var i=e.height;if(i){var n=s()*i,r=2*Math.atan(n/t);e.fov=u(e.fov,r,1/0)}return e}},maxResolutionAndMaxFov:function(t,e){return d(n.limit.resolution(t),n.limit.hfov(0,e),n.limit.vfov(0,e),n.limit.pitch(-Math.PI/2,Math.PI/2))}},n.type=n.prototype.type="rectilinear",e.exports=n},{"../Frustum":4,"../util/clamp":88,"../util/compose":91,"../util/convertFov":92,"../util/eventEmitter":96,"../util/mod":100,"../util/pixelRatio":103,"../util/real":105,"../util/rotateVector":107,"gl-matrix":2}]},{},[48])(48)});